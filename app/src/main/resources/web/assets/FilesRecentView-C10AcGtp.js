import{_ as $e}from"./ListItemPhone.vuevuetypescriptsetuptruelang-Ces94TEX.js";import{d as R,c as a,M as u,o,A as p,R as be,a as l,j as v,bJ as D,k as t,aO as Z,t as r,O as y,q as J,P as Y,U as j,I as P,V as q,H as x,v as c,ao as ee,bI as Fe,c3 as Ce,L as se,N as Se,u as De,r as C,f as Te,s as Le,i as Ve,aA as Ae,Y as Pe,Z as Re,$ as Be,h as S,a0 as W,a1 as Me,c6 as Oe,bB as Ne,a2 as Ue,bV as ze,c7 as Ke,G as X,bU as Ge,bZ as He,ax as Qe,b_ as Ze,b$ as Je,a5 as je,a7 as I,c0 as qe,c1 as We}from"./index-CiJYwD0I.js";import{_ as Xe}from"./FieldId.vuevuetypescriptsetuptruelang-C8u7Jssa.js";import{_ as te}from"./VCheckbox-DY9-xm2z.js";import{_ as Ye,u as xe,c as es}from"./key-events-DNEDF963.js";import{_ as ss}from"./DownloadMethodModal.vuevuetypescriptsetuptruelang-Dp4tESTz.js";const ts={class:"start"},ns={class:"number"},os={key:0,class:"svg",src:D},is=["src"],ls=["src"],as={key:3,class:"svg",src:D},ds={class:"title"},rs={class:"subtitle"},cs={class:"actions"},ms={class:"card card-info"},us={class:"key-value vertical"},ps={class:"key"},vs={class:"value"},fs={key:0,class:"svg",src:D},gs=["src"],hs=["src"],ks={key:3,class:"svg",src:D},_s={class:"actions"},ys={class:"card card-info"},Is={class:"key-value vertical"},ws={class:"key"},Es={class:"value"},$s=R({__name:"FileRecentItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},imageErrorIds:{},extensionImageErrorIds:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},onImageError:{type:Function},onExtensionImageError:{type:Function},downloadFile:{type:Function},clickItem:{type:Function}},setup(B){return(e,s)=>{const g=te,w=Xe,E=ee,h=x,m=Fe,k=Ce,$=$e,_=Y("tooltip");return e.isPhone?(o(),u($,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:s[12]||(s[12]=i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item))),onMouseenter:s[13]||(s[13]=p(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:s[14]||(s[14]=i=>e.toggleSelect(i,e.item,e.index))},{image:c(()=>[l("div",{class:"image",onClick:s[10]||(s[10]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",fs)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[8]||(s[8]=i=>e.onImageError(e.item.id))},null,40,gs)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[9]||(s[9]=i=>e.onExtensionImageError(e.item.id))},null,40,hs)):(o(),a("img",ks))])]),title:c(()=>[P(r(e.item.name),1)]),subtitle:c(()=>[l("span",null,r(t(J)(e.item.size)),1),y((o(),a("span",null,[P(r(t(q)(e.item.updatedAt)),1)])),[[_,t(j)(e.item.updatedAt)]])]),actions:c(()=>[l("div",_s,[y((o(),u(h,{onClick:s[11]||(s[11]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ys,[l("div",Is,[l("div",ws,r(e.$t("path")),1),l("div",Es,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),a("section",{key:0,class:be(["file-item recent-file-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:s[6]||(s[6]=p(i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item)),["stop"])),onMouseenter:s[7]||(s[7]=p(i=>e.handleMouseOver(i,e.index),["stop"]))},[l("div",ts,[e.shiftEffectingIds.includes(e.item.id)?(o(),u(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:s[0]||(s[0]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),u(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:s[1]||(s[1]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),l("span",ns,[v(w,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),l("div",{class:"image",onClick:s[4]||(s[4]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",os)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[2]||(s[2]=i=>e.onImageError(e.item.id))},null,40,is)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[3]||(s[3]=i=>e.onExtensionImageError(e.item.id))},null,40,ls)):(o(),a("img",as))]),l("div",ds,r(e.item.name),1),l("div",rs,[l("span",null,r(t(J)(e.item.size)),1),y((o(),a("span",null,[P(r(t(q)(e.item.updatedAt)),1)])),[[_,t(j)(e.item.updatedAt)]])]),l("div",cs,[y((o(),u(h,{onClick:s[5]||(s[5]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ms,[l("div",us,[l("div",ps,r(e.$t("path")),1),l("div",vs,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])],34))}}}),bs=se($s,[["__scopeId","data-v-7ca2e29e"]]),Fs={key:0,class:"file-item recent-file-item selectable-card-skeleton"},Cs={class:"start"},Ss={class:"number"},Ds=R({__name:"FileRecentSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(B){return(e,s)=>{const g=Ye;return e.isPhone?(o(),u(g,{key:1,"title-width":"60%",subtitles:[{width:"45%"},{width:"40%"}],"action-count":2})):(o(),a("section",Fs,[l("div",Cs,[s[0]||(s[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",Ss,r(e.index),1)]),s[1]||(s[1]=Se('<div class="image" data-v-777f0631><div class="skeleton-image lg" data-v-777f0631></div></div><div class="title" data-v-777f0631><div class="skeleton-text lg" style="width:40%;" data-v-777f0631></div></div><div class="subtitle" data-v-777f0631><div class="skeleton-text" style="width:30%;" data-v-777f0631></div></div><div class="actions" data-v-777f0631><div class="skeleton-text lg" style="width:80px;" data-v-777f0631></div></div>',4))]))}}}),Ts=se(Ds,[["__scopeId","data-v-777f0631"]]),Ls={class:"top-app-bar"},Vs={key:0},As={key:1},Ps={key:0,class:"scroller main-list"},Rs={key:2,class:"no-data-placeholder"},Ks=R({__name:"FilesRecentView",setup(B){const{t:e}=De(),s=C([]),g=Oe(),w=Te(),{app:E,urlTokenKey:h}=Le(w),m=C([]),{selectedIds:k,allChecked:$,realAllChecked:_,clearSelection:i,toggleAllChecked:ne,toggleSelect:oe,total:T,checked:M,shiftEffectingIds:ie,handleItemClick:le,handleMouseOver:ae,selectAll:de,shouldSelect:re}=xe(m),{downloadFile:b,downloadFiles:ce,downloadDir:me}=Ae(h),{view:ue}=Je(s,(n,d)=>{w.lightbox={sources:n,index:d,visible:!0}}),{keyDown:O,keyUp:N}=es(de,i,()=>{}),U=C([]),z=C([]),pe=n=>{U.value.push(n)},ve=n=>{z.value.push(n)},{mutate:fe,onDone:ge}=Ve({document:ze});ge(n=>{ce(n.data.setTempValue.key),i()});const he=n=>{He(n.name)?window.open(Qe(h.value,n.path),"_blank"):Ze(n.name)?ue(m.value,n):b(n.path)},{loading:L,fetch:V}=Pe({handle:async(n,d)=>{if(d)X(e(d),"error");else{const f=[];for(const A of n.recentFiles)f.push(Ge(A,h.value));m.value=f,T.value=f.length}},document:Ke}),ke=()=>{const n=m.value.filter(d=>k.value.includes(d.id));if(n.length===0){X(e("select_first"),"error");return}if(n.length===1&&!n[0].isDir){b(n[0].path),i();return}je(ss,{onEach:async()=>{for(const d of n)d.isDir?me(d.path):b(d.path),await new Promise(f=>setTimeout(f,250));i()},onZip:()=>{fe({key:We(),value:JSON.stringify(k.value.map(d=>({path:d})))})}})},K=n=>{n.status==="done"&&setTimeout(()=>{V()},1e3)},_e=n=>{n.forEach(d=>{qe(m.value,f=>f.id===d.id)}),i()},G=n=>{_e([n.item])},H=n=>{V()};return Re(()=>{V(),I.on("upload_task_done",K),I.on("file_deleted",G),I.on("file_renamed",H),window.addEventListener("keydown",O),window.addEventListener("keyup",N)}),Be(()=>{I.off("upload_task_done",K),I.off("file_deleted",G),I.off("file_renamed",H),window.removeEventListener("keydown",O),window.removeEventListener("keyup",N)}),(n,d)=>{const f=te,A=ee,ye=x,Ie=Ts,we=bs,Ee=Y("tooltip");return o(),a(W,null,[l("div",Ls,[v(f,{"touch-target":"wrapper",checked:t($),indeterminate:!t($)&&t(M),onChange:t(ne)},null,8,["checked","indeterminate","onChange"]),t(k).length?(o(),a("span",Vs,r(n.$t("x_selected",{count:t(_)?t(T).toLocaleString():t(k).length.toLocaleString()})),1)):(o(),a("span",As,r(n.$t("recent_files"))+" ("+r(t(T).toLocaleString())+")",1)),t(M)?y((o(),u(ye,{key:2,onClick:p(ke,["stop"])},{default:c(()=>[v(A)]),_:1})),[[Ee,n.$t("download")]]):S("",!0)]),t(L)&&m.value.length===0?(o(),a("div",Ps,[(o(),a(W,null,Me(20,F=>v(Ie,{key:F,index:F,"is-phone":t(g)},null,8,["index","is-phone"])),64))])):S("",!0),m.value.length>0?(o(),u(t(Ne),{key:1,class:"scroller main-list","data-key":"id","data-sources":m.value,"estimate-size":t(g)?120:80},{item:c(({index:F,item:Q})=>[(o(),u(we,{key:Q.id,item:Q,index:F,"selected-ids":t(k),"shift-effecting-ids":t(ie),"should-select":t(re),"is-phone":t(g),"image-error-ids":U.value,"extension-image-error-ids":z.value,"handle-item-click":t(le),"handle-mouse-over":t(ae),"toggle-select":t(oe),"on-image-error":pe,"on-extension-image-error":ve,"download-file":t(b),"click-item":he},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","image-error-ids","extension-image-error-ids","handle-item-click","handle-mouse-over","toggle-select","download-file"]))]),_:1},8,["data-sources","estimate-size"])):S("",!0),!t(L)&&m.value.length===0?(o(),a("div",Rs,r(n.$t(t(Ue)(t(L),t(E).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):S("",!0)],64)}}});export{Ks as default};
