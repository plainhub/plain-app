import{_ as fe}from"./LeftSidebar.vuevuetypescriptsetuptruelang-CKp-4xkn.js";import{_ as he}from"./VDropdownMenu-Z4otLC_Y.js";import{m as se,c as f,o as u,a,d as ae,aD as S,x as X,R as O,A as E,h as M,c0 as j,j as x,v as b,t as h,c1 as _e,aF as me,I as Y,e as Pe,s as ye,f as ge,u as ke,bN as $e,W as Te,r as D,i as Z,q as ee,w as Ce,M as G,aa as te,a8 as we,bP as Se,c2 as Ee,a7 as oe,a1 as H,a0 as V,O as Me,P as be,H as Fe,G as z,a5 as Re,bQ as Ae,D as Be,C as ne,E as Ne,c3 as Le}from"./index-DZRXRZ01.js";import{_ as De}from"./more-vert-0uLzmwy7.js";const Ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ve(c,_){return u(),f("svg",Ge,_[0]||(_[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M3 12a9 9 0 1 0 9-9a9.75 9.75 0 0 0-6.74 2.74L3 8"}),a("path",{d:"M3 3v5h5m4-1v5l4 2"})],-1)]))}const Oe=se({name:"lucide-history",render:Ve}),xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function qe(c,_){return u(),f("svg",xe,_[0]||(_[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M22 12H2m3.45-6.89L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11M6 16h.01M10 16h.01"},null,-1)]))}const Ie=se({name:"lucide-hard-drive",render:qe}),Ue={class:"row"},Qe={class:"content"},je={class:"title-row"},He={class:"left"},ze={class:"icon","aria-hidden":"true"},We={class:"view-raw"},Ke={class:"title"},Je={key:0,class:"chip"},Xe={key:0,class:"progress"},Ye={key:1,class:"stats-row"},Ze={class:"muted"},et=ae({__name:"VolumeCard",props:{title:{type:String,required:!0},sub:{type:String,default:""},driveType:{type:String,default:""},usedPercent:{type:Number,default:0},percentClass:{type:String,default:""},count:{type:String,default:""},active:{type:Boolean,default:!1},showProgress:{type:Boolean,default:!0},data:{type:Object,default:()=>({})}},emits:["click"],setup(c){const _=c,m=S(()=>{const n=Number(_.usedPercent||0);return Number.isFinite(n)?Math.max(0,Math.min(100,n)):0});return(n,d)=>{const q=Ie,F=_e;return u(),f("div",{class:O(["volume-card",{active:c.active}]),role:"button",tabindex:"0",onClick:d[0]||(d[0]=$=>n.$emit("click")),onKeydown:[d[1]||(d[1]=X(E($=>n.$emit("click"),["prevent"]),["enter"])),d[2]||(d[2]=X(E($=>n.$emit("click"),["prevent"]),["space"]))]},[a("div",Ue,[a("div",Qe,[a("div",je,[a("div",He,[a("span",ze,[x(F,null,{content:b(()=>[a("pre",We,h(c.data),1)]),default:b(()=>[x(q)]),_:1})]),a("span",Ke,h(c.title),1),c.driveType?(u(),f("span",Je,h(c.driveType),1)):M("",!0)]),j(n.$slots,"actions")]),c.showProgress?(u(),f("div",Xe,[a("div",{class:"bar",style:me({width:m.value+"%"})},null,4)])):M("",!0),c.showProgress?(u(),f("div",Ye,[a("span",Ze,[j(n.$slots,"count",{},()=>[Y(h(c.count),1)])]),a("span",{class:O(["percent",c.percentClass])},[j(n.$slots,"percent",{},()=>[Y(h(Math.round(m.value))+"%",1)])],2)])):M("",!0)])])],34)}}}),tt={class:"nav"},ot=["onClick"],nt={class:"icon","aria-hidden":"true"},st={class:"title"},at={class:"section-title"},rt={class:"volumes"},it={class:"section-title"},lt={class:"nav"},ut=["onClick"],ct={class:"title"},_t=ae({__name:"FilesSidebar",setup(c){const _=Pe(),{app:m}=ye(ge()),{t:n}=ke(),{mounts:d}=$e(),{parseQ:q}=Se(),F=Te({showHidden:!1,type:"",rootPath:"",text:"",parent:""}),$=D(""),R=D(!1),T=D(!1),A=D(null);function re(){ne(_,"/files/recent")}function ie(t){A.value=t;const r=document.getElementById("favorite-"+t.fullPath);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:r}})),T.value=!0}const{mutate:le,loading:dt}=Z({document:Ee,options:{update:()=>{oe.emit("refetch_app")}}});function ue(t){le({fullPath:t.fullPath}).then(()=>{z(n("removed"))}).catch(r=>{console.error("Error removing favorite folder:",r),z(n("error"),"error")})}function ce(){var g;const t=A.value;if(!t)return;const r=(g=m.value.favoriteFolders)==null?void 0:g.find(y=>y.fullPath===t.fullPath),P=((r==null?void 0:r.alias)||"").trim(),C=()=>Z({document:Le,options:{update:()=>{oe.emit("refetch_app")}}});Re(Ae,{title:n("name"),placeholder:t.title||"",value:P||"",mutation:C,getVariables:y=>({fullPath:t.fullPath,alias:(y||"").trim()}),done:()=>{z(n("saved"))}})}const I=S(()=>{const t=e=>{var v;const s=[...d.value.map(p=>p.mountPoint).filter(Boolean),...((v=m.value.favoriteFolders)==null?void 0:v.map(p=>p.fullPath))||[]];let i="";return s.forEach(p=>{e.startsWith(p)&&p.length>i.length&&(i=p)}),i},r=e=>{const s=(e.alias||"").trim();if(s)return s;const i=d.value.filter(l=>l.driveType==="USB_STORAGE").map(l=>l.mountPoint).filter(Boolean),v=new Map(i.map((l,w)=>[l,w+1])),p=l=>{if(!l)return"";if(l.driveType==="INTERNAL_STORAGE")return n("internal_storage");if(l.driveType==="APP")return n("app_data");if(l.driveType==="SDCARD")return n("sdcard");if(l.driveType==="USB_STORAGE"){const w=v.get(l.mountPoint)??1;return`${n("usb_storage")} ${w}`}return l.name||l.mountPoint},L=(()=>{const l=d.value.find(w=>w.mountPoint===e.rootPath);return p(l)||e.rootPath})(),J=e.fullPath.startsWith(e.rootPath)?e.fullPath.substring(e.rootPath.length).replace(/^\//,""):e.fullPath.split("/").pop()||"";return J?`${L}/${J}`:L},P=(e,s)=>s<=0?"":n("storage_free_total",{free:ee(e),total:ee(s)}),C=(e,s)=>s<=0?0:Math.max(0,s-e)/s*100,g=(e,s)=>{if(e.driveType==="INTERNAL_STORAGE")return n("internal_storage");if(e.driveType==="APP")return n("app_data");if(e.driveType==="SDCARD")return n("sdcard");if(e.driveType==="USB_STORAGE"){const i=s.get(e.mountPoint)??1;return`${n("usb_storage")} ${i}`}return e.name||e.mountPoint},y=R.value?"":t($.value),k=[];k.push({rootPath:"",fullPath:"",type:"RECENTS",title:n("recents"),isChecked:R.value,isFavoriteFolder:!1});const Q=d.value.filter(e=>e.driveType==="USB_STORAGE").map(e=>e.mountPoint).filter(Boolean),B=new Map(Q.map((e,s)=>[e,s+1])),o=e=>e.driveType==="INTERNAL_STORAGE"?0:e.driveType==="SDCARD"?1:e.driveType==="USB_STORAGE"?2:e.driveType==="APP"?3:9;return[...d.value].sort((e,s)=>{const i=o(e),v=o(s);return i!==v?i-v:(e.mountPoint||"").localeCompare(s.mountPoint||"")}).forEach(e=>{const s=e.mountPoint;if(!s)return;const i=Number(e.totalBytes||0),v=Number(e.freeBytes||0);k.push({rootPath:s,fullPath:s,type:e.driveType||"",title:g(e,B),isChecked:y===s,isFavoriteFolder:!1,count:P(v,i),usedPercent:C(v,i),showProgress:i>0})}),m.value.favoriteFolders&&m.value.favoriteFolders.length>0&&m.value.favoriteFolders.forEach((e,s)=>{var p;const i=r(e),v=((p=d.value.find(L=>L.mountPoint===e.rootPath))==null?void 0:p.driveType)??"";k.push({rootPath:e.rootPath,fullPath:e.fullPath,type:v,title:i,isChecked:y===e.fullPath,isFavoriteFolder:!0})}),k}),de=S(()=>I.value.filter(t=>t.type==="RECENTS")),ve=S(()=>I.value.filter(t=>t.type!=="RECENTS"&&!t.isFavoriteFolder)),W=S(()=>I.value.filter(t=>t.isFavoriteFolder));function pe(t){return Math.round(t||0)>=85?"warn":""}function U(t){if(t.type==="RECENTS"){re();return}const r=Be([{name:"parent",op:"",value:t.fullPath},{name:"type",op:"",value:t.type},{name:"root_path",op:"",value:t.rootPath}]);ne(_,`/files?q=${Ne(r)}`)}function K(){var P;const t=te.currentRoute.value;if(t.path==="/files/recent"){R.value=!0;return}R.value=!1;const r=we(((P=t.query.q)==null?void 0:P.toString())??"");q(F,r),$.value=F.parent}return K(),Ce(()=>te.currentRoute.value.fullPath,()=>{K()}),(t,r)=>{const P=Oe,C=De,g=Fe,y=he,k=fe,Q=be("tooltip");return u(),G(k,{class:"files-sidebar"},{body:b(()=>{var B;return[a("ul",tt,[(u(!0),f(V,null,H(de.value,o=>(u(),f("li",{key:o.type,class:O({active:o.isChecked}),onClick:E(N=>U(o),["prevent"])},[a("span",nt,[o.type==="RECENTS"?(u(),G(P,{key:0})):M("",!0)]),a("span",st,h(o.title),1)],10,ot))),128))]),a("div",at,h(t.$t("volumes")),1),a("div",rt,[(u(!0),f(V,null,H(ve.value,o=>(u(),G(et,{key:o.fullPath,title:o.title,count:o.count||"",data:o,"used-percent":o.usedPercent||0,"percent-class":pe(o.usedPercent),active:o.isChecked,"show-progress":o.showProgress,onClick:N=>U(o)},null,8,["title","count","data","used-percent","percent-class","active","show-progress","onClick"]))),128))]),W.value.length?(u(),f(V,{key:0},[a("div",it,h(t.$t("favorites")),1),a("ul",lt,[(u(!0),f(V,null,H(W.value,o=>(u(),f("li",{key:o.fullPath,class:O({active:o.isChecked}),onClick:E(N=>U(o),["prevent"])},[a("span",ct,h(o.title),1),Me((u(),G(g,{id:"favorite-"+o.fullPath,class:"sm",onClick:E(N=>ie(o),["prevent","stop"])},{default:b(()=>[x(C)]),_:2},1032,["id","onClick"])),[[Q,t.$t("actions")]])],10,ut))),128))])],64)):M("",!0),x(y,{modelValue:T.value,"onUpdate:modelValue":r[2]||(r[2]=o=>T.value=o),anchor:"favorite-"+((B=A.value)==null?void 0:B.fullPath)},{default:b(()=>[a("div",{class:"dropdown-item",onClick:r[0]||(r[0]=o=>{ce(),T.value=!1})},h(t.$t("rename")),1),a("div",{class:"dropdown-item",onClick:r[1]||(r[1]=o=>{ue(A.value),T.value=!1})},h(t.$t("remove_from_favorites")),1)]),_:1},8,["modelValue","anchor"])]}),_:1})}}});export{_t as default};
