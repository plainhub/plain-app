var wt=Object.defineProperty;var Ct=(a,e,i)=>e in a?wt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var z=(a,e,i)=>Ct(a,typeof e!="symbol"?e+"":e,i);import{m as Y,c as f,o as r,a as c,cd as Me,ce as bt,r as k,aA as kt,cf as Mt,d as Se,O as _,v,j as y,I as E,t as h,B as qe,aT as St,aS as ye,L as $e,u as Le,G as x,cg as Ee,s as qt,f as $t,W as Te,w as we,g as Lt,i as j,ac as V,X as Et,Y as It,N as Rt,h as H,V as ee,k as b,b2 as Dt,b3 as Ot,ca as Ht,Z as R,a0 as Pt,H as At,ch as Ce,$ as Bt,aC as Vt,T as F,ci as xt,a8 as Qt,cj as Yt,aH as Xt,ab as zt,ck as Gt,cl as Ft,cm as Ut,cn as Wt,co as jt,cp as Nt,cq as Zt,cr as Kt,cs as Jt,ct as en,cu as tn,cv as nn,cw as on,ah as sn}from"./index-BBktiafP.js";import{_ as rn}from"./check-rounded-BvTbiPS6.js";import{t as re}from"./tapphone-CM4k2WfO.js";const an={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function cn(a,e){return r(),f("svg",an,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M10.475 22q-.7 0-1.312-.3t-1.038-.85L3.1 14.475q-.2-.225-.175-.537t.225-.513q.5-.525 1.2-.625t1.3.275L7.5 14.2V6q0-.425.288-.712T8.5 5t.725.288t.3.712v5H17q1.25 0 2.125.875T20 14v4q0 1.65-1.175 2.825T16 22zm1.5-13q-.425 0-.712-.288T10.975 8q0-.05.125-.5q.2-.35.3-.712T11.5 6q0-1.25-.875-2.125T8.5 3t-2.125.875T5.5 6q0 .425.1.788t.3.712q.075.125.1.25t.025.25q0 .425-.275.713T5.05 9q-.275 0-.512-.15t-.363-.375q-.325-.55-.5-1.175T3.5 6q0-2.075 1.463-3.537T8.5 1t3.538 1.463T13.5 6q0 .675-.175 1.3t-.5 1.175q-.125.225-.35.375t-.5.15"},null,-1)]))}const ln=Y({name:"material-symbols-touch-app-rounded",render:cn}),dn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function un(a,e){return r(),f("svg",dn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 19q-2.925 0-4.962-2.037T5 12t2.038-4.962T12 5t4.963 2.038T19 12t-2.037 4.963T12 19"},null,-1)]))}const pn=Y({name:"material-symbols-fiber-manual-record",render:un}),_n={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mn(a,e){return r(),f("svg",_n,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 16V8q0-.825.588-1.412T8 6h8q.825 0 1.413.588T18 8v8q0 .825-.587 1.413T16 18H8q-.825 0-1.412-.587T6 16"},null,-1)]))}const vn=Y({name:"material-symbols-stop-rounded",render:mn}),fn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function hn(a,e){return r(),f("svg",fn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 21q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h14q.825 0 1.413.587Q21 4.175 21 5v14q0 .825-.587 1.413Q19.825 21 19 21Zm0-2h14V5H5v14Zm0 0V5v14Z"},null,-1)]))}const gn=Y({name:"material-symbols-crop-square-outline",render:hn}),yn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tn(a,e){return r(),f("svg",yn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const wn=Y({name:"material-symbols-circle-outline",render:Tn}),Cn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function bn(a,e){return r(),f("svg",Cn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"},null,-1)]))}const kn=Y({name:"material-symbols-fullscreen-rounded",render:bn}),Mn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Sn(a,e){return r(),f("svg",Mn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"},null,-1)]))}const qn=Y({name:"material-symbols-fullscreen-exit-rounded",render:Sn}),$n={xmlns:"http://www.w3.org/2000/svg",viewBox:"176.31 -11.19 346.88 581.88"};function Ln(a,e){return r(),f("svg",$n,e[0]||(e[0]=[c("path",{d:"M470.49 0H229.51a41.9 41.9 0 0 0-29.547 12.277 41.9 41.9 0 0 0-12.277 29.547v476.35a41.9 41.9 0 0 0 12.277 29.547 41.9 41.9 0 0 0 29.547 12.277h240.98a41.9 41.9 0 0 0 29.547-12.277 41.9 41.9 0 0 0 12.277-29.547V41.824a41.9 41.9 0 0 0-12.277-29.547A41.9 41.9 0 0 0 470.49 0m33.25 518.18a33.33 33.33 0 0 1-9.766 23.484 33.34 33.34 0 0 1-23.484 9.766H229.51a33.33 33.33 0 0 1-23.484-9.766 33.34 33.34 0 0 1-9.765-23.484V41.83a33.33 33.33 0 0 1 9.828-23.371 33.32 33.32 0 0 1 23.422-9.703h240.98a33.33 33.33 0 0 1 23.484 9.765 33.34 33.34 0 0 1 9.765 23.484z"},null,-1),c("path",{d:"M317.62 46.812h64.75c2.418 0 4.375-1.957 4.375-4.375s-1.957-4.375-4.375-4.375h-64.75c-2.418 0-4.375 1.957-4.375 4.375s1.957 4.375 4.375 4.375M364.7 192.5a16.8 16.8 0 0 0-14.7-8.75 16.8 16.8 0 0 0-14.698 8.75l-91 157.5a16.45 16.45 0 0 0 0 16.977 16.6 16.6 0 0 0 6.101 6.386 16.65 16.65 0 0 0 8.512 2.364h182.09a16.626 16.626 0 0 0 14.7-8.75 16.8 16.8 0 0 0 0-16.977zm83.562 170.36a8.22 8.22 0 0 1-7.262 4.2H258.91a8.23 8.23 0 0 1-7.176-4.2 8.75 8.75 0 0 1 0-8.75l91-157.5a8.75 8.75 0 0 1 7.262-4.113 8.76 8.76 0 0 1 7.262 4.199l91 157.5a8.75 8.75 0 0 1 0 8.84z"},null,-1),c("path",{d:"M350 221.55a4.29 4.29 0 0 0-4.29 4.285v66.238a4.375 4.375 0 0 0 8.75 0v-66.238a4.286 4.286 0 0 0-4.46-4.285m0 91.26a4.29 4.29 0 0 0-4.29 4.29v17.061a4.375 4.375 0 0 0 8.75 0V317.1a4.286 4.286 0 0 0-4.46-4.29"},null,-1)]))}const En={render:Ln};class In{constructor(e){z(this,"pc",null);z(this,"options");z(this,"audioEnabled",!1);z(this,"remoteDescriptionSet",!1);z(this,"pendingIceCandidates",[]);z(this,"isHandlingOffer",!1);this.options=e}async startSession(e,i=!0){this.audioEnabled=e,this.cleanup(),this.remoteDescriptionSet=!1,this.pendingIceCandidates=[];const o={iceServers:[],iceCandidatePoolSize:0};if(this.pc=new RTCPeerConnection(o),this.pc.ontrack=n=>{try{const d=n.receiver;"jitterBufferTarget"in d&&(d.jitterBufferTarget=0)}catch{}if(n.streams&&n.streams.length>0)this.options.onStream(n.streams[0]);else{const d=new MediaStream;d.addTrack(n.track),this.options.onStream(d)}},this.pc.onicecandidate=n=>{n.candidate&&this.options.sendSignaling({type:"ice_candidate",candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid??void 0,sdpMLineIndex:n.candidate.sdpMLineIndex??void 0})},this.pc.onconnectionstatechange=()=>{this.pc&&this.options.onConnectionStateChange(this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{var n;console.log("ICE connection state:",(n=this.pc)==null?void 0:n.iceConnectionState)},this.pc.addTransceiver("video",{direction:"recvonly"}),e&&this.pc.addTransceiver("audio",{direction:"recvonly"}),i)try{const n=await this.pc.createOffer();await this.pc.setLocalDescription(n),this.options.sendSignaling({type:"offer",sdp:n.sdp,sdpMid:e?"audio_enabled":"audio_disabled"})}catch(n){this.options.onError(`Failed to create offer: ${n}`)}else this.options.sendSignaling({type:"ready"})}async handleOffer(e){if(!this.pc){console.error("PeerConnection not initialized");return}if(this.isHandlingOffer){console.warn("Ignoring offer: already handling one");return}this.isHandlingOffer=!0;try{const i=new RTCSessionDescription({type:"offer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates();const o=await this.pc.createAnswer();await this.pc.setLocalDescription(o),this.options.sendSignaling({type:"answer",sdp:o.sdp})}catch(i){this.options.onError(`Failed to handle offer: ${i}`)}finally{this.isHandlingOffer=!1}}async handleAnswer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"answer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates(),console.log("Remote description (answer) set successfully")}catch(i){this.options.onError(`Failed to set remote description: ${i}`)}}async handleIceCandidate(e,i,o){if(!this.pc){console.error("PeerConnection not initialized");return}if(!this.remoteDescriptionSet){this.pendingIceCandidates.push({candidate:e,sdpMid:i,sdpMLineIndex:o});return}try{await this.pc.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMid:i??"",sdpMLineIndex:o??0}))}catch(n){console.error("Failed to add ICE candidate:",n)}}async flushPendingIceCandidates(){var i;const e=this.pendingIceCandidates;this.pendingIceCandidates=[];for(const o of e)try{await((i=this.pc)==null?void 0:i.addIceCandidate(new RTCIceCandidate({candidate:o.candidate,sdpMid:o.sdpMid??"",sdpMLineIndex:o.sdpMLineIndex??0})))}catch(n){console.error("Failed to add buffered ICE candidate:",n)}}setAudioEnabled(e){var i;if(this.audioEnabled=e,this.pc){const o=this.pc.getReceivers();for(const n of o)((i=n.track)==null?void 0:i.kind)==="audio"&&(n.track.enabled=e)}}isAudioEnabled(){return this.audioEnabled}async handleSignalingMessage(e){switch(e.type){case"offer":e.sdp&&await this.handleOffer(e.sdp);break;case"answer":e.sdp&&await this.handleAnswer(e.sdp);break;case"ice_candidate":e.candidate&&await this.handleIceCandidate(e.candidate,e.sdpMid,e.sdpMLineIndex);break;default:console.warn("Unknown signaling message type:",e.type)}}cleanup(){this.remoteDescriptionSet=!1,this.pendingIceCandidates=[],this.isHandlingOffer=!1,this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close(),this.pc=null)}getConnectionState(){var e;return((e=this.pc)==null?void 0:e.connectionState)??null}}function Rn(a){Me.a.mutate({mutation:bt,variables:{payload:a}}).catch(e=>{console.error("Failed to send WebRTC signaling via GraphQL:",e)})}function G(a){Me.a.mutate({mutation:Mt,variables:{input:a}}).catch(e=>{console.error("Failed to send screen mirror control:",e)})}function ae(a,e,i){const o=i.getBoundingClientRect(),n=i.videoWidth,d=i.videoHeight;if(!n||!d)return null;const m=o.width,T=o.height,M=m/T,I=n/d;let g,S,w,$;I>M?(g=m,S=m/I,w=0,$=(T-S)/2):(S=T,g=T*I,w=(m-g)/2,$=0);const L=a-o.left-w,s=e-o.top-$;return L<0||L>g||s<0||s>S?null:{x:Math.max(0,Math.min(1,L/g)),y:Math.max(0,Math.min(1,s/S))}}const be=500,ce=10;function Dn(a){const e=document.createElement("div");return e.className="touch-indicator",a.appendChild(e),e}function Ie(a,e,i){a.style.left=`${e}px`,a.style.top=`${i}px`}function On(a,e,i){Ie(a,e,i),a.classList.remove("touch-indicator--fade-out"),a.classList.add("touch-indicator--active")}function ke(a,e){e&&a.classList.add("touch-indicator--ripple"),a.classList.remove("touch-indicator--active"),a.classList.add("touch-indicator--fade-out");const i=()=>{a.classList.remove("touch-indicator--fade-out","touch-indicator--ripple"),a.removeEventListener("transitionend",i)};a.addEventListener("transitionend",i,{once:!0})}function Hn(a,e){const i=k();let o=null,n=null;const d=(s,p)=>{const u=i.value;if(!u)return null;const C=u.getBoundingClientRect();return{lx:s-C.left,ly:p-C.top}},m=s=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(s.clientX,s.clientY,p);if(!u)return;s.preventDefault(),s.target.setPointerCapture(s.pointerId),o={startX:u.x,startY:u.y,startClientX:s.clientX,startClientY:s.clientY,startTime:Date.now(),longPressTimer:null,isLongPress:!1,pointerId:s.pointerId};const C=d(s.clientX,s.clientY);C&&n&&On(n,C.lx,C.ly),o.longPressTimer=setTimeout(()=>{o&&(o.isLongPress=!0,n==null||n.classList.add("touch-indicator--long-press"),G({action:"LONG_PRESS",x:o.startX,y:o.startY,duration:be}))},be)},T=s=>{if(!o||!e.value)return;const p=s.clientX-o.startClientX,u=s.clientY-o.startClientY,C=Math.sqrt(p*p+u*u),P=d(s.clientX,s.clientY);P&&n&&Ie(n,P.lx,P.ly),C>ce&&o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null,n==null||n.classList.add("touch-indicator--dragging"))},M=s=>{if(!o||!e.value)return;const p=a.value;if(!p){o=null;return}o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null);const u=s.clientX-o.startClientX,C=s.clientY-o.startClientY,P=Math.sqrt(u*u+C*C),A=Date.now()-o.startTime,q=!o.isLongPress&&P<=ce;if(n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),ke(n,q)),!o.isLongPress)if(P>ce){const Q=ae(s.clientX,s.clientY,p);Q&&G({action:"SWIPE",x:o.startX,y:o.startY,endX:Q.x,endY:Q.y,duration:Math.max(A,100)})}else G({action:"TAP",x:o.startX,y:o.startY});o=null},I=()=>{o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer),n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),ke(n,!1)),o=null},g=s=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(s.clientX,s.clientY,p);u&&(s.preventDefault(),G({action:"SCROLL",x:u.x,y:u.y,deltaX:s.deltaX,deltaY:s.deltaY}))},S=s=>{if(!e.value)return;let p=!0;switch(s.key){case"Escape":case"Backspace":G({action:"BACK"});break;case"Home":G({action:"HOME"});break;default:p=!1}p&&(s.preventDefault(),s.stopPropagation())},w=s=>{n&&n.parentElement&&(n.parentElement.removeChild(n),n=null),i.value=s,s&&(n=Dn(s))},$=()=>{const s=i.value;s&&(s.addEventListener("pointerdown",m),s.addEventListener("pointermove",T),s.addEventListener("pointerup",M),s.addEventListener("pointercancel",I),s.addEventListener("wheel",g,{passive:!1}),s.addEventListener("keydown",S))},L=()=>{const s=i.value;s&&(s.removeEventListener("pointerdown",m),s.removeEventListener("pointermove",T),s.removeEventListener("pointerup",M),s.removeEventListener("pointercancel",I),s.removeEventListener("wheel",g),s.removeEventListener("keydown",S))};return kt(()=>{L(),o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer),n&&n.parentElement&&(n.parentElement.removeChild(n),n=null)}),{overlayRef:i,attachOverlay:w,setupListeners:$,removeListeners:L,sendControl:G}}const Pn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function An(a,e){return r(),f("svg",Pn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 6q-.825 0-1.412-.587T10 4t.588-1.412T12 2t1.413.588T14 4t-.587 1.413T12 6M9 21V9q-1.225-.1-2.475-.275t-2.45-.45q-.425-.1-.687-.475T3.25 7t.525-.625t.85-.1q1.75.375 3.638.55T12 7t3.738-.175t3.637-.55q.45-.1.85.1T20.75 7t-.137.8t-.688.475q-1.2.275-2.45.45T15 9v12q0 .425-.287.713T14 22t-.712-.288T13 21v-5h-2v5q0 .425-.288.713T10 22t-.712-.288T9 21"},null,-1)]))}const Bn=Y({name:"material-symbols-accessibility-new-rounded",render:An}),Vn={class:"accessibility-guide"},xn={class:"guide-icon"},Qn={class:"guide-text"},Yn={class:"guide-steps"},Xn={class:"guide-note"},zn=Se({__name:"AccessibilityGuideModal",props:{onConfirm:{type:Function,default:null}},setup(a){const e=a;function i(){ye()}function o(){var n;ye(),(n=e.onConfirm)==null||n.call(e)}return(n,d)=>{const m=Bn,T=qe,M=St;return r(),_(M,{onClose:i},{headline:v(()=>[E(h(n.$t("remote_control")),1)]),content:v(()=>[c("div",Vn,[c("div",xn,[y(m)]),c("p",Qn,h(n.$t("accessibility_service_required")),1),c("ol",Yn,[c("li",null,h(n.$t("accessibility_step_1")),1),c("li",null,h(n.$t("accessibility_step_2")),1),c("li",null,h(n.$t("accessibility_step_3")),1)]),c("p",Xn,h(n.$t("accessibility_note")),1)])]),actions:v(()=>[y(T,{onClick:o},{default:v(()=>[E(h(n.$t("ok")),1)]),_:1})]),_:1})}}}),Gn=$e(zn,[["__scopeId","data-v-12a0e553"]]);function Fn(a){const{t:e}=Le(),i=k(!1),o=k("00:00");let n=null,d=[],m=null,T=0;const M=()=>{const $=Math.floor((Date.now()-T)/1e3),L=String(Math.floor($/60)).padStart(2,"0"),s=String($%60).padStart(2,"0");o.value=`${L}:${s}`},I=()=>{const $=a.value;if(!$||!$.srcObject){x(e("recording_no_stream"),"error");return}const L=$.srcObject,s=["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4;codecs=avc1.42E01E","video/mp4","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"];let p="";for(const u of s)if(MediaRecorder.isTypeSupported(u)){p=u;break}if(!p){x(e("recording_not_supported"),"error");return}d=[];try{n=new MediaRecorder(L,{mimeType:p,videoBitsPerSecond:5e6})}catch{x(e("recording_not_supported"),"error");return}n.ondataavailable=u=>{u.data.size>0&&d.push(u.data)},n.onstop=()=>{if(d.length===0)return;const u=new Blob(d,{type:p}),C=URL.createObjectURL(u),P=p.startsWith("video/mp4")?"mp4":"webm",A=new Date,q="screen-recording-"+[A.getFullYear(),A.getMonth()+1,A.getDate(),A.getHours(),A.getMinutes(),A.getSeconds()].join("")+"."+P;Ee(C,q),setTimeout(()=>URL.revokeObjectURL(C),1e4),d=[]},n.onerror=()=>{i.value=!1,S(),x(e("recording_failed"),"error")},n.start(1e3),i.value=!0,T=Date.now(),o.value="00:00",m=setInterval(M,1e3)},g=()=>{n&&n.state!=="inactive"&&n.stop(),n=null,i.value=!1,S()},S=()=>{m&&(clearInterval(m),m=null)};return{recording:i,recordingTime:o,toggleRecording:()=>{i.value?g():I()},stopRecording:g}}const Un={class:"screen-mirror"},Wn={class:"title"},jn={key:0,class:"warning-indicator"},Nn={class:"btn-icon warning-icon"},Zn={class:"warning-dropdown"},Kn={class:"warning-content"},Jn={class:"warning-text"},eo={key:1,class:"warning-indicator"},to={class:"btn-icon warning-icon"},no={class:"warning-dropdown"},oo={class:"warning-content"},so={class:"warning-text"},io={class:"warning-actions"},ro={key:1,class:"media-controls"},ao={class:"actions"},co={key:1,class:"check-placeholder"},lo={key:1,class:"check-placeholder"},uo={key:1,class:"check-placeholder"},po={key:0},_o={key:0,class:"request-permission"},mo={class:"tap-phone"},vo={class:"text"},fo={key:1,class:"request-permission-failed"},ho={class:"video-wrapper"},go=Se({__name:"ScreenMirrorView",setup(a){let e;const{t:i}=Le(),{app:o}=qt($t()),n=k(!1),d=k(0),m=k(!1),T=k(!1),M=k(),I=k(!1),g=k("AUTO"),S=k(!1),w=k(!1),$=k(),L=k(!1),s=k(!1),p=k(!1),u=k(!0),C=k(!1),P={AUTO:"mirror_auto",HD:"mirror_hd",SMOOTH:"mirror_smooth"},A=Te(()=>i(P[g.value]||"mirror_auto"));let q=null,Q=null;const{attachOverlay:Re,setupListeners:De,removeListeners:Oe,sendControl:He}=Hn(M,w),{recording:U,recordingTime:Pe,toggleRecording:le}=Fn(M),Ae=[{keys:["Click"],description:"mirror_tap"},{keys:["Click","+","Drag"],description:"mirror_swipe"},{keys:["Scroll"],description:"mirror_scroll"},{keys:["Long press"],description:"mirror_long_press"},{keys:["Esc"],description:"nav_back"},{keys:["Backspace"],description:"nav_back"},{keys:["Home"],description:"nav_home"}],te=t=>{He({action:t})},Be=()=>{const t=M.value;t&&(t.paused?(t.play().catch(()=>{}),p.value=!1):(t.pause(),p.value=!0))},Ve=()=>{const t=M.value;t&&(t.muted=!t.muted,u.value=t.muted)},xe=()=>{const t=document.querySelector(".video-wrapper");t&&(document.fullscreenElement?document.exitFullscreen():t.requestFullscreen())},de=()=>{C.value=!!document.fullscreenElement},Qe=()=>{if(w.value){w.value=!1;return}if(!L.value){zt(Gn,{onConfirm:()=>{ot()}});return}w.value=!0};we($,t=>{Oe(),Re(t),t&&De()});const ue=async()=>{n.value=!0,m.value=!1,d.value=0,clearInterval(e),me()},N=Te(()=>nt.value||Je.value||ne.value||fe.value||T.value);we(M,t=>{t&&Q&&(t.srcObject=Q,t.play().catch(()=>{}),Q=null)});const{mutate:Ye,loading:ne}=j({document:Gt}),Xe=()=>{S.value||(S.value=!0,re(i("confirm_mirror_audio_permission_on_phone")),ze())},{mutate:ze,onDone:Ge,onError:Fe}=j({document:Ft});Fe(t=>{S.value=!1,re(""),x(i(t.message),"error")}),Ge(t=>{var D;((D=t==null?void 0:t.data)==null?void 0:D.requestScreenMirrorAudio)&&(S.value=!1,re(""),V.emit("refetch_app"))});const pe=()=>{window.location.reload()};let Z=null;const{mutate:Ue,loading:We,onDone:je}=j({document:Ut});je(()=>{Z!=null&&(g.value=Z,Z=null),I.value=!1});const oe=t=>{Z=t,Ue({mode:t})},_e=t=>{t&&ne.value&&(clearInterval(e),se())},Ne=()=>{const t=M.value;if(!t)return;const l=document.createElement("canvas");l.width=t.videoWidth,l.height=t.videoHeight;const D=l.getContext("2d");D&&D.drawImage(t,0,0,l.width,l.height);const B=new Date,K="screenshot-"+[B.getFullYear(),B.getMonth()+1,B.getDate(),B.getHours(),B.getMinutes(),B.getSeconds(),B.getMilliseconds()].join("")+".png";Ee(l.toDataURL(),K)},Ze=()=>{q&&q.cleanup(),q=new In({sendSignaling:t=>{Rn(t)},onStream:t=>{T.value=!1;const l=M.value;l?(l.srcObject=t,l.play().catch(()=>{}),n.value=!0,m.value=!1,d.value=0,clearInterval(e)):(Q=t,n.value=!0,m.value=!1,d.value=0,clearInterval(e))},onConnectionStateChange:t=>{t==="connected"?T.value=!1:(t==="failed"||t==="disconnected")&&(T.value=!1,m.value=!0)},onError:t=>{T.value=!1,x(t,"error"),m.value=!0}})},me=()=>{T.value=!0,q==null||q.startSession(!0,!1)},ve=async t=>{q&&await q.handleSignalingMessage(t)};Et(()=>{s.value=!0,V.on("screen_mirroring",ue),V.on("webrtc_signaling",ve),V.on("app_socket_connection_changed",_e),V.on("screen_mirror_audio_granted",pe),document.addEventListener("fullscreenchange",de),Ze()}),It(()=>{s.value=!1,V.off("screen_mirroring",ue),V.off("webrtc_signaling",ve),V.off("app_socket_connection_changed",_e),V.off("screen_mirror_audio_granted",pe),document.removeEventListener("fullscreenchange",de),q&&(q.cleanup(),q=null)});const{mutate:Ke,loading:Je,onDone:et,onError:tt}=j({document:Wt}),{loading:nt}=Lt({handle:(t,l)=>{var D;l?x(i(l),"error"):((D=t==null?void 0:t.screenMirrorQuality)!=null&&D.mode&&(g.value=t.screenMirrorQuality.mode),L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,t.screenMirrorState?me():(n.value=!1,se()))},options:{fetchPolicy:"no-cache"},document:jt}),{fetch:ot}=Rt({handle:t=>{t&&(L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,L.value&&(w.value=!0))},document:Nt,variables:()=>({})}),se=()=>{m.value=!1,Ke({audio:!0})};tt(t=>{x(i(t.message)),m.value=!0}),et(()=>{d.value=30,e=setInterval(()=>{d.value--,d.value<=0&&(m.value=!0,clearInterval(e))},1e3)});const{mutate:st,loading:fe,onDone:it,onError:rt}=j({document:Zt});return rt(t=>{x(i(t.message))}),it(()=>{m.value=!0,n.value=!1,w.value=!1,U.value&&le(),q&&q.cleanup()}),(t,l)=>{const D=Kt,B=Jt,K=Ht,he=qe,at=en,ct=tn,X=At,lt=qn,dt=kn,ut=nn,pt=on,_t=sn,mt=wn,vt=gn,ge=vn,W=Vt,ie=rn,ft=Bt,ht=pn,gt=ln,yt=xt,Tt=Qt,O=Pt("tooltip");return r(),f("div",Un,[s.value?(r(),_(Ce,{key:0,to:"#header-start-slot",defer:""},[c("div",Wn,[E(h(t.$t("screen_mirror"))+" ",1),n.value?(r(),f(ee,{key:0},[b(Dt)(b(Ot).MIRROR_AUDIO,b(o).osVersion)?b(o).permissions.includes("RECORD_AUDIO")?H("",!0):(r(),f("div",eo,[y(K,null,{content:v(()=>[c("div",no,[c("div",oo,[y(B),c("div",so,h(t.$t("mirror_audio_no_permission")),1)]),c("div",io,[y(he,{class:"btn-sm",loading:S.value,onClick:Xe},{default:v(()=>[E(h(t.$t("grant_permission")),1)]),_:1},8,["loading"])])])]),default:v(()=>[c("button",to,[y(D)])]),_:1})])):(r(),f("div",jn,[y(K,null,{content:v(()=>[c("div",Zn,[c("div",Kn,[y(B),c("div",Jn,h(t.$t("mirror_audio_not_supported")),1)])])]),default:v(()=>[c("button",Nn,[y(D)])]),_:1})]))],64)):H("",!0),n.value&&!N.value?(r(),f("div",ro,[R((r(),_(X,{onClick:Be},{default:v(()=>[p.value?(r(),_(at,{key:0})):(r(),_(ct,{key:1}))]),_:1})),[[O,p.value?t.$t("play"):t.$t("pause")]]),R((r(),_(X,{onClick:xe},{default:v(()=>[C.value?(r(),_(lt,{key:0})):(r(),_(dt,{key:1}))]),_:1})),[[O,C.value?t.$t("exit_fullscreen"):t.$t("fullscreen")]]),R((r(),_(X,{onClick:Ve},{default:v(()=>[u.value?(r(),_(ut,{key:0})):(r(),_(pt,{key:1}))]),_:1})),[[O,u.value?t.$t("unmute"):t.$t("mute")]]),w.value?(r(),f(ee,{key:0},[R((r(),_(X,{onClick:l[0]||(l[0]=J=>te("BACK"))},{default:v(()=>[y(_t)]),_:1})),[[O,t.$t("nav_back")]]),R((r(),_(X,{onClick:l[1]||(l[1]=J=>te("HOME"))},{default:v(()=>[y(mt)]),_:1})),[[O,t.$t("nav_home")]]),R((r(),_(X,{onClick:l[2]||(l[2]=J=>te("RECENTS"))},{default:v(()=>[y(vt)]),_:1})),[[O,t.$t("nav_recents")]])],64)):H("",!0)])):H("",!0)])])):H("",!0),s.value?(r(),_(Ce,{key:1,to:"#header-end-slot",defer:""},[c("div",ao,[n.value?(r(),f(ee,{key:0},[R((r(),_(X,{disabled:b(fe),class:"btn-stop",onClick:b(st)},{default:v(()=>[y(ge)]),_:1},8,["disabled","onClick"])),[[O,t.$t("stop_mirror")]]),y(ft,{modelValue:I.value,"onUpdate:modelValue":l[6]||(l[6]=J=>I.value=J),placement:"auto",align:"top-left-to-bottom-left"},{trigger:v(()=>[R((r(),_(W,{class:"btn-sm",loading:b(We)},{default:v(()=>[E(h(A.value),1)]),_:1},8,["loading"])),[[O,t.$t("mirror_quality")]])]),default:v(()=>[c("div",{class:F(["dropdown-item",{active:g.value==="AUTO"}]),onClick:l[3]||(l[3]=()=>oe("AUTO"))},[g.value==="AUTO"?(r(),_(ie,{key:0})):(r(),f("span",co)),E(" "+h(t.$t("mirror_auto")),1)],2),c("div",{class:F(["dropdown-item",{active:g.value==="HD"}]),onClick:l[4]||(l[4]=()=>oe("HD"))},[g.value==="HD"?(r(),_(ie,{key:0})):(r(),f("span",lo)),E(" "+h(t.$t("mirror_hd")),1)],2),c("div",{class:F(["dropdown-item",{active:g.value==="SMOOTH"}]),onClick:l[5]||(l[5]=()=>oe("SMOOTH"))},[g.value==="SMOOTH"?(r(),_(ie,{key:0})):(r(),f("span",uo)),E(" "+h(t.$t("mirror_smooth")),1)],2)]),_:1},8,["modelValue"]),R((r(),_(W,{class:"btn-sm",onClick:Ne},{default:v(()=>[E(h(t.$t("screenshot")),1)]),_:1})),[[O,t.$t("screenshot")]]),R((r(),_(W,{class:F(["btn-sm",{active:b(U)}]),onClick:b(le)},{default:v(()=>[b(U)?(r(),_(ge,{key:1})):(r(),_(ht,{key:0})),E(" "+h(b(U)?b(Pe):t.$t("start_recording")),1)]),_:1},8,["class","onClick"])),[[O,b(U)?t.$t("stop_recording"):t.$t("start_recording")]]),b(o).channel!=="GOOGLE"?R((r(),_(W,{key:0,class:F(["btn-sm",{active:w.value}]),onClick:Qe},{default:v(()=>[y(gt),E(" "+h(t.$t("remote_control")),1)]),_:1},8,["class"])),[[O,w.value?t.$t("disable_control"):t.$t("enable_control")]]):H("",!0),y(yt,{shortcuts:Ae})],64)):b(ne)?H("",!0):(r(),_(W,{key:1,class:"btn-sm",onClick:b(Ye)},{default:v(()=>[E(h(t.$t("relaunch_app")),1)]),_:1},8,["onClick"]))])])):H("",!0),c("div",{class:F(["content",{"content-centered":!n.value||N.value||!w.value}])},[N.value?(r(),f("div",po,[y(Tt,{indeterminate:""})])):(r(),f(ee,{key:1},[d.value>0?(r(),f("div",_o,[c("div",mo,[y(b(Yt))]),c("pre",vo,h(t.$t("screen_mirror_request_permission",{seconds:d.value})),1)])):H("",!0),m.value&&!n.value?(r(),f("div",fo,[y(b(En)),c("p",null,h(t.$t("screen_mirror_request_permission_failed")),1),y(he,{onClick:se},{default:v(()=>[E(h(t.$t("try_again")),1)]),_:1})])):H("",!0)],64)),R(c("div",ho,[c("video",{ref_key:"videoRef",ref:M,class:"video",autoplay:"",playsinline:"",muted:""},null,512),w.value?(r(),f("div",{key:0,ref_key:"controlOverlayRef",ref:$,class:"control-overlay",tabindex:"0"},null,512)):H("",!0)],512),[[Xt,n.value&&!N.value]])],2)])}}}),bo=$e(go,[["__scopeId","data-v-843a4fc6"]]);export{bo as default};
