import{d as Z,e as J,s as ee,f as se,r as u,u as te,X as ae,N as oe,w as ne,Y as le,Z as re,c as v,o as r,a as t,h as y,O as b,t as i,j as C,$ as D,v as m,a0 as ie,a1 as ce,A as L,k as a,W as I,U as z,a2 as de,a3 as ue,a4 as _e,a5 as ve,a6 as me,T as $,H as pe,a7 as fe,G as ge,a8 as he,a9 as ye,I as x,aa as be,ab as Ce,C as Se,ac as ke,ad as R,Q as we,L as De}from"./index-9yvO6RpE.js";import{_ as $e}from"./FieldId.vuevuetypescriptsetuptruelang-RirpqDM0.js";import{_ as Te,S as Ae}from"./SendSmsModal-C1w-qOrx.js";import{u as Me}from"./contacts-B8YjyGp3.js";/* empty css                                                             */const qe={class:"top-app-bar"},Ee={class:"title"},Ne={class:"actions"},Ve=["onClick"],Be={key:0,class:"scroller"},Le=["href","onClick"],Ie={class:"title"},ze={class:"number"},xe={class:"text"},Re={class:"count"},We={class:"time"},Qe={class:"subtitle"},Ge={key:2,class:"no-data-placeholder"},T=50,He=Z({__name:"MessagesSidebar2",setup(Ue){const c=J(),{app:W}=ee(se()),S=u(!1),Q=[{label:"sort_by.date_desc",value:"DATE_DESC"},{label:"sort_by.date_asc",value:"DATE_ASC"}],{t:G}=te(),_=me(),f=u(1),A=u(0),g=u(!1),d=u([]),{loadContacts:H,getDisplayName:p}=Me(),U=ae(()=>{const e=[...d.value];switch(c.conversationSortBy){case"DATE_ASC":return e.sort((s,n)=>new Date(s.date).getTime()-new Date(n.date).getTime());case"NAME_ASC":return e.sort((s,n)=>p(s.address).localeCompare(p(n.address)));case"NAME_DESC":return e.sort((s,n)=>p(n.address).localeCompare(p(s.address)));default:return e.sort((s,n)=>new Date(n.date).getTime()-new Date(s.date).getTime())}}),{resizeWidth:M}=_e(300,()=>c.sidebar2Width,e=>{c.sidebar2Width=e}),q=u(""),{loading:h,fetch:E}=oe({handle:(e,s)=>{s?ge(G(s),"error"):e&&(e.smsConversations.length<T&&(g.value=!0),f.value===1?d.value=e.smsConversations:d.value=d.value.concat(e.smsConversations),A.value=e.smsConversationCount)},document:fe,variables:()=>({offset:(f.value-1)*T,limit:T,query:q.value})});function j(){g.value||h.value||f.value++}function F(e){const s=_.query.q,n=s?`/messages/${e.id}?q=${s}`:`/messages/${e.id}`;Se(c,n)}function K(){ke(Ae,{number:"",body:""})}const N=()=>{E()},k=u(!1);function V(){var e;q.value=we(((e=_.query.q)==null?void 0:e.toString())??""),f.value=1,g.value=!1,E()}return ne(()=>_.query.q,()=>{k.value&&V()}),le(()=>{k.value=!0,H(),V(),R.on("sms_sent",N)}),re(()=>{k.value=!1,R.off("sms_sent",N)}),(e,s)=>{const n=he,B=pe,O=ie,P=Te,X=$e,Y=ye,w=ce("tooltip");return r(),v("aside",{class:$(["sidebar2",{"sidebar2-full":!a(_).params.threadId}]),style:ve({width:a(_).params.threadId?a(c).sidebar2Width+"px":void 0})},[t("div",qe,[t("div",Ee,[t("span",null,i(e.$t("page_title.conversations"))+" ("+i(A.value.toLocaleString())+")",1)]),t("div",Ne,[C(O,{modelValue:S.value,"onUpdate:modelValue":s[0]||(s[0]=o=>S.value=o)},{trigger:m(()=>[D((r(),b(B,null,{default:m(()=>[C(n)]),_:1})),[[w,e.$t("sort")]])]),default:m(()=>[(r(),v(I,null,z(Q,o=>t("div",{key:o.value,class:$(["dropdown-item",{selected:o.value===a(c).conversationSortBy}]),onClick:l=>{a(c).conversationSortBy=o.value,S.value=!1}},i(e.$t(o.label)),11,Ve)),64))]),_:1},8,["modelValue"]),D((r(),b(B,{onClick:s[1]||(s[1]=L(o=>K(),["stop"]))},{default:m(()=>[C(P)]),_:1})),[[w,e.$t("send_sms")]])])]),a(h)&&d.value.length===0?(r(),v("div",Be,[(r(),v(I,null,z(20,o=>t("section",{key:o,class:"conversation-item selectable-card-skeleton"},s[3]||(s[3]=[t("div",{class:"title"},[t("div",{class:"skeleton-text text lg",style:{width:"50%"}})],-1),t("div",{class:"subtitle"},[t("div",{class:"skeleton-text",style:{width:"60%"}})],-1)]))),64))])):y("",!0),d.value.length>0?(r(),b(a(de),{key:1,class:"scroller","data-key":"id","data-sources":U.value,"estimate-size":80,onTobottom:j},{item:m(({index:o,item:l})=>[t("a",{class:"item-link",href:`/messages/${l.id}`,onClick:L(je=>F(l),["prevent"])},[t("article",{class:$(["conversation-item selectable-card",{selected:l.id==a(_).params.threadId}])},[t("div",Ie,[t("span",ze,[C(X,{id:o+1,raw:l},null,8,["id","raw"])]),t("div",xe,[x(i(a(p)(l.address)),1),t("span",Re,"("+i(l.messageCount.toLocaleString())+")",1)]),D((r(),v("span",We,[x(i(a(Ce)(l.date)),1)])),[[w,a(be)(l.date)]])]),t("div",Qe,i(l.snippet||"-"),1)],2)],8,Le)]),footer:m(()=>[g.value?y("",!0):(r(),b(Y,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources"])):y("",!0),!a(h)&&d.value.length===0?(r(),v("div",Ge,i(e.$t(a(ue)(a(h),a(W).permissions,"READ_SMS"))),1)):y("",!0),t("div",{class:"sidebar-drag-indicator",onMousedown:s[2]||(s[2]=(...o)=>a(M)&&a(M)(...o))},null,32)],6)}}}),Ye=De(He,[["__scopeId","data-v-5334b76a"]]);export{Ye as default};
