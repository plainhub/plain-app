import{_ as be}from"./ListItemPhone.vuevuetypescriptsetuptruelang-D4QL_mFP.js";import{d as R,c as a,M as u,o,A as p,R as $e,a as l,j as v,bH as D,k as t,aO as Z,t as r,O as y,q as X,P as W,U as Y,I as P,V as j,H as x,v as c,ao as ee,bG as Fe,c1 as Se,L as se,N as Ce,u as De,r as S,f as Te,s as Le,i as Ve,aA as Ae,Y as Pe,Z as Re,$ as Me,h as C,a0 as q,a1 as Be,c4 as Oe,bz as ze,a2 as Ne,bT as Ue,c5 as Ge,G as J,bS as He,bX as Ke,ax as Qe,bY as Ze,bZ as Xe,a5 as Ye,a7 as I,b_ as je,b$ as qe}from"./index-DZRXRZ01.js";import{_ as Je}from"./FieldId.vuevuetypescriptsetuptruelang-BK6GHXRD.js";import{_ as te}from"./VCheckbox-C3ZwVFMw.js";import{_ as We,u as xe,c as es}from"./key-events-D0AKm23A.js";import{_ as ss}from"./DownloadMethodModal.vuevuetypescriptsetuptruelang-DlnhhHoK.js";const ts={class:"start"},ns={class:"number"},os={key:0,class:"svg",src:D},is=["src"],ls=["src"],as={key:3,class:"svg",src:D},ds={class:"title"},rs={class:"subtitle"},cs={class:"actions"},ms={class:"card card-info"},us={class:"key-value vertical"},ps={class:"key"},vs={class:"value"},fs={key:0,class:"svg",src:D},gs=["src"],hs=["src"],ks={key:3,class:"svg",src:D},_s={class:"actions"},ys={class:"card card-info"},Is={class:"key-value vertical"},ws={class:"key"},Es={class:"value"},bs=R({__name:"FileRecentItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},imageErrorIds:{},extensionImageErrorIds:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},onImageError:{type:Function},onExtensionImageError:{type:Function},downloadFile:{type:Function},clickItem:{type:Function}},setup(M){return(e,s)=>{const g=te,w=Je,E=ee,h=x,m=Fe,k=Se,b=be,_=W("tooltip");return e.isPhone?(o(),u(b,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:s[12]||(s[12]=i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item))),onMouseenter:s[13]||(s[13]=p(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:s[14]||(s[14]=i=>e.toggleSelect(i,e.item,e.index))},{image:c(()=>[l("div",{class:"image",onClick:s[10]||(s[10]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",fs)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[8]||(s[8]=i=>e.onImageError(e.item.id))},null,40,gs)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[9]||(s[9]=i=>e.onExtensionImageError(e.item.id))},null,40,hs)):(o(),a("img",ks))])]),title:c(()=>[P(r(e.item.name),1)]),subtitle:c(()=>[l("span",null,r(t(X)(e.item.size)),1),y((o(),a("span",null,[P(r(t(j)(e.item.updatedAt)),1)])),[[_,t(Y)(e.item.updatedAt)]])]),actions:c(()=>[l("div",_s,[y((o(),u(h,{onClick:s[11]||(s[11]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ys,[l("div",Is,[l("div",ws,r(e.$t("path")),1),l("div",Es,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),a("section",{key:0,class:$e(["file-item recent-file-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:s[6]||(s[6]=p(i=>e.handleItemClick(i,e.item,e.index,()=>e.clickItem(e.item)),["stop"])),onMouseenter:s[7]||(s[7]=p(i=>e.handleMouseOver(i,e.index),["stop"]))},[l("div",ts,[e.shiftEffectingIds.includes(e.item.id)?(o(),u(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:s[0]||(s[0]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),u(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:s[1]||(s[1]=p(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),l("span",ns,[v(w,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),l("div",{class:"image",onClick:s[4]||(s[4]=p(i=>e.clickItem(e.item),["stop"]))},[e.extensionImageErrorIds.includes(e.item.id)?(o(),a("img",os)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(o(),a("img",{key:1,class:"image-thumb",src:t(Z)(e.item.fileId,"&w=50&h=50"),onError:s[2]||(s[2]=i=>e.onImageError(e.item.id))},null,40,is)):e.item.extension?(o(),a("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:s[3]||(s[3]=i=>e.onExtensionImageError(e.item.id))},null,40,ls)):(o(),a("img",as))]),l("div",ds,r(e.item.name),1),l("div",rs,[l("span",null,r(t(X)(e.item.size)),1),y((o(),a("span",null,[P(r(t(j)(e.item.updatedAt)),1)])),[[_,t(Y)(e.item.updatedAt)]])]),l("div",cs,[y((o(),u(h,{onClick:s[5]||(s[5]=p(i=>e.downloadFile(e.item.path),["stop"]))},{default:c(()=>[v(E)]),_:1})),[[_,e.$t("download")]]),v(k,null,{content:c(()=>[l("section",ms,[l("div",us,[l("div",ps,r(e.$t("path")),1),l("div",vs,r(e.item.path),1)])])]),default:c(()=>[y((o(),u(h,null,{default:c(()=>[v(m)]),_:1})),[[_,e.$t("info")]])]),_:1})])],34))}}}),$s=se(bs,[["__scopeId","data-v-7ca2e29e"]]),Fs={key:0,class:"file-item recent-file-item selectable-card-skeleton"},Ss={class:"start"},Cs={class:"number"},Ds=R({__name:"FileRecentSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(M){return(e,s)=>{const g=We;return e.isPhone?(o(),u(g,{key:1,"title-width":"60%",subtitles:[{width:"45%"},{width:"40%"}],"action-count":2})):(o(),a("section",Fs,[l("div",Ss,[s[0]||(s[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",Cs,r(e.index),1)]),s[1]||(s[1]=Ce('<div class="image" data-v-777f0631><div class="skeleton-image lg" data-v-777f0631></div></div><div class="title" data-v-777f0631><div class="skeleton-text lg" style="width:40%;" data-v-777f0631></div></div><div class="subtitle" data-v-777f0631><div class="skeleton-text" style="width:30%;" data-v-777f0631></div></div><div class="actions" data-v-777f0631><div class="skeleton-text lg" style="width:80px;" data-v-777f0631></div></div>',4))]))}}}),Ts=se(Ds,[["__scopeId","data-v-777f0631"]]),Ls={class:"top-app-bar"},Vs={key:0},As={key:1},Ps={key:0,class:"scroller main-list"},Rs={key:2,class:"no-data-placeholder"},Gs=R({__name:"FilesRecentView",setup(M){const{t:e}=De(),s=S([]),g=Oe(),w=Te(),{app:E,urlTokenKey:h}=Le(w),m=S([]),{selectedIds:k,allChecked:b,realAllChecked:_,clearSelection:i,toggleAllChecked:ne,toggleSelect:oe,total:T,checked:B,shiftEffectingIds:ie,handleItemClick:le,handleMouseOver:ae,selectAll:de,shouldSelect:re}=xe(m),{downloadFile:$,downloadFiles:ce,downloadDir:me}=Ae(h),{view:ue}=Xe(s,(n,d)=>{w.lightbox={sources:n,index:d,visible:!0}}),{keyDown:O,keyUp:z}=es(de,i,()=>{}),N=S([]),U=S([]),pe=n=>{N.value.push(n)},ve=n=>{U.value.push(n)},{mutate:fe,onDone:ge}=Ve({document:Ue});ge(n=>{ce(n.data.setTempValue.key),i()});const he=n=>{Ke(n.name)?window.open(Qe(h.value,n.path),"_blank"):Ze(n.name)?ue(m.value,n):$(n.path)},{loading:L,fetch:V}=Pe({handle:async(n,d)=>{if(d)J(e(d),"error");else{const f=[];for(const A of n.recentFiles)f.push(He(A,h.value));m.value=f,T.value=f.length}},document:Ge}),ke=()=>{const n=m.value.filter(d=>k.value.includes(d.id));if(n.length===0){J(e("select_first"),"error");return}if(n.length===1&&!n[0].isDir){$(n[0].path),i();return}Ye(ss,{onEach:async()=>{for(const d of n)d.isDir?me(d.path):$(d.path),await new Promise(f=>setTimeout(f,250));i()},onZip:()=>{fe({key:qe(),value:JSON.stringify(k.value.map(d=>({path:d})))})}})},G=n=>{n.status==="done"&&setTimeout(()=>{V()},1e3)},_e=n=>{n.forEach(d=>{je(m.value,f=>f.id===d.id)}),i()},H=n=>{_e([n.item])},K=n=>{V()};return Re(()=>{V(),I.on("upload_task_done",G),I.on("file_deleted",H),I.on("file_renamed",K),window.addEventListener("keydown",O),window.addEventListener("keyup",z)}),Me(()=>{I.off("upload_task_done",G),I.off("file_deleted",H),I.off("file_renamed",K),window.removeEventListener("keydown",O),window.removeEventListener("keyup",z)}),(n,d)=>{const f=te,A=ee,ye=x,Ie=Ts,we=$s,Ee=W("tooltip");return o(),a(q,null,[l("div",Ls,[v(f,{"touch-target":"wrapper",checked:t(b),indeterminate:!t(b)&&t(B),onChange:t(ne)},null,8,["checked","indeterminate","onChange"]),t(k).length?(o(),a("span",Vs,r(n.$t("x_selected",{count:t(_)?t(T).toLocaleString():t(k).length.toLocaleString()})),1)):(o(),a("span",As,r(n.$t("recent_files"))+" ("+r(t(T).toLocaleString())+")",1)),t(B)?y((o(),u(ye,{key:2,onClick:p(ke,["stop"])},{default:c(()=>[v(A)]),_:1})),[[Ee,n.$t("download")]]):C("",!0)]),t(L)&&m.value.length===0?(o(),a("div",Ps,[(o(),a(q,null,Be(20,F=>v(Ie,{key:F,index:F,"is-phone":t(g)},null,8,["index","is-phone"])),64))])):C("",!0),m.value.length>0?(o(),u(t(ze),{key:1,class:"scroller main-list","data-key":"id","data-sources":m.value,"estimate-size":t(g)?120:80},{item:c(({index:F,item:Q})=>[(o(),u(we,{key:Q.id,item:Q,index:F,"selected-ids":t(k),"shift-effecting-ids":t(ie),"should-select":t(re),"is-phone":t(g),"image-error-ids":N.value,"extension-image-error-ids":U.value,"handle-item-click":t(le),"handle-mouse-over":t(ae),"toggle-select":t(oe),"on-image-error":pe,"on-extension-image-error":ve,"download-file":t($),"click-item":he},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","image-error-ids","extension-image-error-ids","handle-item-click","handle-mouse-over","toggle-select","download-file"]))]),_:1},8,["data-sources","estimate-size"])):C("",!0),!t(L)&&m.value.length===0?(o(),a("div",Rs,r(n.$t(t(Ne)(t(L),t(E).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):C("",!0)],64)}}});export{Gs as default};
