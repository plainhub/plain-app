import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-kPHvuCyd.js";import{_ as ae}from"./print-outline-rounded-CRuHjfW2.js";import{by as ne,bz as z,bA as oe,d as se,e as ie,u as ue,r as T,s as re,f as le,g as ce,N as de,i as _e,bB as me,az as fe,a5 as ve,ac as $,aA as pe,c as F,o as y,a as b,Z as x,a0 as ge,O as S,v as B,A as Q,I as G,h as O,t as he,k as P,aH as Te,j as C,au as ye,V as j,w as be,a9 as ke,H as we,bC as Ce,G as K,bD as Ne,bE as Ee,ah as Le,ai as Me,P as $e,C as xe,ab as Se,an as Ve,bF as Ie,L as De}from"./index-DUFKAMTy.js";import{_ as Ae}from"./FieldId.vuevuetypescriptsetuptruelang-Dhult7CA.js";import{u as Re}from"./markdown-JnZ-jxFo.js";var U=function(){return ne.Date.now()},He="Expected a function",Be=Math.max,Qe=Math.min;function Ue(V,r,u){var d,n,o,i,s,l,m=0,E=!1,f=!1,v=!0;if(typeof V!="function")throw new TypeError(He);r=z(r)||0,oe(u)&&(E=!!u.leading,f="maxWait"in u,o=f?Be(z(u.maxWait)||0,r):o,v="trailing"in u?!!u.trailing:v);function k(a){var c=d,e=n;return d=n=void 0,m=a,i=V.apply(e,c),i}function L(a){return m=a,s=setTimeout(_,r),E?k(a):i}function I(a){var c=a-l,e=a-m,t=r-c;return f?Qe(t,o-e):t}function p(a){var c=a-l,e=a-m;return l===void 0||c>=r||c<0||f&&e>=o}function _(){var a=U();if(p(a))return M(a);s=setTimeout(_,I(a))}function M(a){return s=void 0,v&&d?k(a):(d=n=void 0,i)}function D(){s!==void 0&&clearTimeout(s),m=0,d=l=n=s=void 0}function A(){return s===void 0?i:M(U())}function w(){var a=U(),c=p(a);if(d=arguments,n=this,l=a,c){if(s===void 0)return L(l);if(f)return clearTimeout(s),s=setTimeout(_,r),k(l)}return s===void 0&&(s=setTimeout(_,r)),i}return w.cancel=D,w.flush=A,w}const We={class:"top-app-bar"},qe={class:"title"},ze={class:"state-point"},Fe={class:"actions"},Ge={class:"panel-container"},Oe=["innerHTML"],N="NOTE",Pe=se({__name:"NoteEditView",setup(V){const r=ie(),{t:u}=ue(),d=ve(),n=T(""),o=T(),i=T(""),s=T(""),l=T(!1),{app:m,urlTokenKey:E}=re(le());function f(){const e=$e.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),xe(r,t)}const{render:v}=Re(m,E),k=Ue(()=>{l.value=!1,M({id:n.value,input:{content:i.value,title:Ie(i.value,{length:250,omission:""})}})},500),L=()=>{be(i,async e=>{l.value=!0,s.value=await v(e),k()})},I=()=>{window.print()},p=T();ce({handle:(e,t)=>{t?K(u(t),"error"):e&&(p.value=e.tags)},document:Ce,variables:{type:N}});const{fetch:_}=de({handle:async(e,t)=>{t?K(u(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await v(i.value),L())},document:Ne,variables:()=>({id:n.value}),options:{fetchPolicy:"no-cache"}}),{mutate:M,onDone:D}=_e({document:Ee});D(e=>{var t,g;o.value=e.data.saveNote,!n.value&&((t=o.value)!=null&&t.id)&&(n.value=(g=o.value)==null?void 0:g.id,me(r,`/notes/${n.value}`))});function A(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Se(Ve,{type:N,tags:p.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=p.value)==null?void 0:t.filter(g=>{var h;return(h=o.value)==null?void 0:h.tags.some(R=>R.id===g.id)})})}const a=e=>{e.type===N&&_()},c=e=>{e.type===N&&_()};return fe(()=>{n.value=d.params.id,n.value==="create"&&(n.value=""),n.value?_():L(),$.on("item_tags_updated",c),$.on("items_tags_updated",a)}),pe(()=>{$.off("item_tags_updated",c),$.off("items_tags_updated",a)}),(e,t)=>{var W,q;const g=Le,h=we,R=Ae,X=ye,Z=Me,J=ae,Y=te,H=ge("tooltip");return y(),F(j,null,[b("div",We,[x((y(),S(h,{onClick:Q(f,["prevent"])},{default:B(()=>[C(g)]),_:1})),[[H,e.$t("back")]]),b("div",qe,[G(he(n.value?P(u)("edit"):P(u)("create"))+" ",1),x(b("span",ze,"*",512),[[Te,l.value]]),t[1]||(t[1]=G()),(W=o.value)!=null&&W.updatedAt?(y(),S(R,{key:0,id:A(),class:"time",raw:o.value},null,8,["id","raw"])):O("",!0)]),b("div",Fe,[C(X,{tags:(q=o.value)==null?void 0:q.tags,type:N,"only-links":!0},null,8,["tags"]),n.value?(y(),F(j,{key:0},[x((y(),S(h,{onClick:Q(w,["prevent"])},{default:B(()=>[C(Z)]),_:1})),[[H,e.$t("add_to_tags")]]),x((y(),S(h,{onClick:Q(I,["prevent"])},{default:B(()=>[C(J)]),_:1})),[[H,e.$t("print")]])],64)):O("",!0)])]),b("div",Ge,[C(Y,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=ee=>i.value=ee),language:"html"},null,8,["modelValue"]),b("div",{class:"md-container",innerHTML:s.value},null,8,Oe)])],64)}}}),Ye=De(Pe,[["__scopeId","data-v-2c4e12eb"]]);export{Ye as default};
