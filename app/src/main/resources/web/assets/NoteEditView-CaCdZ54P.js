import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BdIvFslw.js";import{_ as ae}from"./print-outline-rounded-DmFnQkj3.js";import{bB as ne,bC as q,bD as oe,d as se,e as ie,u as ue,r as T,s as re,f as le,g as ce,N as de,i as _e,bE as me,az as fe,a6 as ve,ac as M,aA as pe,c as F,o as b,a as y,$ as x,a1 as ge,O as I,v as W,A as B,I as O,h as P,t as he,k as z,aJ as Te,j as C,au as be,W as j,w as ye,a9 as ke,H as we,bF as Ce,G as J,bG as Ne,bH as $e,ah as Ee,ai as Le,P as Me,C as xe,ab as Ie,an as Se,bI as Ve,L as De}from"./index-Bsb9VlRU.js";import{_ as Re}from"./FieldId.vuevuetypescriptsetuptruelang-BY8t1FUN.js";import{u as Ae}from"./markdown-DfLOb5Rg.js";var G=function(){return ne.Date.now()},He="Expected a function",We=Math.max,Be=Math.min;function Ge(S,r,u){var d,n,o,i,s,l,m=0,$=!1,f=!1,v=!0;if(typeof S!="function")throw new TypeError(He);r=q(r)||0,oe(u)&&($=!!u.leading,f="maxWait"in u,o=f?We(q(u.maxWait)||0,r):o,v="trailing"in u?!!u.trailing:v);function k(a){var c=d,e=n;return d=n=void 0,m=a,i=S.apply(e,c),i}function E(a){return m=a,s=setTimeout(_,r),$?k(a):i}function V(a){var c=a-l,e=a-m,t=r-c;return f?Be(t,o-e):t}function p(a){var c=a-l,e=a-m;return l===void 0||c>=r||c<0||f&&e>=o}function _(){var a=G();if(p(a))return L(a);s=setTimeout(_,V(a))}function L(a){return s=void 0,v&&d?k(a):(d=n=void 0,i)}function D(){s!==void 0&&clearTimeout(s),m=0,d=l=n=s=void 0}function R(){return s===void 0?i:L(G())}function w(){var a=G(),c=p(a);if(d=arguments,n=this,l=a,c){if(s===void 0)return E(l);if(f)return clearTimeout(s),s=setTimeout(_,r),k(l)}return s===void 0&&(s=setTimeout(_,r)),i}return w.cancel=D,w.flush=R,w}const Qe={class:"top-app-bar"},Ue={class:"title"},qe={class:"state-point"},Fe={class:"actions"},Oe={class:"panel-container"},Pe=["innerHTML"],N="NOTE",ze=se({__name:"NoteEditView",setup(S){const r=ie(),{t:u}=ue(),d=ve(),n=T(""),o=T(),i=T(""),s=T(""),l=T(!1),{app:m,urlTokenKey:$}=re(le());function f(){const e=Me.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),xe(r,t)}const{render:v}=Ae(m,$),k=Ge(()=>{l.value=!1,L({id:n.value,input:{content:i.value,title:Ve(i.value,{length:250,omission:""})}})},500),E=()=>{ye(i,async e=>{l.value=!0,s.value=await v(e),k()})},V=()=>{window.print()},p=T();ce({handle:(e,t)=>{t?J(u(t),"error"):e&&(p.value=e.tags)},document:Ce,variables:{type:N}});const{fetch:_}=de({handle:async(e,t)=>{t?J(u(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await v(i.value),E())},document:Ne,variables:()=>({id:n.value}),options:{fetchPolicy:"no-cache"}}),{mutate:L,onDone:D}=_e({document:$e});D(e=>{var t,g;o.value=e.data.saveNote,!n.value&&((t=o.value)!=null&&t.id)&&(n.value=(g=o.value)==null?void 0:g.id,me(r,`/notes/${n.value}`))});function R(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Ie(Se,{type:N,tags:p.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=p.value)==null?void 0:t.filter(g=>{var h;return(h=o.value)==null?void 0:h.tags.some(A=>A.id===g.id)})})}const a=e=>{e.type===N&&_()},c=e=>{e.type===N&&_()};return fe(()=>{n.value=d.params.id,n.value==="create"&&(n.value=""),n.value?_():E(),M.on("item_tags_updated",c),M.on("items_tags_updated",a)}),pe(()=>{M.off("item_tags_updated",c),M.off("items_tags_updated",a)}),(e,t)=>{var Q,U;const g=Ee,h=we,A=Re,K=be,X=Le,Y=ae,Z=te,H=ge("tooltip");return b(),F(j,null,[y("div",Qe,[x((b(),I(h,{onClick:B(f,["prevent"])},{default:W(()=>[C(g)]),_:1})),[[H,e.$t("back")]]),y("div",Ue,[O(he(n.value?z(u)("edit"):z(u)("create"))+" ",1),x(y("span",qe,"*",512),[[Te,l.value]]),t[1]||(t[1]=O()),(Q=o.value)!=null&&Q.updatedAt?(b(),I(A,{key:0,id:R(),class:"time",raw:o.value},null,8,["id","raw"])):P("",!0)]),y("div",Fe,[C(K,{tags:(U=o.value)==null?void 0:U.tags,type:N,"only-links":!0},null,8,["tags"]),n.value?(b(),F(j,{key:0},[x((b(),I(h,{onClick:B(w,["prevent"])},{default:W(()=>[C(X)]),_:1})),[[H,e.$t("add_to_tags")]]),x((b(),I(h,{onClick:B(V,["prevent"])},{default:W(()=>[C(Y)]),_:1})),[[H,e.$t("print")]])],64)):P("",!0)])]),y("div",Oe,[C(Z,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=ee=>i.value=ee),language:"html"},null,8,["modelValue"]),y("div",{class:"md-container",innerHTML:s.value},null,8,Pe)])],64)}}}),Ze=De(ze,[["__scopeId","data-v-2c4e12eb"]]);export{Ze as default};
