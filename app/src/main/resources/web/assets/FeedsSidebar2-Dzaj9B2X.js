import{d as pe,c as d,M as r,o as n,a as o,t as g,u as fe,r as k,Y as me,cA as Ke,G as D,e as We,s as He,f as je,W as Oe,X as Ye,aD as ie,aa as ce,i as de,w as Xe,Z as Ze,$ as Je,j as c,h as E,k as e,a0 as re,O as q,P as et,v as S,A as f,a1 as tt,bz as st,a2 as ot,cz as nt,aF as at,a4 as lt,H as it,cB as ct,cC as dt,cD as rt,ac as ut,Q as _t,K as pt,am as ft,R as mt,U as vt,I as ht,V as gt,T as kt,aO as yt,C as ue,a7 as h,a8 as bt,a9 as wt,cE as $t,L as Ct}from"./index-DZRXRZ01.js";import{_ as St}from"./more-vert-0uLzmwy7.js";import{_ as Tt}from"./FieldId.vuevuetypescriptsetuptruelang-BK6GHXRD.js";import{_ as Lt,u as Ft,b as It,a as Et}from"./key-events-D0AKm23A.js";import{_ as qt}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-DqpooIVK.js";import{_ as Dt,a as At}from"./add-notes-outline-rounded-DqJHTe4L.js";import{_ as Mt}from"./VCheckbox-C3ZwVFMw.js";import{u as Nt}from"./feeds-CIVw1QWQ.js";import{a as Pt}from"./tags-DKSnvtHt.js";const Qt={key:0,class:"feed-item selectable-card-skeleton"},Rt={class:"subtitle"},zt={class:"number"},Bt=pe({__name:"FeedSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(A){return(T,l)=>{const y=Lt;return T.isPhone?(n(),r(y,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":3})):(n(),d("section",Qt,[l[1]||(l[1]=o("div",{class:"title"},[o("div",{class:"skeleton-checkbox"}),o("div",{class:"skeleton-text text lg",style:{width:"50%"}})],-1)),o("div",Rt,[o("span",zt,g(T.index),1),l[0]||(l[0]=o("div",{class:"info"},[o("div",{class:"skeleton-text",style:{width:"30%"}})],-1))]),l[2]||(l[2]=o("div",{class:"image"},[o("div",{class:"skeleton-image lg"})],-1))]))}}}),Ut=(A,T,l)=>{const{t:y}=fe(),u=k(1),M=100,N=k(!1),{loading:_,fetch:b}=me({handle:(m,P)=>{if(P)D(y(P),"error");else if(m){m.items.length<M&&(N.value=!0);const Q=m.items;u.value===1?A.value=Q:A.value=A.value.concat(Q),l.value=m.total}},document:Ke,variables:()=>({offset:(u.value-1)*M,limit:M,query:T.value})});return{page:u,noMore:N,loading:_,fetch:b,loadMore:()=>{N.value||_.value||u.value++}}},Vt={class:"top-app-bar"},Gt={class:"title"},xt={key:0},Kt={key:1},Wt={class:"actions"},Ht={key:0,class:"scroller"},jt=["href"],Ot=["onClick","onMouseenter"],Yt={class:"title"},Xt={class:"text"},Zt={class:"subtitle"},Jt={class:"number"},es={class:"info"},ts=["onClick"],ss={class:"time"},os=["src"],ns={key:2,class:"no-data-placeholder"},_e=100,as=pe({__name:"FeedsSidebar2",setup(A){const T=pt("isPhone"),l=We(),{feedsSyncing:y}=He(je()),{t:u}=fe(),M=Oe({tagIds:[]}),{parseQ:N}=wt(),_=Ye.FEED_ENTRY,b=lt(),m=k(1),P=k([]),Q=k([]),G=ie(()=>{const t={};return Q.value.forEach(s=>{t[s.id]=s}),t}),w=k([]),$=k(""),{selectedIds:p,allChecked:x,realAllChecked:L,selectRealAll:ve,allCheckedAlertVisible:he,clearSelection:B,toggleAllChecked:ge,toggleSelect:K,total:C,checked:W,shiftEffectingIds:H,handleItemClick:ke,handleMouseOver:ye,selectAll:be,shouldSelect:we}=Ft(w),$e=t=>{m.value=t;const s=b.query.q;ue(l,s?`/feeds?page=${t}&q=${s}`:`/feeds?page=${t}`)},{keyDown:j,keyUp:O}=Et(C,_e,m,be,B,$e,()=>{Z(p.value,L.value,C.value,$.value)}),{page:Y,loading:U,loadMore:Ce,fetch:Se,noMore:X}=Ut(w,$,C),{addToTags:Te}=Pt(_,P),R=()=>{Y.value=1,Se()},{deleteItems:Z}=It($t,()=>{B(),R(),w.value.some(t=>t.tags.length)&&h.emit("refetch_tags",_),h.emit("feed_entries_deleted")});ie(()=>ce.currentRoute.value.path!=="/feeds");const{resizeWidth:J}=nt(300,()=>l.sidebar2Width,t=>{l.sidebar2Width=t}),{mutate:ee,loading:Le,onDone:Fe}=de({document:ct});function Ie(){if(L.value)ee({query:$.value});else{if(p.value.length===0){D(u("select_first"),"error");return}ee({query:`ids:${p.value.join(",")}`})}}Fe(()=>{D(u("saved"))});const{fetch:Ee}=me({handle:async(t,s)=>{s?D(u(s),"error"):t&&(P.value=t.tags,Q.value=t.feeds)},document:dt,variables:{type:_}});function te(t){const s=ce.currentRoute.value.query.q;return s?`/feeds/${t.feedId}/entries/${t.id}?q=${s}`:`/feeds/${t.feedId}/entries/${t.id}`}function qe(t){ue(l,te(t))}const{viewFeed:De}=Nt(l),{mutate:Ae}=de({document:rt});function Me(){y.value=!0,Ae({id:""})}const se=t=>{y.value=!1,R(),t.error?D(t.error,"error"):D(u("feeds_synced"))},oe=t=>{t.type===_&&(B(),R())},ne=t=>{t.type===_&&R()},V=k(!1);function ae(){var s,F;const t=parseInt(((s=b.query.page)==null?void 0:s.toString())??"1");m.value=Number.isFinite(t)&&t>0?t:1,$.value=bt(((F=b.query.q)==null?void 0:F.toString())??""),N(M,$.value),R()}return Xe(()=>b.fullPath,()=>{V.value&&ae()}),Ze(()=>{var s;const t=(s=document.getElementsByClassName("scroller"))==null?void 0:s[0];t&&(t.scrollTop=0),Ee(),V.value=!0,ae(),h.on("item_tags_updated",ne),h.on("items_tags_updated",oe),h.on("feeds_fetched",se),window.addEventListener("keydown",j),window.addEventListener("keyup",O)}),Je(()=>{V.value=!1,Y.value=1,X.value=!1,h.off("item_tags_updated",ne),h.off("items_tags_updated",oe),h.off("feeds_fetched",se),window.removeEventListener("keydown",j),window.removeEventListener("keyup",O)}),(t,s)=>{const F=Mt,Ne=ut,z=it,Pe=_t,Qe=Dt,Re=At,ze=qt,Be=Bt,Ue=Tt,Ve=kt,Ge=St,xe=ft,I=et("tooltip");return n(),d("aside",{class:"sidebar2",style:at({width:e(b).params.id?e(l).sidebar2Width+"px":"auto"})},[o("div",Vt,[c(F,{"touch-target":"wrapper",checked:e(x),indeterminate:!e(x)&&e(W),onChange:e(ge)},null,8,["checked","indeterminate","onChange"]),o("div",Gt,[e(p).length?(n(),d("span",xt,g(t.$t("x_selected",{count:e(L)?e(C).toLocaleString():e(p).length.toLocaleString()})),1)):(n(),d("span",Kt,g(t.$t("page_title.feeds"))+" ("+g(e(C).toLocaleString())+")",1)),e(W)?(n(),d(re,{key:2},[q((n(),r(z,{onClick:s[0]||(s[0]=f(i=>e(Z)(e(p),e(L),e(C),$.value),["stop"]))},{default:S(()=>[c(Ne)]),_:1})),[[I,t.$t("delete")]]),q((n(),r(z,{onClick:s[1]||(s[1]=f(i=>e(Te)(e(p),e(L),$.value),["stop"]))},{default:S(()=>[c(Pe)]),_:1})),[[I,t.$t("add_to_tags")]]),q((n(),r(z,{loading:e(Le),onClick:f(Ie,["prevent"])},{default:S(()=>[c(Qe)]),_:1},8,["loading"])),[[I,t.$t("save_to_notes")]])],64)):E("",!0)]),o("div",Wt,[q((n(),r(z,{loading:e(y),onClick:f(Me,["prevent"])},{default:S(()=>[c(Re)]),_:1},8,["loading"])),[[I,t.$t("sync_feeds")]])])]),c(ze,{limit:_e,total:e(C),"all-checked-alert-visible":e(he),"real-all-checked":e(L),"select-real-all":e(ve),"clear-selection":e(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(U)&&w.value.length===0?(n(),d("div",Ht,[(n(),d(re,null,tt(20,i=>c(Be,{key:i,index:i,"is-phone":e(T)},null,8,["index","is-phone"])),64))])):E("",!0),w.value.length>0?(n(),r(e(st),{key:1,class:"scroller","data-key":"id","data-sources":w.value,"estimate-size":100,onTobottom:e(Ce)},{item:S(({index:i,item:a})=>{var le;return[o("a",{class:"item-link",href:te(a)},[o("article",{class:mt(["feed-item selectable-card",{selected:e(p).includes(a.id)||a.id==t.$route.params.id,selecting:e(H).includes(a.id)}]),onClick:f(v=>e(ke)(v,a,i,()=>{qe(a)}),["stop","prevent"]),onMouseenter:f(v=>e(ye)(v,i),["stop"])},[o("div",Yt,[e(H).includes(a.id)?(n(),r(F,{key:0,class:"checkbox","touch-target":"wrapper",checked:e(we),onClick:f(v=>e(K)(v,a,i),["stop"])},null,8,["checked","onClick"])):(n(),r(F,{key:1,class:"checkbox","touch-target":"wrapper",checked:e(p).includes(a.id),onClick:f(v=>e(K)(v,a,i),["stop"])},null,8,["checked","onClick"])),o("div",Xt,g(a.title||t.$t("no_content")),1)]),o("div",Zt,[o("span",Jt,[c(Ue,{id:i+1,raw:a},null,8,["id","raw"])]),o("div",es,[o("a",{onClick:f(v=>e(De)(G.value[a.feedId]),["stop","prevent"])},g((le=G.value[a.feedId])==null?void 0:le.name),9,ts),s[3]||(s[3]=o("span",null,"Â·",-1)),q((n(),d("span",ss,[ht(g(e(gt)(a.publishedAt)),1)])),[[I,e(vt)(a.publishedAt)]]),c(Ve,{tags:a.tags,type:e(_),"only-links":!0},null,8,["tags","type"])])]),q((n(),r(z,{style:{display:"none"}},{default:S(()=>[c(Ge)]),_:1})),[[I,t.$t("actions")]]),a.image?(n(),d("img",{key:0,class:"image",src:e(yt)(a.image,"&w=200&h=200")},null,8,os)):E("",!0)],42,Ot)],8,jt)]}),footer:S(()=>[e(X)?E("",!0):(n(),r(xe,{key:0,indeterminate:"",class:"sm"}))]),_:1},8,["data-sources","onTobottom"])):E("",!0),!e(U)&&w.value.length===0?(n(),d("div",ns,g(t.$t(e(ot)(e(U)))),1)):E("",!0),o("div",{class:"sidebar-drag-indicator",onMousedown:s[2]||(s[2]=(...i)=>e(J)&&e(J)(...i))},null,32)],4)}}}),ms=Ct(as,[["__scopeId","data-v-2b16b169"]]);export{ms as default};
