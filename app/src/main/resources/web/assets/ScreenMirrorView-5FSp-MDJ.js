var Ct=Object.defineProperty;var kt=(a,e,i)=>e in a?Ct(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var G=(a,e,i)=>kt(a,typeof e!="symbol"?e+"":e,i);import{m as X,c as f,o as r,a as c,ce as Se,cf as Mt,r as M,aA as St,cg as qt,d as qe,O as _,v,j as y,I,t as h,B as $e,aT as $t,aS as Te,L as Le,u as Ee,G as Q,ch as Ie,s as Lt,f as Et,W as we,w as be,g as It,i as j,ac as V,X as Rt,Y as Dt,N as Pt,h as O,V as ee,k as w,b2 as Ot,b3 as Ht,cb as At,Z as E,a0 as Bt,H as Vt,ci as Ce,$ as Qt,aC as Yt,T as F,bS as xt,a8 as Xt,cj as zt,aH as Gt,ab as Ft,ck as Ut,cl as Wt,cm as jt,cn as Nt,co as Zt,cp as Kt,cq as Jt,cr as en,cs as tn,ct as nn,cu as on,cv as sn,cw as rn,ah as an,bT as cn}from"./index-DUFKAMTy.js";import{_ as ln}from"./check-rounded-DUS61yT2.js";import{t as te}from"./tapphone-hT2n0OvG.js";const dn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function un(a,e){return r(),f("svg",dn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M10.475 22q-.7 0-1.312-.3t-1.038-.85L3.1 14.475q-.2-.225-.175-.537t.225-.513q.5-.525 1.2-.625t1.3.275L7.5 14.2V6q0-.425.288-.712T8.5 5t.725.288t.3.712v5H17q1.25 0 2.125.875T20 14v4q0 1.65-1.175 2.825T16 22zm1.5-13q-.425 0-.712-.288T10.975 8q0-.05.125-.5q.2-.35.3-.712T11.5 6q0-1.25-.875-2.125T8.5 3t-2.125.875T5.5 6q0 .425.1.788t.3.712q.075.125.1.25t.025.25q0 .425-.275.713T5.05 9q-.275 0-.512-.15t-.363-.375q-.325-.55-.5-1.175T3.5 6q0-2.075 1.463-3.537T8.5 1t3.538 1.463T13.5 6q0 .675-.175 1.3t-.5 1.175q-.125.225-.35.375t-.5.15"},null,-1)]))}const pn=X({name:"material-symbols-touch-app-rounded",render:un}),_n={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mn(a,e){return r(),f("svg",_n,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 19q-2.925 0-4.962-2.037T5 12t2.038-4.962T12 5t4.963 2.038T19 12t-2.037 4.963T12 19"},null,-1)]))}const vn=X({name:"material-symbols-fiber-manual-record",render:mn}),fn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function hn(a,e){return r(),f("svg",fn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 16V8q0-.825.588-1.412T8 6h8q.825 0 1.413.588T18 8v8q0 .825-.587 1.413T16 18H8q-.825 0-1.412-.587T6 16"},null,-1)]))}const gn=X({name:"material-symbols-stop-rounded",render:hn}),yn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tn(a,e){return r(),f("svg",yn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 21q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h14q.825 0 1.413.587Q21 4.175 21 5v14q0 .825-.587 1.413Q19.825 21 19 21Zm0-2h14V5H5v14Zm0 0V5v14Z"},null,-1)]))}const wn=X({name:"material-symbols-crop-square-outline",render:Tn}),bn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Cn(a,e){return r(),f("svg",bn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const kn=X({name:"material-symbols-circle-outline",render:Cn}),Mn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Sn(a,e){return r(),f("svg",Mn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"},null,-1)]))}const qn=X({name:"material-symbols-fullscreen-rounded",render:Sn}),$n={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ln(a,e){return r(),f("svg",$n,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"},null,-1)]))}const En=X({name:"material-symbols-fullscreen-exit-rounded",render:Ln}),In={xmlns:"http://www.w3.org/2000/svg",viewBox:"176.31 -11.19 346.88 581.88"};function Rn(a,e){return r(),f("svg",In,e[0]||(e[0]=[c("path",{d:"M470.49 0H229.51a41.9 41.9 0 0 0-29.547 12.277 41.9 41.9 0 0 0-12.277 29.547v476.35a41.9 41.9 0 0 0 12.277 29.547 41.9 41.9 0 0 0 29.547 12.277h240.98a41.9 41.9 0 0 0 29.547-12.277 41.9 41.9 0 0 0 12.277-29.547V41.824a41.9 41.9 0 0 0-12.277-29.547A41.9 41.9 0 0 0 470.49 0m33.25 518.18a33.33 33.33 0 0 1-9.766 23.484 33.34 33.34 0 0 1-23.484 9.766H229.51a33.33 33.33 0 0 1-23.484-9.766 33.34 33.34 0 0 1-9.765-23.484V41.83a33.33 33.33 0 0 1 9.828-23.371 33.32 33.32 0 0 1 23.422-9.703h240.98a33.33 33.33 0 0 1 23.484 9.765 33.34 33.34 0 0 1 9.765 23.484z"},null,-1),c("path",{d:"M317.62 46.812h64.75c2.418 0 4.375-1.957 4.375-4.375s-1.957-4.375-4.375-4.375h-64.75c-2.418 0-4.375 1.957-4.375 4.375s1.957 4.375 4.375 4.375M364.7 192.5a16.8 16.8 0 0 0-14.7-8.75 16.8 16.8 0 0 0-14.698 8.75l-91 157.5a16.45 16.45 0 0 0 0 16.977 16.6 16.6 0 0 0 6.101 6.386 16.65 16.65 0 0 0 8.512 2.364h182.09a16.626 16.626 0 0 0 14.7-8.75 16.8 16.8 0 0 0 0-16.977zm83.562 170.36a8.22 8.22 0 0 1-7.262 4.2H258.91a8.23 8.23 0 0 1-7.176-4.2 8.75 8.75 0 0 1 0-8.75l91-157.5a8.75 8.75 0 0 1 7.262-4.113 8.76 8.76 0 0 1 7.262 4.199l91 157.5a8.75 8.75 0 0 1 0 8.84z"},null,-1),c("path",{d:"M350 221.55a4.29 4.29 0 0 0-4.29 4.285v66.238a4.375 4.375 0 0 0 8.75 0v-66.238a4.286 4.286 0 0 0-4.46-4.285m0 91.26a4.29 4.29 0 0 0-4.29 4.29v17.061a4.375 4.375 0 0 0 8.75 0V317.1a4.286 4.286 0 0 0-4.46-4.29"},null,-1)]))}const Dn={render:Rn};class Pn{constructor(e){G(this,"pc",null);G(this,"options");G(this,"audioEnabled",!1);G(this,"remoteDescriptionSet",!1);G(this,"pendingIceCandidates",[]);this.options=e}async startSession(e,i=!0){this.audioEnabled=e,this.cleanup(),this.remoteDescriptionSet=!1,this.pendingIceCandidates=[];const o={iceServers:[],iceCandidatePoolSize:0};if(this.pc=new RTCPeerConnection(o),this.pc.ontrack=n=>{try{const d=n.receiver;"jitterBufferTarget"in d&&(d.jitterBufferTarget=0)}catch{}if(n.streams&&n.streams.length>0)this.options.onStream(n.streams[0]);else{const d=new MediaStream;d.addTrack(n.track),this.options.onStream(d)}},this.pc.onicecandidate=n=>{n.candidate&&this.options.sendSignaling({type:"ice_candidate",candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid??void 0,sdpMLineIndex:n.candidate.sdpMLineIndex??void 0})},this.pc.onconnectionstatechange=()=>{this.pc&&this.options.onConnectionStateChange(this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{var n;console.log("ICE connection state:",(n=this.pc)==null?void 0:n.iceConnectionState)},this.pc.addTransceiver("video",{direction:"recvonly"}),e&&this.pc.addTransceiver("audio",{direction:"recvonly"}),i)try{const n=await this.pc.createOffer();await this.pc.setLocalDescription(n),this.options.sendSignaling({type:"offer",sdp:n.sdp,sdpMid:e?"audio_enabled":"audio_disabled"})}catch(n){this.options.onError(`Failed to create offer: ${n}`)}else this.options.sendSignaling({type:"ready"})}async handleOffer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"offer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates();const o=await this.pc.createAnswer();await this.pc.setLocalDescription(o),this.options.sendSignaling({type:"answer",sdp:o.sdp})}catch(i){this.options.onError(`Failed to handle offer: ${i}`)}}async handleAnswer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"answer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates(),console.log("Remote description (answer) set successfully")}catch(i){this.options.onError(`Failed to set remote description: ${i}`)}}async handleIceCandidate(e,i,o){if(!this.pc){console.error("PeerConnection not initialized");return}if(!this.remoteDescriptionSet){this.pendingIceCandidates.push({candidate:e,sdpMid:i,sdpMLineIndex:o});return}try{await this.pc.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMid:i??"",sdpMLineIndex:o??0}))}catch(n){console.error("Failed to add ICE candidate:",n)}}async flushPendingIceCandidates(){var i;const e=this.pendingIceCandidates;this.pendingIceCandidates=[];for(const o of e)try{await((i=this.pc)==null?void 0:i.addIceCandidate(new RTCIceCandidate({candidate:o.candidate,sdpMid:o.sdpMid??"",sdpMLineIndex:o.sdpMLineIndex??0})))}catch(n){console.error("Failed to add buffered ICE candidate:",n)}}setAudioEnabled(e){var i;if(this.audioEnabled=e,this.pc){const o=this.pc.getReceivers();for(const n of o)((i=n.track)==null?void 0:i.kind)==="audio"&&(n.track.enabled=e)}}isAudioEnabled(){return this.audioEnabled}async handleSignalingMessage(e){switch(e.type){case"offer":e.sdp&&await this.handleOffer(e.sdp);break;case"answer":e.sdp&&await this.handleAnswer(e.sdp);break;case"ice_candidate":e.candidate&&await this.handleIceCandidate(e.candidate,e.sdpMid,e.sdpMLineIndex);break;default:console.warn("Unknown signaling message type:",e.type)}}cleanup(){this.remoteDescriptionSet=!1,this.pendingIceCandidates=[],this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close(),this.pc=null)}getConnectionState(){var e;return((e=this.pc)==null?void 0:e.connectionState)??null}}function On(a){Se.a.mutate({mutation:Mt,variables:{payload:a}}).catch(e=>{console.error("Failed to send WebRTC signaling via GraphQL:",e)})}function z(a){Se.a.mutate({mutation:qt,variables:{input:a}}).catch(e=>{console.error("Failed to send screen mirror control:",e)})}function ae(a,e,i){const o=i.getBoundingClientRect(),n=i.videoWidth,d=i.videoHeight;if(!n||!d)return null;const m=o.width,T=o.height,S=m/T,R=n/d;let g,b,C,$;R>S?(g=m,b=m/R,C=0,$=(T-b)/2):(b=T,g=T*R,C=(m-g)/2,$=0);const L=a-o.left-C,s=e-o.top-$;return L<0||L>g||s<0||s>b?null:{x:Math.max(0,Math.min(1,L/g)),y:Math.max(0,Math.min(1,s/b))}}const ke=500,ce=10;function Hn(a){const e=document.createElement("div");return e.className="touch-indicator",a.appendChild(e),e}function Re(a,e,i){a.style.left=`${e}px`,a.style.top=`${i}px`}function An(a,e,i){Re(a,e,i),a.classList.remove("touch-indicator--fade-out"),a.classList.add("touch-indicator--active")}function Me(a,e){e&&a.classList.add("touch-indicator--ripple"),a.classList.remove("touch-indicator--active"),a.classList.add("touch-indicator--fade-out");const i=()=>{a.classList.remove("touch-indicator--fade-out","touch-indicator--ripple"),a.removeEventListener("transitionend",i)};a.addEventListener("transitionend",i,{once:!0})}function Bn(a,e){const i=M();let o=null,n=null;const d=(s,p)=>{const u=i.value;if(!u)return null;const k=u.getBoundingClientRect();return{lx:s-k.left,ly:p-k.top}},m=s=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(s.clientX,s.clientY,p);if(!u)return;s.preventDefault(),s.target.setPointerCapture(s.pointerId),o={startX:u.x,startY:u.y,startClientX:s.clientX,startClientY:s.clientY,startTime:Date.now(),longPressTimer:null,isLongPress:!1,pointerId:s.pointerId};const k=d(s.clientX,s.clientY);k&&n&&An(n,k.lx,k.ly),o.longPressTimer=setTimeout(()=>{o&&(o.isLongPress=!0,n==null||n.classList.add("touch-indicator--long-press"),z({action:"LONG_PRESS",x:o.startX,y:o.startY,duration:ke}))},ke)},T=s=>{if(!o||!e.value)return;const p=s.clientX-o.startClientX,u=s.clientY-o.startClientY,k=Math.sqrt(p*p+u*u),H=d(s.clientX,s.clientY);H&&n&&Re(n,H.lx,H.ly),k>ce&&o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null,n==null||n.classList.add("touch-indicator--dragging"))},S=s=>{if(!o||!e.value)return;const p=a.value;if(!p){o=null;return}o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null);const u=s.clientX-o.startClientX,k=s.clientY-o.startClientY,H=Math.sqrt(u*u+k*k),A=Date.now()-o.startTime,q=!o.isLongPress&&H<=ce;if(n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),Me(n,q)),!o.isLongPress)if(H>ce){const Y=ae(s.clientX,s.clientY,p);Y&&z({action:"SWIPE",x:o.startX,y:o.startY,endX:Y.x,endY:Y.y,duration:Math.max(A,100)})}else z({action:"TAP",x:o.startX,y:o.startY});o=null},R=()=>{o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer),n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),Me(n,!1)),o=null},g=s=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(s.clientX,s.clientY,p);u&&(s.preventDefault(),z({action:"SCROLL",x:u.x,y:u.y,deltaX:s.deltaX,deltaY:s.deltaY}))},b=s=>{if(!e.value)return;let p=!0;switch(s.key){case"Escape":case"Backspace":z({action:"BACK"});break;case"Home":z({action:"HOME"});break;default:p=!1}p&&(s.preventDefault(),s.stopPropagation())},C=s=>{n&&n.parentElement&&(n.parentElement.removeChild(n),n=null),i.value=s,s&&(n=Hn(s))},$=()=>{const s=i.value;s&&(s.addEventListener("pointerdown",m),s.addEventListener("pointermove",T),s.addEventListener("pointerup",S),s.addEventListener("pointercancel",R),s.addEventListener("wheel",g,{passive:!1}),s.addEventListener("keydown",b))},L=()=>{const s=i.value;s&&(s.removeEventListener("pointerdown",m),s.removeEventListener("pointermove",T),s.removeEventListener("pointerup",S),s.removeEventListener("pointercancel",R),s.removeEventListener("wheel",g),s.removeEventListener("keydown",b))};return St(()=>{L(),o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer),n&&n.parentElement&&(n.parentElement.removeChild(n),n=null)}),{overlayRef:i,attachOverlay:C,setupListeners:$,removeListeners:L,sendControl:z}}const Vn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Qn(a,e){return r(),f("svg",Vn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 6q-.825 0-1.412-.587T10 4t.588-1.412T12 2t1.413.588T14 4t-.587 1.413T12 6M9 21V9q-1.225-.1-2.475-.275t-2.45-.45q-.425-.1-.687-.475T3.25 7t.525-.625t.85-.1q1.75.375 3.638.55T12 7t3.738-.175t3.637-.55q.45-.1.85.1T20.75 7t-.137.8t-.688.475q-1.2.275-2.45.45T15 9v12q0 .425-.287.713T14 22t-.712-.288T13 21v-5h-2v5q0 .425-.288.713T10 22t-.712-.288T9 21"},null,-1)]))}const Yn=X({name:"material-symbols-accessibility-new-rounded",render:Qn}),xn={class:"accessibility-guide"},Xn={class:"guide-icon"},zn={class:"guide-text"},Gn={class:"guide-steps"},Fn={class:"guide-note"},Un=qe({__name:"AccessibilityGuideModal",props:{onConfirm:{type:Function,default:null}},setup(a){const e=a;function i(){Te()}function o(){var n;Te(),(n=e.onConfirm)==null||n.call(e)}return(n,d)=>{const m=Yn,T=$e,S=$t;return r(),_(S,{onClose:i},{headline:v(()=>[I(h(n.$t("remote_control")),1)]),content:v(()=>[c("div",xn,[c("div",Xn,[y(m)]),c("p",zn,h(n.$t("accessibility_service_required")),1),c("ol",Gn,[c("li",null,h(n.$t("accessibility_step_1")),1),c("li",null,h(n.$t("accessibility_step_2")),1),c("li",null,h(n.$t("accessibility_step_3")),1)]),c("p",Fn,h(n.$t("accessibility_note")),1)])]),actions:v(()=>[y(T,{onClick:o},{default:v(()=>[I(h(n.$t("ok")),1)]),_:1})]),_:1})}}}),Wn=Le(Un,[["__scopeId","data-v-12a0e553"]]);function jn(a){const{t:e}=Ee(),i=M(!1),o=M("00:00");let n=null,d=[],m=null,T=0;const S=()=>{const $=Math.floor((Date.now()-T)/1e3),L=String(Math.floor($/60)).padStart(2,"0"),s=String($%60).padStart(2,"0");o.value=`${L}:${s}`},R=()=>{const $=a.value;if(!$||!$.srcObject){Q(e("recording_no_stream"),"error");return}const L=$.srcObject,s=["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4;codecs=avc1.42E01E","video/mp4","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"];let p="";for(const u of s)if(MediaRecorder.isTypeSupported(u)){p=u;break}if(!p){Q(e("recording_not_supported"),"error");return}d=[];try{n=new MediaRecorder(L,{mimeType:p,videoBitsPerSecond:5e6})}catch{Q(e("recording_not_supported"),"error");return}n.ondataavailable=u=>{u.data.size>0&&d.push(u.data)},n.onstop=()=>{if(d.length===0)return;const u=new Blob(d,{type:p}),k=URL.createObjectURL(u),H=p.startsWith("video/mp4")?"mp4":"webm",A=new Date,q="screen-recording-"+[A.getFullYear(),A.getMonth()+1,A.getDate(),A.getHours(),A.getMinutes(),A.getSeconds()].join("")+"."+H;Ie(k,q),setTimeout(()=>URL.revokeObjectURL(k),1e4),d=[]},n.onerror=()=>{i.value=!1,b(),Q(e("recording_failed"),"error")},n.start(1e3),i.value=!0,T=Date.now(),o.value="00:00",m=setInterval(S,1e3)},g=()=>{n&&n.state!=="inactive"&&n.stop(),n=null,i.value=!1,b()},b=()=>{m&&(clearInterval(m),m=null)};return{recording:i,recordingTime:o,toggleRecording:()=>{i.value?g():R()},stopRecording:g}}const Nn={class:"screen-mirror"},Zn={class:"title"},Kn={key:0,class:"warning-indicator"},Jn={class:"btn-icon warning-icon"},eo={class:"warning-dropdown"},to={class:"warning-content"},no={class:"warning-text"},oo={key:1,class:"warning-indicator"},so={class:"btn-icon warning-icon"},io={class:"warning-dropdown"},ro={class:"warning-content"},ao={class:"warning-text"},co={class:"warning-actions"},lo={key:1,class:"media-controls"},uo={class:"actions"},po={key:1,class:"check-placeholder"},_o={key:1,class:"check-placeholder"},mo={key:1,class:"check-placeholder"},vo={key:0},fo={key:0,class:"request-permission"},ho={class:"tap-phone"},go={class:"text"},yo={key:1,class:"request-permission-failed"},To={class:"video-wrapper"},wo=qe({__name:"ScreenMirrorView",setup(a){let e;const{t:i}=Ee(),{app:o}=Lt(Et()),n=M(!1),d=M(0),m=M(!1),T=M(!1),S=M(),R=M(!1),g=M("AUTO"),b=M(!1),C=M(!1),$=M(),L=M(!1),s=M(!1),p=M(!1),u=M(!0),k=M(!1),H={AUTO:"mirror_auto",HD:"mirror_hd",SMOOTH:"mirror_smooth"},A=we(()=>i(H[g.value]||"mirror_auto"));let q=null,Y=null;const{attachOverlay:De,setupListeners:Pe,removeListeners:Oe,sendControl:He}=Bn(S,C),{recording:U,recordingTime:Ae,toggleRecording:le}=jn(S),Be=[{keys:["Click"],description:"mirror_tap"},{keys:["Click","+","Drag"],description:"mirror_swipe"},{keys:["Scroll"],description:"mirror_scroll"},{keys:["Long press"],description:"mirror_long_press"},{keys:["Esc"],description:"nav_back"},{keys:["Backspace"],description:"nav_back"},{keys:["Home"],description:"nav_home"}],ne=t=>{He({action:t})},Ve=()=>{const t=S.value;t&&(t.paused?(t.play().catch(()=>{}),p.value=!1):(t.pause(),p.value=!0))},Qe=()=>{const t=S.value;t&&(t.muted=!t.muted,u.value=t.muted)},Ye=()=>{const t=document.querySelector(".video-wrapper");t&&(document.fullscreenElement?document.exitFullscreen():t.requestFullscreen())},de=()=>{k.value=!!document.fullscreenElement},xe=()=>{if(C.value){C.value=!1;return}if(!L.value){Ft(Wn,{onConfirm:()=>{st()}});return}C.value=!0};be($,t=>{Oe(),De(t),t&&Pe()});const ue=async()=>{n.value=!0,m.value=!1,d.value=0,clearInterval(e),me()},N=we(()=>ot.value||et.value||oe.value||he.value||T.value);be(S,t=>{t&&Y&&(t.srcObject=Y,t.play().catch(()=>{}),Y=null)});const{mutate:Xe,loading:oe}=j({document:Ut}),ze=()=>{b.value||(b.value=!0,te(i("confirm_mirror_audio_permission_on_phone")),Ge())},{mutate:Ge,onDone:Fe,onError:Ue}=j({document:Wt});Ue(t=>{b.value=!1,te(""),Q(i(t.message),"error")}),Fe(t=>{var P;((P=t==null?void 0:t.data)==null?void 0:P.requestScreenMirrorAudio)&&(b.value=!1,te(""),V.emit("refetch_app"))});const pe=()=>{b.value=!1,te(""),V.emit("refetch_app"),fe()};let Z=null;const{mutate:We,loading:je,onDone:Ne}=j({document:jt});Ne(()=>{Z!=null&&(g.value=Z,Z=null),R.value=!1});const se=t=>{Z=t,We({mode:t})},_e=t=>{t&&oe.value&&(clearInterval(e),ie())},Ze=()=>{const t=S.value;if(!t)return;const l=document.createElement("canvas");l.width=t.videoWidth,l.height=t.videoHeight;const P=l.getContext("2d");P&&P.drawImage(t,0,0,l.width,l.height);const B=new Date,K="screenshot-"+[B.getFullYear(),B.getMonth()+1,B.getDate(),B.getHours(),B.getMinutes(),B.getSeconds(),B.getMilliseconds()].join("")+".png";Ie(l.toDataURL(),K)},Ke=()=>{q&&q.cleanup(),q=new Pn({sendSignaling:t=>{On(t)},onStream:t=>{T.value=!1;const l=S.value;l?(l.srcObject=t,l.play().catch(()=>{}),n.value=!0,m.value=!1,d.value=0,clearInterval(e)):(Y=t,n.value=!0,m.value=!1,d.value=0,clearInterval(e))},onConnectionStateChange:t=>{t==="connected"?T.value=!1:(t==="failed"||t==="disconnected")&&(T.value=!1,m.value=!0)},onError:t=>{T.value=!1,Q(t,"error"),m.value=!0}})},me=()=>{T.value=!0,q==null||q.startSession(!0,!1)},ve=async t=>{q&&await q.handleSignalingMessage(t)};Rt(()=>{s.value=!0,V.on("screen_mirroring",ue),V.on("webrtc_signaling",ve),V.on("app_socket_connection_changed",_e),V.on("screen_mirror_audio_granted",pe),document.addEventListener("fullscreenchange",de),Ke()}),Dt(()=>{s.value=!1,V.off("screen_mirroring",ue),V.off("webrtc_signaling",ve),V.off("app_socket_connection_changed",_e),V.off("screen_mirror_audio_granted",pe),document.removeEventListener("fullscreenchange",de),q&&(q.cleanup(),q=null)});const{mutate:Je,loading:et,onDone:tt,onError:nt}=j({document:Nt}),{loading:ot,refetch:fe}=It({handle:(t,l)=>{var P;l?Q(i(l),"error"):((P=t==null?void 0:t.screenMirrorQuality)!=null&&P.mode&&(g.value=t.screenMirrorQuality.mode),L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,t.screenMirrorState?me():(n.value=!1,ie()))},options:{fetchPolicy:"no-cache"},document:Zt}),{fetch:st}=Pt({handle:t=>{t&&(L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,L.value&&(C.value=!0))},document:Kt,variables:()=>({})}),ie=()=>{m.value=!1,Je({audio:!0})};nt(t=>{Q(i(t.message)),m.value=!0}),tt(()=>{d.value=30,e=setInterval(()=>{d.value--,d.value<=0&&(m.value=!0,clearInterval(e))},1e3)});const{mutate:it,loading:he,onDone:rt,onError:at}=j({document:Jt});return at(t=>{Q(i(t.message))}),rt(()=>{m.value=!0,n.value=!1,C.value=!1,U.value&&le(),q&&q.cleanup()}),(t,l)=>{const P=en,B=tn,K=At,ge=$e,ct=nn,lt=on,x=Vt,dt=En,ut=qn,pt=sn,_t=rn,mt=an,vt=kn,ft=wn,ht=cn,ye=gn,W=Yt,re=ln,gt=Qt,yt=vn,Tt=pn,wt=xt,bt=Xt,D=Bt("tooltip");return r(),f("div",Nn,[s.value?(r(),_(Ce,{key:0,to:"#header-start-slot",defer:""},[c("div",Zn,[I(h(t.$t("screen_mirror"))+" ",1),n.value?(r(),f(ee,{key:0},[w(Ot)(w(Ht).MIRROR_AUDIO,w(o).osVersion)?w(o).permissions.includes("RECORD_AUDIO")?O("",!0):(r(),f("div",oo,[y(K,null,{content:v(()=>[c("div",io,[c("div",ro,[y(B),c("div",ao,h(t.$t("mirror_audio_no_permission")),1)]),c("div",co,[y(ge,{class:"btn-sm",loading:b.value,onClick:ze},{default:v(()=>[I(h(t.$t("grant_permission")),1)]),_:1},8,["loading"])])])]),default:v(()=>[c("button",so,[y(P)])]),_:1})])):(r(),f("div",Kn,[y(K,null,{content:v(()=>[c("div",eo,[c("div",to,[y(B),c("div",no,h(t.$t("mirror_audio_not_supported")),1)])])]),default:v(()=>[c("button",Jn,[y(P)])]),_:1})]))],64)):O("",!0),n.value&&!N.value?(r(),f("div",lo,[E((r(),_(x,{onClick:Ve},{default:v(()=>[p.value?(r(),_(ct,{key:0})):(r(),_(lt,{key:1}))]),_:1})),[[D,p.value?t.$t("play"):t.$t("pause")]]),E((r(),_(x,{onClick:Ye},{default:v(()=>[k.value?(r(),_(dt,{key:0})):(r(),_(ut,{key:1}))]),_:1})),[[D,k.value?t.$t("exit_fullscreen"):t.$t("fullscreen")]]),E((r(),_(x,{onClick:Qe},{default:v(()=>[u.value?(r(),_(pt,{key:0})):(r(),_(_t,{key:1}))]),_:1})),[[D,u.value?t.$t("unmute"):t.$t("mute")]]),C.value?(r(),f(ee,{key:0},[E((r(),_(x,{onClick:l[0]||(l[0]=J=>ne("BACK"))},{default:v(()=>[y(mt)]),_:1})),[[D,t.$t("nav_back")]]),E((r(),_(x,{onClick:l[1]||(l[1]=J=>ne("HOME"))},{default:v(()=>[y(vt)]),_:1})),[[D,t.$t("nav_home")]]),E((r(),_(x,{onClick:l[2]||(l[2]=J=>ne("RECENTS"))},{default:v(()=>[y(ft)]),_:1})),[[D,t.$t("nav_recents")]])],64)):O("",!0)])):O("",!0)])])):O("",!0),s.value?(r(),_(Ce,{key:1,to:"#header-end-slot",defer:""},[c("div",uo,[n.value?(r(),f(ee,{key:0},[E((r(),_(x,{onClick:w(fe)},{default:v(()=>[y(ht)]),_:1},8,["onClick"])),[[D,t.$t("refresh")]]),E((r(),_(x,{disabled:w(he),class:"btn-stop",onClick:w(it)},{default:v(()=>[y(ye)]),_:1},8,["disabled","onClick"])),[[D,t.$t("stop_mirror")]]),y(gt,{modelValue:R.value,"onUpdate:modelValue":l[6]||(l[6]=J=>R.value=J),placement:"auto",align:"top-left-to-bottom-left"},{trigger:v(()=>[E((r(),_(W,{class:"btn-sm",loading:w(je)},{default:v(()=>[I(h(A.value),1)]),_:1},8,["loading"])),[[D,t.$t("mirror_quality")]])]),default:v(()=>[c("div",{class:F(["dropdown-item",{active:g.value==="AUTO"}]),onClick:l[3]||(l[3]=()=>se("AUTO"))},[g.value==="AUTO"?(r(),_(re,{key:0})):(r(),f("span",po)),I(" "+h(t.$t("mirror_auto")),1)],2),c("div",{class:F(["dropdown-item",{active:g.value==="HD"}]),onClick:l[4]||(l[4]=()=>se("HD"))},[g.value==="HD"?(r(),_(re,{key:0})):(r(),f("span",_o)),I(" "+h(t.$t("mirror_hd")),1)],2),c("div",{class:F(["dropdown-item",{active:g.value==="SMOOTH"}]),onClick:l[5]||(l[5]=()=>se("SMOOTH"))},[g.value==="SMOOTH"?(r(),_(re,{key:0})):(r(),f("span",mo)),I(" "+h(t.$t("mirror_smooth")),1)],2)]),_:1},8,["modelValue"]),E((r(),_(W,{class:"btn-sm",onClick:Ze},{default:v(()=>[I(h(t.$t("screenshot")),1)]),_:1})),[[D,t.$t("screenshot")]]),E((r(),_(W,{class:F(["btn-sm",{active:w(U)}]),onClick:w(le)},{default:v(()=>[w(U)?(r(),_(ye,{key:1})):(r(),_(yt,{key:0})),I(" "+h(w(U)?w(Ae):t.$t("start_recording")),1)]),_:1},8,["class","onClick"])),[[D,w(U)?t.$t("stop_recording"):t.$t("start_recording")]]),w(o).channel!=="GOOGLE"?E((r(),_(W,{key:0,class:F(["btn-sm",{active:C.value}]),onClick:xe},{default:v(()=>[y(Tt),I(" "+h(t.$t("remote_control")),1)]),_:1},8,["class"])),[[D,C.value?t.$t("disable_control"):t.$t("enable_control")]]):O("",!0),y(wt,{shortcuts:Be})],64)):w(oe)?O("",!0):(r(),_(W,{key:1,class:"btn-sm",onClick:w(Xe)},{default:v(()=>[I(h(t.$t("relaunch_app")),1)]),_:1},8,["onClick"]))])])):O("",!0),c("div",{class:F(["content",{"content-centered":!n.value||N.value||!C.value}])},[N.value?(r(),f("div",vo,[y(bt,{indeterminate:""})])):(r(),f(ee,{key:1},[d.value>0?(r(),f("div",fo,[c("div",ho,[y(w(zt))]),c("pre",go,h(t.$t("screen_mirror_request_permission",{seconds:d.value})),1)])):O("",!0),m.value&&!n.value?(r(),f("div",yo,[y(w(Dn)),c("p",null,h(t.$t("screen_mirror_request_permission_failed")),1),y(ge,{onClick:ie},{default:v(()=>[I(h(t.$t("try_again")),1)]),_:1})])):O("",!0)],64)),E(c("div",To,[c("video",{ref_key:"videoRef",ref:S,class:"video",autoplay:"",playsinline:"",muted:""},null,512),C.value?(r(),f("div",{key:0,ref_key:"controlOverlayRef",ref:$,class:"control-overlay",tabindex:"0"},null,512)):O("",!0)],512),[[Gt,n.value&&!N.value]])],2)])}}}),So=Le(wo,[["__scopeId","data-v-d0ed0503"]]);export{So as default};
