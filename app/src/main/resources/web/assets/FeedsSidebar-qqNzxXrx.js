import{_ as Te}from"./LeftSidebar.vuevuetypescriptsetuptruelang-DXZ1_5lW.js";import{_ as Se,a as Ie}from"./TagFilter.vuevuetypescriptsetuptruelang-BQe4hXyG.js";import{_ as Re}from"./VDropdownMenu-DdmjILN8.js";import{_ as Ae}from"./more-vert-COB1t_KV.js";import{m as De,c as E,o as p,a,d as K,aS as ne,r as _,i as G,cy as Qe,aT as ae,aU as se,az as le,am as ce,aV as A,O as D,v as d,j as u,I as k,t as l,aC as de,k as n,B as ie,x as ue,y as re,z as _e,aW as me,cz as qe,u as Be,e as Ge,s as Ne,f as Ue,M as ze,N as Ke,w as Oe,g as Pe,bM as je,G as X,ac as q,aA as He,P as Z,Q as We,R as Ye,cA as Je,cB as Xe,cC as Ze,cD as et,A as B,T as N,h as U,U as ee,$ as te,a1 as tt,H as ot,W as oe,ab as z,ax as nt,cE as at,C as st}from"./index-Bsb9VlRU.js";import{_ as lt}from"./layout-grid-C34BGwLt.js";import{_ as pe}from"./VCheckbox-Cc39_B7Y.js";import{u as ct}from"./feeds-DfV4Gtur.js";const dt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function it(M,h){return p(),E("svg",dt,h[0]||(h[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M8 2v4m8-4v4"}),a("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}),a("path",{d:"M3 10h18M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"})],-1)]))}const ut=De({name:"lucide-calendar-days",render:it}),rt={class:"form-row"},_t={class:"form-row"},mt={class:"form-check-label"},pt=K({__name:"AddFeedModal",props:{done:{type:Function,required:!0}},setup(M){const{handleSubmit:h}=ne(),y=_(),i=_(!1);function S(e){i.value=e.target.checked}const f=M,{mutate:V,loading:I,onDone:C}=G({document:Qe}),{value:c,resetField:m,errorMessage:v}=ae("inputValue",se().required());m();function g(){A()}le(async()=>{await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=y.value)==null||e.focus()}catch(r){console.debug("Focus blocked:",r)}},100)})});const $=h(()=>{V({url:c.value??"",fetchContent:i.value})});return C(()=>{var e;(e=f.done)==null||e.call(this),A()}),(e,r)=>{const F=_e,x=pe,L=de,R=ie,T=me;return p(),D(T,{onClose:g},{headline:d(()=>[k(l(e.$t("add_subscription")),1)]),content:d(()=>[a("div",rt,[u(F,{ref_key:"inputRef",ref:y,modelValue:n(c),"onUpdate:modelValue":r[0]||(r[0]=w=>re(c)?c.value=w:null),label:e.$t("rss_url"),error:!!n(v),"error-text":n(v)?e.$t(n(v)):"",onKeyup:ue(n($),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),a("div",_t,[a("label",mt,[u(x,{"touch-target":"wrapper",checked:i.value,onChange:S},null,8,["checked"]),k(" "+l(e.$t("fetch_content_automatically")),1)])])]),actions:d(()=>[u(L,{value:"cancel",onClick:g},{default:d(()=>[k(l(e.$t("cancel")),1)]),_:1}),u(R,{value:"save",loading:n(I),onClick:n($)},{default:d(()=>[k(l(e.$t("save")),1)]),_:1},8,["loading","onClick"])]),_:1})}}}),ft={class:"form-label"},vt={class:"form-row"},ht={class:"form-row"},gt={class:"form-check-label"},kt=K({__name:"FeedModal",props:{data:{type:Object,required:!0}},setup(M){var g,$;const{handleSubmit:h}=ne(),y=_(),i=_(!1);function S(e){i.value=e.target.checked}const f=M,{mutate:V,loading:I,onDone:C}=G({document:qe}),{value:c,errorMessage:m}=ae("inputValue",se().required());c.value=((g=f.data)==null?void 0:g.name)??"",i.value=(($=f.data)==null?void 0:$.fetchContent)??!1,(async()=>(await ce(),requestAnimationFrame(()=>{setTimeout(()=>{var e;try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),(e=y.value)==null||e.focus()}catch(r){console.debug("Focus blocked:",r)}},100)})))();const v=h(()=>{var e;V({id:(e=f.data)==null?void 0:e.id,name:c.value,fetchContent:i.value})});return C(()=>{A()}),(e,r)=>{const F=_e,x=pe,L=de,R=ie,T=me;return p(),D(T,{onClose:n(A)},{headline:d(()=>[k(l(e.$t("update_subscription")),1)]),content:d(()=>{var w;return[a("div",ft,l((w=M.data)==null?void 0:w.url),1),a("div",vt,[u(F,{ref_key:"inputRef",ref:y,modelValue:n(c),"onUpdate:modelValue":r[0]||(r[0]=Q=>re(c)?c.value=Q:null),class:"form-control",label:e.$t("name"),error:!!n(m),"error-text":n(m)?e.$t(n(m)):"",onKeyup:ue(n(v),["enter"])},null,8,["modelValue","label","error","error-text","onKeyup"])]),a("div",ht,[a("label",gt,[u(x,{"touch-target":"wrapper",checked:i.value,onChange:S},null,8,["checked"]),k(" "+l(e.$t("fetch_content_automatically")),1)])])]}),actions:d(()=>[u(L,{value:"cancel",onClick:n(A)},{default:d(()=>[k(l(e.$t("cancel")),1)]),_:1},8,["onClick"]),u(R,{value:"save",loading:n(I),onClick:n(v)},{default:d(()=>[k(l(e.$t("save")),1)]),_:1},8,["loading","onClick"])]),_:1},8,["onClose"])}}}),yt={class:"nav"},Ct={class:"icon","aria-hidden":"true"},$t={class:"title"},bt={key:0,class:"count"},Ft={class:"icon","aria-hidden":"true"},wt={class:"title"},Et={key:0,class:"count"},Mt=["onClick"],Vt={class:"title"},xt={key:0,class:"count"},Lt=["onClick"],Bt=K({__name:"FeedsSidebar",setup(M){const{t:h}=Be(),y=Ge(),{counter:i}=Ne(Ue()),{parseQ:S}=Ye(),f=ze({tagIds:[]}),V=_([]),I=[{text:"add_subscription",click:ve},{text:"import_opml_file",click:Ce},{text:"export_opml_file",click:$e}],C=_(!1),c=_(""),m=_(""),v=_(!1),g=_(),$=_(new Map),e=_(!1),r=_(),{fetch:F}=Ke({handle:t=>{t&&(i.value.feedEntries=t.total,i.value.feedEntriesToday=t.today,t.feedsCount.forEach(o=>{$.value.set(o.id,o.count)}))},document:Je,variables:()=>({})});function x(t){return $.value.get(t)??-1}function L(){var b;const t=Z.currentRoute.value,o=We(((b=t.query.q)==null?void 0:b.toString())??"");S(f,o),c.value=f.tagIds.length===1?f.tagIds[0]:"",m.value=f.feedId??"",v.value=f.today??!1,v.value?(c.value="",m.value=""):c.value&&m.value&&(c.value=""),F()}L(),Oe(()=>Z.currentRoute.value,()=>{L()});const{viewFeed:R,viewAll:T,viewToday:w}=ct(y),{refetch:Q}=Pe({handle:(t,o)=>{o?X(h(o),"error"):t&&(V.value=t.feeds)},document:Xe});function fe(t){const o=t.target.files;if(!o)return;const b=new FileReader;b.addEventListener("load",()=>{ke({content:b.result})},!1),b.readAsText(o[0])}function ve(){z(pt,{done:()=>{Q()}})}const{mutate:he,onDone:ge}=G({document:Ze});ge(t=>{je(t.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ke,onDone:ye}=G({document:et});ye(()=>{X(h("imported")),Q()});function Ce(){g.value.value="",g.value.click()}function $e(){he()}function be(t){r.value=t;const o=document.getElementById("feed-"+t.id);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:o}})),e.value=!0}function Fe(t){z(kt,{data:t})}function we(t){z(nt,{id:t.id,name:t.name,gql:at,typeName:"Feed",done:()=>{st(y,"/feeds")}})}const O=()=>{F()},P=()=>{F()};return le(()=>{q.on("feed_entries_deleted",O),q.on("feeds_fetched",P)}),He(()=>{q.off("feed_entries_deleted",O),q.off("feeds_fetched",P)}),(t,o)=>{const b=Ie,j=ot,Ee=lt,Me=ut,Ve=Ae,H=Re,xe=Se,Le=Te,W=tt("tooltip");return p(),D(Le,null,{title:d(()=>[k(l(t.$t("page_title.feeds")),1)]),actions:d(()=>[te((p(),D(j,{id:"add-feed-ref",onClick:o[0]||(o[0]=()=>C.value=!0)},{default:d(()=>[u(b)]),_:1})),[[W,n(h)("add_subscription")]])]),body:d(()=>{var Y;return[a("ul",yt,[a("li",{class:N({active:!v.value&&!c.value&&!m.value}),onClick:o[1]||(o[1]=B((...s)=>n(T)&&n(T)(...s),["prevent"]))},[a("span",Ct,[u(Ee)]),a("span",$t,l(t.$t("all")),1),n(i).feedEntries>=0?(p(),E("span",bt,l(n(i).feedEntries.toLocaleString()),1)):U("",!0)],2),a("li",{class:N({active:v.value}),onClick:o[2]||(o[2]=B((...s)=>n(w)&&n(w)(...s),["prevent"]))},[a("span",Ft,[u(Me)]),a("span",wt,l(t.$t("today")),1),n(i).feedEntriesToday>=0?(p(),E("span",Et,l(n(i).feedEntriesToday.toLocaleString()),1)):U("",!0)],2),(p(!0),E(oe,null,ee(V.value,s=>(p(),E("li",{key:s.id,class:N({active:m.value&&s.id===m.value}),onClick:B(J=>n(R)(s),["stop","prevent"])},[a("span",Vt,l(s.name),1),te((p(),D(j,{id:"feed-"+s.id,onClick:B(J=>be(s),["prevent","stop"])},{default:d(()=>[u(Ve)]),_:2},1032,["id","onClick"])),[[W,t.$t("actions")]]),x(s.id)>=0?(p(),E("span",xt,l(x(s.id).toLocaleString()),1)):U("",!0)],10,Mt))),128))]),u(H,{modelValue:C.value,"onUpdate:modelValue":o[3]||(o[3]=s=>C.value=s),anchor:"add-feed-ref"},{default:d(()=>[(p(),E(oe,null,ee(I,s=>a("div",{key:s.text,class:"dropdown-item",onClick:J=>{s.click(),C.value=!1}},l(t.$t(s.text)),9,Lt)),64))]),_:1},8,["modelValue"]),u(H,{modelValue:e.value,"onUpdate:modelValue":o[6]||(o[6]=s=>e.value=s),anchor:"feed-"+((Y=r.value)==null?void 0:Y.id)},{default:d(()=>[a("div",{class:"dropdown-item",onClick:o[4]||(o[4]=s=>{Fe(r.value),e.value=!1})},l(t.$t("edit")),1),a("div",{class:"dropdown-item",onClick:o[5]||(o[5]=s=>{we(r.value),e.value=!1})},l(t.$t("delete")),1)]),_:1},8,["modelValue","anchor"]),u(xe,{type:"FEED_ENTRY",selected:c.value},null,8,["selected"]),a("input",{ref_key:"fileInput",ref:g,style:{display:"none"},accept:".xml",type:"file",onChange:fe},null,544)]}),_:1})}}});export{Bt as default};
