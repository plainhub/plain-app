var at=Object.defineProperty;var ct=(l,e,i)=>e in l?at(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i;var x=(l,e,i)=>ct(l,typeof e!="symbol"?e+"":e,i);import{m as V,c as v,o as a,a as r,c5 as ke,c6 as lt,r as M,aj as dt,c7 as ut,d as Se,M as S,x as b,j as f,J as $,t as m,C as Me,aL as pt,aK as ge,L as $e,u as Le,H,c8 as qe,s as _t,f as mt,aD as ye,w as we,g as vt,i as G,a7 as P,Z as ft,$ as ht,h as O,a0 as ie,k as g,aW as gt,aX as yt,c0 as wt,aE as be,O as B,P as bt,I as Tt,al as Ct,an as kt,R as U,bi as St,am as Mt,c9 as $t,au as Lt,bt as qt,a5 as Et,ca as Dt,cb as Rt,cc as It,cd as Pt,ce as Ot,cf as Ht,cg as At,ch as Bt,bI as Qt}from"./index-CeUr62re.js";import{t as K}from"./tapphone-BwUboyiz.js";const Vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Yt(l,e){return a(),v("svg",Vt,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M5 21q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h14q.825 0 1.413.587Q21 4.175 21 5v14q0 .825-.587 1.413Q19.825 21 19 21Zm0-2h14V5H5v14Zm0 0V5v14Z"},null,-1)]))}const Xt=V({name:"material-symbols-crop-square-outline",render:Yt}),xt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ut(l,e){return a(),v("svg",xt,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Wt=V({name:"material-symbols-circle-outline",render:Ut}),Gt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ft(l,e){return a(),v("svg",Gt,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M10.475 22q-.7 0-1.312-.3t-1.038-.85L3.1 14.475q-.2-.225-.175-.537t.225-.513q.5-.525 1.2-.625t1.3.275L7.5 14.2V6q0-.425.288-.712T8.5 5t.725.288t.3.712v5H17q1.25 0 2.125.875T20 14v4q0 1.65-1.175 2.825T16 22zm1.5-13q-.425 0-.712-.288T10.975 8q0-.05.125-.5q.2-.35.3-.712T11.5 6q0-1.25-.875-2.125T8.5 3t-2.125.875T5.5 6q0 .425.1.788t.3.712q.075.125.1.25t.025.25q0 .425-.275.713T5.05 9q-.275 0-.512-.15t-.363-.375q-.325-.55-.5-1.175T3.5 6q0-2.075 1.463-3.537T8.5 1t3.538 1.463T13.5 6q0 .675-.175 1.3t-.5 1.175q-.125.225-.35.375t-.5.15"},null,-1)]))}const jt=V({name:"material-symbols-touch-app-rounded",render:Ft}),zt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Nt(l,e){return a(),v("svg",zt,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M12 19q-2.925 0-4.962-2.037T5 12t2.038-4.962T12 5t4.963 2.038T19 12t-2.037 4.963T12 19"},null,-1)]))}const Kt=V({name:"material-symbols-fiber-manual-record",render:Nt}),Zt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Jt(l,e){return a(),v("svg",Zt,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z"},null,-1)]))}const en=V({name:"material-symbols-check-rounded",render:Jt}),tn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function nn(l,e){return a(),v("svg",tn,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M6 16V8q0-.825.588-1.412T8 6h8q.825 0 1.413.588T18 8v8q0 .825-.587 1.413T16 18H8q-.825 0-1.412-.587T6 16"},null,-1)]))}const on=V({name:"material-symbols-stop-rounded",render:nn}),sn={xmlns:"http://www.w3.org/2000/svg",viewBox:"176.31 -11.19 346.88 581.88"};function rn(l,e){return a(),v("svg",sn,e[0]||(e[0]=[r("path",{d:"M470.49 0H229.51a41.9 41.9 0 0 0-29.547 12.277 41.9 41.9 0 0 0-12.277 29.547v476.35a41.9 41.9 0 0 0 12.277 29.547 41.9 41.9 0 0 0 29.547 12.277h240.98a41.9 41.9 0 0 0 29.547-12.277 41.9 41.9 0 0 0 12.277-29.547V41.824a41.9 41.9 0 0 0-12.277-29.547A41.9 41.9 0 0 0 470.49 0m33.25 518.18a33.33 33.33 0 0 1-9.766 23.484 33.34 33.34 0 0 1-23.484 9.766H229.51a33.33 33.33 0 0 1-23.484-9.766 33.34 33.34 0 0 1-9.765-23.484V41.83a33.33 33.33 0 0 1 9.828-23.371 33.32 33.32 0 0 1 23.422-9.703h240.98a33.33 33.33 0 0 1 23.484 9.765 33.34 33.34 0 0 1 9.765 23.484z"},null,-1),r("path",{d:"M317.62 46.812h64.75c2.418 0 4.375-1.957 4.375-4.375s-1.957-4.375-4.375-4.375h-64.75c-2.418 0-4.375 1.957-4.375 4.375s1.957 4.375 4.375 4.375M364.7 192.5a16.8 16.8 0 0 0-14.7-8.75 16.8 16.8 0 0 0-14.698 8.75l-91 157.5a16.45 16.45 0 0 0 0 16.977 16.6 16.6 0 0 0 6.101 6.386 16.65 16.65 0 0 0 8.512 2.364h182.09a16.626 16.626 0 0 0 14.7-8.75 16.8 16.8 0 0 0 0-16.977zm83.562 170.36a8.22 8.22 0 0 1-7.262 4.2H258.91a8.23 8.23 0 0 1-7.176-4.2 8.75 8.75 0 0 1 0-8.75l91-157.5a8.75 8.75 0 0 1 7.262-4.113 8.76 8.76 0 0 1 7.262 4.199l91 157.5a8.75 8.75 0 0 1 0 8.84z"},null,-1),r("path",{d:"M350 221.55a4.29 4.29 0 0 0-4.29 4.285v66.238a4.375 4.375 0 0 0 8.75 0v-66.238a4.286 4.286 0 0 0-4.46-4.285m0 91.26a4.29 4.29 0 0 0-4.29 4.29v17.061a4.375 4.375 0 0 0 8.75 0V317.1a4.286 4.286 0 0 0-4.46-4.29"},null,-1)]))}const an={render:rn};class cn{constructor(e){x(this,"pc",null);x(this,"options");x(this,"audioEnabled",!1);x(this,"remoteDescriptionSet",!1);x(this,"pendingIceCandidates",[]);this.options=e}async startSession(e,i=!0){this.audioEnabled=e,this.cleanup(),this.remoteDescriptionSet=!1,this.pendingIceCandidates=[];const o={iceServers:[],iceCandidatePoolSize:0};if(this.pc=new RTCPeerConnection(o),this.pc.ontrack=n=>{try{const d=n.receiver;"jitterBufferTarget"in d&&(d.jitterBufferTarget=0)}catch{}if(n.streams&&n.streams.length>0)this.options.onStream(n.streams[0]);else{const d=new MediaStream;d.addTrack(n.track),this.options.onStream(d)}},this.pc.onicecandidate=n=>{n.candidate&&this.options.sendSignaling({type:"ice_candidate",candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid??void 0,sdpMLineIndex:n.candidate.sdpMLineIndex??void 0})},this.pc.onconnectionstatechange=()=>{this.pc&&this.options.onConnectionStateChange(this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{var n;console.log("ICE connection state:",(n=this.pc)==null?void 0:n.iceConnectionState)},this.pc.addTransceiver("video",{direction:"recvonly"}),e&&this.pc.addTransceiver("audio",{direction:"recvonly"}),i)try{const n=await this.pc.createOffer();await this.pc.setLocalDescription(n),this.options.sendSignaling({type:"offer",sdp:n.sdp,sdpMid:e?"audio_enabled":"audio_disabled"})}catch(n){this.options.onError(`Failed to create offer: ${n}`)}else this.options.sendSignaling({type:"ready"})}async handleOffer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"offer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates();const o=await this.pc.createAnswer();await this.pc.setLocalDescription(o),this.options.sendSignaling({type:"answer",sdp:o.sdp})}catch(i){this.options.onError(`Failed to handle offer: ${i}`)}}async handleAnswer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"answer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates(),console.log("Remote description (answer) set successfully")}catch(i){this.options.onError(`Failed to set remote description: ${i}`)}}async handleIceCandidate(e,i,o){if(!this.pc){console.error("PeerConnection not initialized");return}if(!this.remoteDescriptionSet){this.pendingIceCandidates.push({candidate:e,sdpMid:i,sdpMLineIndex:o});return}try{await this.pc.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMid:i??"",sdpMLineIndex:o??0}))}catch(n){console.error("Failed to add ICE candidate:",n)}}async flushPendingIceCandidates(){var i;const e=this.pendingIceCandidates;this.pendingIceCandidates=[];for(const o of e)try{await((i=this.pc)==null?void 0:i.addIceCandidate(new RTCIceCandidate({candidate:o.candidate,sdpMid:o.sdpMid??"",sdpMLineIndex:o.sdpMLineIndex??0})))}catch(n){console.error("Failed to add buffered ICE candidate:",n)}}setAudioEnabled(e){var i;if(this.audioEnabled=e,this.pc){const o=this.pc.getReceivers();for(const n of o)((i=n.track)==null?void 0:i.kind)==="audio"&&(n.track.enabled=e)}}isAudioEnabled(){return this.audioEnabled}async handleSignalingMessage(e){switch(e.type){case"offer":e.sdp&&await this.handleOffer(e.sdp);break;case"answer":e.sdp&&await this.handleAnswer(e.sdp);break;case"ice_candidate":e.candidate&&await this.handleIceCandidate(e.candidate,e.sdpMid,e.sdpMLineIndex);break;default:console.warn("Unknown signaling message type:",e.type)}}cleanup(){this.remoteDescriptionSet=!1,this.pendingIceCandidates=[],this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close(),this.pc=null)}getConnectionState(){var e;return((e=this.pc)==null?void 0:e.connectionState)??null}}function ln(l){ke.a.mutate({mutation:lt,variables:{payload:l}}).catch(e=>{console.error("Failed to send WebRTC signaling via GraphQL:",e)})}function Q(l){ke.a.mutate({mutation:ut,variables:{input:l}}).catch(e=>{console.error("Failed to send screen mirror control:",e)})}function re(l,e,i){const o=i.getBoundingClientRect(),n=i.videoWidth,d=i.videoHeight;if(!n||!d)return null;const p=o.width,y=o.height,k=p/y,L=n/d;let h,C,w,s;L>k?(h=p,C=p/L,w=0,s=(y-C)/2):(C=y,h=y*L,w=(p-h)/2,s=0);const _=l-o.left-w,u=e-o.top-s;return _<0||_>h||u<0||u>C?null:{x:Math.max(0,Math.min(1,_/h)),y:Math.max(0,Math.min(1,u/C))}}const Te=500,Ce=10;function dn(l,e){const i=M();let o=null;const n=s=>{if(!e.value)return;const _=l.value;if(!_)return;const u=re(s.clientX,s.clientY,_);u&&(s.preventDefault(),s.target.setPointerCapture(s.pointerId),o={startX:u.x,startY:u.y,startClientX:s.clientX,startClientY:s.clientY,startTime:Date.now(),longPressTimer:null,isLongPress:!1,pointerId:s.pointerId},o.longPressTimer=setTimeout(()=>{o&&(o.isLongPress=!0,Q({action:"LONG_PRESS",x:o.startX,y:o.startY,duration:Te}))},Te))},d=s=>{if(!o||!e.value)return;const _=s.clientX-o.startClientX,u=s.clientY-o.startClientY;Math.sqrt(_*_+u*u)>Ce&&o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null)},p=s=>{if(!o||!e.value)return;const _=l.value;if(!_){o=null;return}o.longPressTimer&&(clearTimeout(o.longPressTimer),o.longPressTimer=null);const u=s.clientX-o.startClientX,q=s.clientY-o.startClientY,E=Math.sqrt(u*u+q*q),T=Date.now()-o.startTime;if(!o.isLongPress)if(E>Ce){const R=re(s.clientX,s.clientY,_);R&&Q({action:"SWIPE",x:o.startX,y:o.startY,endX:R.x,endY:R.y,duration:Math.max(T,100)})}else Q({action:"TAP",x:o.startX,y:o.startY});o=null},y=()=>{o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer),o=null},k=s=>{if(!e.value)return;const _=l.value;if(!_)return;const u=re(s.clientX,s.clientY,_);u&&(s.preventDefault(),Q({action:"SCROLL",x:u.x,y:u.y,deltaX:s.deltaX,deltaY:s.deltaY}))},L=s=>{if(!e.value)return;let _=!0;switch(s.key){case"Escape":case"Backspace":Q({action:"BACK"});break;case"Home":Q({action:"HOME"});break;default:_=!1}_&&(s.preventDefault(),s.stopPropagation())},h=s=>{i.value=s},C=()=>{const s=i.value;s&&(s.addEventListener("pointerdown",n),s.addEventListener("pointermove",d),s.addEventListener("pointerup",p),s.addEventListener("pointercancel",y),s.addEventListener("wheel",k,{passive:!1}),s.addEventListener("keydown",L))},w=()=>{const s=i.value;s&&(s.removeEventListener("pointerdown",n),s.removeEventListener("pointermove",d),s.removeEventListener("pointerup",p),s.removeEventListener("pointercancel",y),s.removeEventListener("wheel",k),s.removeEventListener("keydown",L))};return dt(()=>{w(),o!=null&&o.longPressTimer&&clearTimeout(o.longPressTimer)}),{overlayRef:i,attachOverlay:h,setupListeners:C,removeListeners:w,sendControl:Q}}const un={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function pn(l,e){return a(),v("svg",un,e[0]||(e[0]=[r("path",{fill:"currentColor",d:"M12 6q-.825 0-1.412-.587T10 4t.588-1.412T12 2t1.413.588T14 4t-.587 1.413T12 6M9 21V9q-1.225-.1-2.475-.275t-2.45-.45q-.425-.1-.687-.475T3.25 7t.525-.625t.85-.1q1.75.375 3.638.55T12 7t3.738-.175t3.637-.55q.45-.1.85.1T20.75 7t-.137.8t-.688.475q-1.2.275-2.45.45T15 9v12q0 .425-.287.713T14 22t-.712-.288T13 21v-5h-2v5q0 .425-.288.713T10 22t-.712-.288T9 21"},null,-1)]))}const _n=V({name:"material-symbols-accessibility-new-rounded",render:pn}),mn={class:"accessibility-guide"},vn={class:"guide-icon"},fn={class:"guide-text"},hn={class:"guide-steps"},gn={class:"guide-note"},yn=Se({__name:"AccessibilityGuideModal",props:{onConfirm:{type:Function,default:null}},setup(l){const e=l;function i(){ge()}function o(){var n;ge(),(n=e.onConfirm)==null||n.call(e)}return(n,d)=>{const p=_n,y=Me,k=pt;return a(),S(k,{onClose:i},{headline:b(()=>[$(m(n.$t("remote_control")),1)]),content:b(()=>[r("div",mn,[r("div",vn,[f(p)]),r("p",fn,m(n.$t("accessibility_service_required")),1),r("ol",hn,[r("li",null,m(n.$t("accessibility_step_1")),1),r("li",null,m(n.$t("accessibility_step_2")),1),r("li",null,m(n.$t("accessibility_step_3")),1)]),r("p",gn,m(n.$t("accessibility_note")),1)])]),actions:b(()=>[f(y,{onClick:o},{default:b(()=>[$(m(n.$t("ok")),1)]),_:1})]),_:1})}}}),wn=$e(yn,[["__scopeId","data-v-12a0e553"]]);function bn(l){const{t:e}=Le(),i=M(!1),o=M("00:00");let n=null,d=[],p=null,y=0;const k=()=>{const s=Math.floor((Date.now()-y)/1e3),_=String(Math.floor(s/60)).padStart(2,"0"),u=String(s%60).padStart(2,"0");o.value=`${_}:${u}`},L=()=>{const s=l.value;if(!s||!s.srcObject){H(e("recording_no_stream"),"error");return}const _=s.srcObject,u=["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4;codecs=avc1.42E01E","video/mp4","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"];let q="";for(const E of u)if(MediaRecorder.isTypeSupported(E)){q=E;break}if(!q){H(e("recording_not_supported"),"error");return}d=[];try{n=new MediaRecorder(_,{mimeType:q,videoBitsPerSecond:5e6})}catch{H(e("recording_not_supported"),"error");return}n.ondataavailable=E=>{E.data.size>0&&d.push(E.data)},n.onstop=()=>{if(d.length===0)return;const E=new Blob(d,{type:q}),T=URL.createObjectURL(E),R=q.startsWith("video/mp4")?"mp4":"webm",A=new Date,Z="screen-recording-"+[A.getFullYear(),A.getMonth()+1,A.getDate(),A.getHours(),A.getMinutes(),A.getSeconds()].join("")+"."+R;qe(T,Z),setTimeout(()=>URL.revokeObjectURL(T),1e4),d=[]},n.onerror=()=>{i.value=!1,C(),H(e("recording_failed"),"error")},n.start(1e3),i.value=!0,y=Date.now(),o.value="00:00",p=setInterval(k,1e3)},h=()=>{n&&n.state!=="inactive"&&n.stop(),n=null,i.value=!1,C()},C=()=>{p&&(clearInterval(p),p=null)};return{recording:i,recordingTime:o,toggleRecording:()=>{i.value?h():L()},stopRecording:h}}const Tn={class:"screen-mirror"},Cn={class:"title"},kn={key:0,class:"warning-indicator"},Sn={class:"btn-icon warning-icon"},Mn={class:"warning-dropdown"},$n={class:"warning-content"},Ln={class:"warning-text"},qn={key:1,class:"warning-indicator"},En={class:"btn-icon warning-icon"},Dn={class:"warning-dropdown"},Rn={class:"warning-content"},In={class:"warning-text"},Pn={class:"warning-actions"},On={class:"actions"},Hn={key:1,class:"check-placeholder"},An={key:1,class:"check-placeholder"},Bn={key:1,class:"check-placeholder"},Qn={key:0},Vn={key:0,class:"request-permission"},Yn={class:"tap-phone"},Xn={class:"text"},xn={key:1,class:"request-permission-failed"},Un={class:"video-wrapper"},Wn=["controls"],Gn={key:2,class:"recording-indicator"},Fn={key:3,class:"nav-bar"},jn=["title"],zn=["title"],Nn=["title"],Kn=Se({__name:"ScreenMirrorView",setup(l){let e;const{t:i}=Le(),{app:o}=_t(mt()),n=M(!1),d=M(0),p=M(!1),y=M(!1),k=M(),L=M(!1),h=M("AUTO"),C=M(!1),w=M(!1),s=M(),_=M(!1),u=M(!1),q={AUTO:"mirror_auto",HD:"mirror_hd",SMOOTH:"mirror_smooth"},E=ye(()=>i(q[h.value]||"mirror_auto"));let T=null,R=null;const{attachOverlay:A,setupListeners:Z,removeListeners:Ee,sendControl:De}=dn(k,w),{recording:Y,recordingTime:ae,toggleRecording:ce}=bn(k),Re=[{keys:["Click"],description:"mirror_tap"},{keys:["Click","+","Drag"],description:"mirror_swipe"},{keys:["Scroll"],description:"mirror_scroll"},{keys:["Long press"],description:"mirror_long_press"},{keys:["Esc"],description:"nav_back"},{keys:["Backspace"],description:"nav_back"},{keys:["Home"],description:"nav_home"}],J=t=>{De({action:t})},Ie=()=>{if(w.value){w.value=!1;return}if(!_.value){Et(wn,{onConfirm:()=>{ne()}});return}w.value=!0};we(s,t=>{Ee(),A(t),t&&Z()});const le=async()=>{n.value=!0,p.value=!1,d.value=0,clearInterval(e),pe()},F=ye(()=>je.value||We.value||ee.value||me.value||y.value);we(k,t=>{t&&R&&(t.srcObject=R,t.play().catch(()=>{}),R=null)});const{mutate:Pe,loading:ee}=G({document:Dt}),Oe=()=>{C.value||(C.value=!0,K(i("confirm_mirror_audio_permission_on_phone")),He())},{mutate:He,onDone:Ae,onError:Be}=G({document:Rt});Be(t=>{C.value=!1,K(""),H(i(t.message),"error")}),Ae(t=>{var D;((D=t==null?void 0:t.data)==null?void 0:D.requestScreenMirrorAudio)&&(C.value=!1,K(""),P.emit("refetch_app"))});const de=()=>{C.value=!1,K(""),P.emit("refetch_app"),ne()};let j=null;const{mutate:Qe,loading:Ve,onDone:Ye}=G({document:It});Ye(()=>{j!=null&&(h.value=j,j=null),L.value=!1});const te=t=>{j=t,Qe({mode:t})},ue=t=>{t&&ee.value&&(clearInterval(e),oe())},Xe=()=>{const t=k.value;if(!t)return;const c=document.createElement("canvas");c.width=t.videoWidth,c.height=t.videoHeight;const D=c.getContext("2d");D&&D.drawImage(t,0,0,c.width,c.height);const I=new Date,z="screenshot-"+[I.getFullYear(),I.getMonth()+1,I.getDate(),I.getHours(),I.getMinutes(),I.getSeconds(),I.getMilliseconds()].join("")+".png";qe(c.toDataURL(),z)},xe=()=>{T&&T.cleanup(),T=new cn({sendSignaling:t=>{ln(t)},onStream:t=>{y.value=!1;const c=k.value;c?(c.srcObject=t,c.play().catch(()=>{}),n.value=!0,p.value=!1,d.value=0,clearInterval(e)):(R=t,n.value=!0,p.value=!1,d.value=0,clearInterval(e))},onConnectionStateChange:t=>{t==="connected"?y.value=!1:(t==="failed"||t==="disconnected")&&(y.value=!1,p.value=!0)},onError:t=>{y.value=!1,H(t,"error"),p.value=!0}})},pe=()=>{y.value=!0,T==null||T.startSession(!0,!1)},_e=async t=>{T&&await T.handleSignalingMessage(t)};ft(()=>{u.value=!0,P.on("screen_mirroring",le),P.on("webrtc_signaling",_e),P.on("app_socket_connection_changed",ue),P.on("screen_mirror_audio_granted",de),xe()}),ht(()=>{u.value=!1,P.off("screen_mirroring",le),P.off("webrtc_signaling",_e),P.off("app_socket_connection_changed",ue),P.off("screen_mirror_audio_granted",de),T&&(T.cleanup(),T=null)});const{mutate:Ue,loading:We,onDone:Ge,onError:Fe}=G({document:Pt}),{loading:je,refetch:ne}=vt({handle:(t,c)=>{var D;c?H(i(c),"error"):((D=t==null?void 0:t.screenMirrorQuality)!=null&&D.mode&&(h.value=t.screenMirrorQuality.mode),_.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,t.screenMirrorState?pe():(n.value=!1,oe()))},options:{fetchPolicy:"no-cache"},document:Ot}),oe=()=>{p.value=!1,Ue({audio:!0})};Fe(t=>{H(i(t.message)),p.value=!0}),Ge(()=>{d.value=30,e=setInterval(()=>{d.value--,d.value<=0&&(p.value=!0,clearInterval(e))},1e3)});const{mutate:ze,loading:me,onDone:Ne,onError:Ke}=G({document:Ht});return Ke(t=>{H(i(t.message))}),Ne(()=>{p.value=!0,n.value=!1,w.value=!1,Y.value&&ce(),T&&T.cleanup()}),(t,c)=>{const D=At,I=Bt,z=wt,ve=Me,Ze=Qt,fe=Tt,he=on,W=kt,se=en,Je=Ct,et=Kt,tt=jt,nt=St,ot=Mt,st=qt,it=Wt,rt=Xt,X=bt("tooltip");return a(),v("div",Tn,[u.value?(a(),S(be,{key:0,to:"#header-start-slot",defer:""},[r("div",Cn,[$(m(t.$t("screen_mirror"))+" ",1),n.value?(a(),v(ie,{key:0},[g(gt)(g(yt).MIRROR_AUDIO,g(o).osVersion)?g(o).permissions.includes("RECORD_AUDIO")?O("",!0):(a(),v("div",qn,[f(z,null,{content:b(()=>[r("div",Dn,[r("div",Rn,[f(I),r("div",In,m(t.$t("mirror_audio_no_permission")),1)]),r("div",Pn,[f(ve,{class:"btn-sm",loading:C.value,onClick:Oe},{default:b(()=>[$(m(t.$t("grant_permission")),1)]),_:1},8,["loading"])])])]),default:b(()=>[r("button",En,[f(D)])]),_:1})])):(a(),v("div",kn,[f(z,null,{content:b(()=>[r("div",Mn,[r("div",$n,[f(I),r("div",Ln,m(t.$t("mirror_audio_not_supported")),1)])])]),default:b(()=>[r("button",Sn,[f(D)])]),_:1})]))],64)):O("",!0)])])):O("",!0),u.value?(a(),S(be,{key:1,to:"#header-end-slot",defer:""},[r("div",On,[n.value?(a(),v(ie,{key:0},[B((a(),S(fe,{onClick:g(ne)},{default:b(()=>[f(Ze)]),_:1},8,["onClick"])),[[X,t.$t("refresh")]]),B((a(),S(fe,{disabled:g(me),class:"btn-stop",onClick:g(ze)},{default:b(()=>[f(he)]),_:1},8,["disabled","onClick"])),[[X,t.$t("stop_mirror")]]),f(Je,{modelValue:L.value,"onUpdate:modelValue":c[3]||(c[3]=N=>L.value=N),placement:"auto",align:"top-left-to-bottom-left"},{trigger:b(()=>[B((a(),S(W,{class:"btn-sm",loading:g(Ve)},{default:b(()=>[$(m(E.value),1)]),_:1},8,["loading"])),[[X,t.$t("mirror_quality")]])]),default:b(()=>[r("div",{class:U(["dropdown-item",{active:h.value==="AUTO"}]),onClick:c[0]||(c[0]=()=>te("AUTO"))},[h.value==="AUTO"?(a(),S(se,{key:0})):(a(),v("span",Hn)),$(" "+m(t.$t("mirror_auto")),1)],2),r("div",{class:U(["dropdown-item",{active:h.value==="HD"}]),onClick:c[1]||(c[1]=()=>te("HD"))},[h.value==="HD"?(a(),S(se,{key:0})):(a(),v("span",An)),$(" "+m(t.$t("mirror_hd")),1)],2),r("div",{class:U(["dropdown-item",{active:h.value==="SMOOTH"}]),onClick:c[2]||(c[2]=()=>te("SMOOTH"))},[h.value==="SMOOTH"?(a(),S(se,{key:0})):(a(),v("span",Bn)),$(" "+m(t.$t("mirror_smooth")),1)],2)]),_:1},8,["modelValue"]),B((a(),S(W,{class:"btn-sm",onClick:Xe},{default:b(()=>[$(m(t.$t("screenshot")),1)]),_:1})),[[X,t.$t("screenshot")]]),B((a(),S(W,{class:U(["btn-sm",{active:g(Y)}]),onClick:g(ce)},{default:b(()=>[g(Y)?(a(),S(he,{key:1})):(a(),S(et,{key:0})),$(" "+m(g(Y)?g(ae):t.$t("start_recording")),1)]),_:1},8,["class","onClick"])),[[X,g(Y)?t.$t("stop_recording"):t.$t("start_recording")]]),B((a(),S(W,{class:U(["btn-sm",{active:w.value}]),onClick:Ie},{default:b(()=>[f(tt),$(" "+m(t.$t("remote_control")),1)]),_:1},8,["class"])),[[X,w.value?t.$t("disable_control"):t.$t("enable_control")]]),f(nt,{shortcuts:Re})],64)):g(ee)?O("",!0):(a(),S(W,{key:1,class:"btn-sm",onClick:g(Pe)},{default:b(()=>[$(m(t.$t("relaunch_app")),1)]),_:1},8,["onClick"]))])])):O("",!0),r("div",{class:U(["content",{"content-centered":!n.value||F.value||!w.value}])},[F.value?(a(),v("div",Qn,[f(ot,{indeterminate:""})])):(a(),v(ie,{key:1},[d.value>0?(a(),v("div",Vn,[r("div",Yn,[f(g($t))]),r("pre",Xn,m(t.$t("screen_mirror_request_permission",{seconds:d.value})),1)])):O("",!0),p.value&&!n.value?(a(),v("div",xn,[f(g(an)),r("p",null,m(t.$t("screen_mirror_request_permission_failed")),1),f(ve,{onClick:oe},{default:b(()=>[$(m(t.$t("try_again")),1)]),_:1})])):O("",!0)],64)),B(r("div",Un,[r("video",{ref_key:"videoRef",ref:k,class:"video",controls:!w.value,autoplay:"",playsinline:"",muted:""},null,8,Wn),w.value?(a(),v("div",{key:0,ref_key:"controlOverlayRef",ref:s,class:"control-overlay",tabindex:"0"},null,512)):O("",!0)],512),[[Lt,n.value&&!F.value]]),g(Y)?(a(),v("div",Gn,[c[7]||(c[7]=r("span",{class:"recording-dot"},null,-1)),$(" "+m(t.$t("recording"))+" "+m(g(ae)),1)])):O("",!0),n.value&&!F.value&&w.value?(a(),v("div",Fn,[r("button",{class:"nav-btn",onClick:c[4]||(c[4]=N=>J("BACK")),title:t.$t("nav_back")},[f(st)],8,jn),r("button",{class:"nav-btn",onClick:c[5]||(c[5]=N=>J("HOME")),title:t.$t("nav_home")},[f(it)],8,zn),r("button",{class:"nav-btn",onClick:c[6]||(c[6]=N=>J("RECENTS")),title:t.$t("nav_recents")},[f(rt)],8,Nn)])):O("",!0)],2)])}}}),to=$e(Kn,[["__scopeId","data-v-7ec2115b"]]);export{to as default};
