import{_ as ue}from"./LeftSidebar.vuevuetypescriptsetuptruelang-BDdMylOV.js";import{_ as ce}from"./VDropdownMenu-BCHmjly-.js";import{m as de,c as f,o as d,a as l,d as ve,e as pe,s as fe,f as he,u as _e,c0 as me,M as Pe,r as w,i as W,X as $,q as j,w as ye,O as A,v as D,P as z,Q as Te,c2 as ge,ce as ke,ad as H,h as X,j as J,U as G,A as V,T as K,t as P,W as b,$ as Ce,a1 as Ee,H as Se,bV as Fe,G as O,ac as Me,c3 as Re,D as we,C as Y,E as $e,cf as Ae}from"./index-9yvO6RpE.js";import{_ as be}from"./VolumeCard.vuevuetypescriptsetuptruelang-DPmYRe-p.js";const Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ne(Z,y){return d(),f("svg",Be,y[0]||(y[0]=[l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[l("path",{d:"M3 12a9 9 0 1 0 9-9a9.75 9.75 0 0 0-6.74 2.74L3 8"}),l("path",{d:"M3 3v5h5m4-1v5l4 2"})],-1)]))}const Le=de({name:"lucide-history",render:Ne}),De={class:"nav"},Ge=["onClick"],Ve={class:"icon","aria-hidden":"true"},Oe={class:"title"},xe={class:"section-title"},qe={class:"volumes"},Ie={class:"section-title"},Ue={class:"nav"},Qe=["onClick"],We={class:"title"},Ke=ve({__name:"FilesSidebar",setup(Z){const y=pe(),{app:T}=fe(he()),{t:i}=_e(),{mounts:h}=me(),{parseQ:ee}=ge(),x=Pe({showHidden:!1,type:"",rootPath:"",text:"",parent:""}),q=w(""),E=w(!1),g=w(!1),S=w(null);function te(){Y(y,"/files/recent")}function oe(t){S.value=t;const s=document.getElementById("favorite-"+t.fullPath);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:s}})),g.value=!0}const{mutate:ne,loading:je}=W({document:ke,options:{update:()=>{H.emit("refetch_app")}}});function se(t){ne({fullPath:t.fullPath}).then(()=>{O(i("removed"))}).catch(s=>{console.error("Error removing favorite folder:",s),O(i("error"),"error")})}function ae(){var _;const t=S.value;if(!t)return;const s=(_=T.value.favoriteFolders)==null?void 0:_.find(p=>p.fullPath===t.fullPath),v=((s==null?void 0:s.alias)||"").trim(),k=()=>W({document:Ae,options:{update:()=>{H.emit("refetch_app")}}});Me(Re,{title:i("name"),placeholder:t.title||"",value:v||"",mutation:k,getVariables:p=>({fullPath:t.fullPath,alias:(p||"").trim()}),done:()=>{O(i("saved"))}})}const B=$(()=>{const t=e=>{var u;const n=[...h.value.map(c=>c.mountPoint).filter(Boolean),...((u=T.value.favoriteFolders)==null?void 0:u.map(c=>c.fullPath))||[]];let a="";return n.forEach(c=>{e.startsWith(c)&&c.length>a.length&&(a=c)}),a},s=e=>{const n=(e.alias||"").trim();if(n)return n;const a=h.value.filter(r=>r.driveType==="USB_STORAGE").map(r=>r.mountPoint).filter(Boolean),u=new Map(a.map((r,C)=>[r,C+1])),c=r=>{if(!r)return"";if(r.driveType==="INTERNAL_STORAGE")return i("internal_storage");if(r.driveType==="APP")return i("app_data");if(r.driveType==="SDCARD")return i("sdcard");if(r.driveType==="USB_STORAGE"){const C=u.get(r.mountPoint)??1;return`${i("usb_storage")} ${C}`}return r.name||r.mountPoint},R=(()=>{const r=h.value.find(C=>C.mountPoint===e.rootPath);return c(r)||e.rootPath})(),Q=e.fullPath.startsWith(e.rootPath)?e.fullPath.substring(e.rootPath.length).replace(/^\//,""):e.fullPath.split("/").pop()||"";return Q?`${R}/${Q}`:R},v=(e,n)=>n<=0?"":i("storage_free_total",{free:j(e),total:j(n)}),k=(e,n)=>n<=0?0:Math.max(0,n-e)/n*100,_=(e,n)=>{if(e.driveType==="INTERNAL_STORAGE")return i("internal_storage");if(e.driveType==="APP")return i("app_data");if(e.driveType==="SDCARD")return i("sdcard");if(e.driveType==="USB_STORAGE"){const a=n.get(e.mountPoint)??1;return`${i("usb_storage")} ${a}`}return e.name||e.mountPoint},p=E.value?"":t(q.value),m=[];m.push({rootPath:"",fullPath:"",type:"RECENTS",title:i("recents"),isChecked:E.value,isFavoriteFolder:!1});const L=h.value.filter(e=>e.driveType==="USB_STORAGE").map(e=>e.mountPoint).filter(Boolean),F=new Map(L.map((e,n)=>[e,n+1])),o=e=>e.driveType==="INTERNAL_STORAGE"?0:e.driveType==="SDCARD"?1:e.driveType==="USB_STORAGE"?2:e.driveType==="APP"?3:9;return[...h.value].sort((e,n)=>{const a=o(e),u=o(n);return a!==u?a-u:(e.mountPoint||"").localeCompare(n.mountPoint||"")}).forEach(e=>{const n=e.mountPoint;if(!n)return;const a=Number(e.totalBytes||0),u=Number(e.freeBytes||0);m.push({rootPath:n,fullPath:n,type:e.driveType||"",title:_(e,F),isChecked:p===n,isFavoriteFolder:!1,count:v(u,a),usedPercent:k(u,a),showProgress:a>0})}),T.value.favoriteFolders&&T.value.favoriteFolders.length>0&&T.value.favoriteFolders.forEach((e,n)=>{var c;const a=s(e),u=((c=h.value.find(R=>R.mountPoint===e.rootPath))==null?void 0:c.driveType)??"";m.push({rootPath:e.rootPath,fullPath:e.fullPath,type:u,title:a,isChecked:p===e.fullPath,isFavoriteFolder:!0})}),m}),re=$(()=>B.value.filter(t=>t.type==="RECENTS")),ie=$(()=>B.value.filter(t=>t.type!=="RECENTS"&&!t.isFavoriteFolder)),I=$(()=>B.value.filter(t=>t.isFavoriteFolder));function le(t){return Math.round(t||0)>=85?"warn":""}function N(t){if(t.type==="RECENTS"){te();return}const s=we([{name:"parent",op:"",value:t.fullPath},{name:"type",op:"",value:t.type},{name:"root_path",op:"",value:t.rootPath}]);Y(y,`/files?q=${$e(s)}`)}function U(){var v;const t=z.currentRoute.value;if(t.path==="/files/recent"){E.value=!0;return}E.value=!1;const s=Te(((v=t.query.q)==null?void 0:v.toString())??"");ee(x,s),q.value=x.parent}return U(),ye(()=>z.currentRoute.value.fullPath,()=>{U()}),(t,s)=>{const v=Le,k=Fe,_=Se,p=ce,m=ue,L=Ee("tooltip");return d(),A(m,{class:"files-sidebar"},{body:D(()=>{var F;return[l("ul",De,[(d(!0),f(b,null,G(re.value,o=>(d(),f("li",{key:o.type,class:K({active:o.isChecked}),onClick:V(M=>N(o),["prevent"])},[l("span",Ve,[o.type==="RECENTS"?(d(),A(v,{key:0})):X("",!0)]),l("span",Oe,P(o.title),1)],10,Ge))),128))]),l("div",xe,P(t.$t("volumes")),1),l("div",qe,[(d(!0),f(b,null,G(ie.value,o=>(d(),A(be,{key:o.fullPath,title:o.title,count:o.count||"",data:o,"used-percent":o.usedPercent||0,"percent-class":le(o.usedPercent),active:o.isChecked,"show-progress":o.showProgress,onClick:M=>N(o)},null,8,["title","count","data","used-percent","percent-class","active","show-progress","onClick"]))),128))]),I.value.length?(d(),f(b,{key:0},[l("div",Ie,P(t.$t("favorites")),1),l("ul",Ue,[(d(!0),f(b,null,G(I.value,o=>(d(),f("li",{key:o.fullPath,class:K({active:o.isChecked}),onClick:V(M=>N(o),["prevent"])},[l("span",We,P(o.title),1),Ce((d(),A(_,{id:"favorite-"+o.fullPath,class:"sm",onClick:V(M=>oe(o),["prevent","stop"])},{default:D(()=>[J(k)]),_:2},1032,["id","onClick"])),[[L,t.$t("actions")]])],10,Qe))),128))])],64)):X("",!0),J(p,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=o=>g.value=o),anchor:"favorite-"+((F=S.value)==null?void 0:F.fullPath)},{default:D(()=>[l("div",{class:"dropdown-item",onClick:s[0]||(s[0]=o=>{ae(),g.value=!1})},P(t.$t("rename")),1),l("div",{class:"dropdown-item",onClick:s[1]||(s[1]=o=>{se(S.value),g.value=!1})},P(t.$t("remove_from_favorites")),1)]),_:1},8,["modelValue","anchor"])]}),_:1})}}});export{Ke as default};
