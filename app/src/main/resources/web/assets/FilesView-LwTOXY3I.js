import{_ as po}from"./ListItemPhone.vuevuetypescriptsetuptruelang-DB35KJfd.js";import{d as ee,r as q,c as l,o as n,Z as $,j as v,V as U,a0 as ae,O as D,H as Te,A as p,v as f,aD as gt,$ as ht,a as c,t as u,as as yt,bQ as fo,h as R,bR as vo,L as le,T as Ce,k as a,aW as ot,q as ie,a9 as nt,I as x,aa as st,ar as go,m as Se,bS as ho,U as Fe,a7 as yo,bT as _o,u as ko,M as Io,e as wo,s as De,f as $o,W as it,bU as Do,bV as bo,bW as Co,b1 as Fo,N as To,bX as So,i as at,aM as Eo,w as Vo,X as qo,Y as Po,K as Lo,aG as Bo,aH as Uo,a1 as Mo,a2 as Ao,a5 as Ho,Q as Ro,bY as zo,ab as j,C as lt,bZ as rt,bs as Ko,G as O,b_ as Oo,b$ as No,c0 as Qo,ac as Q,c1 as dt,c2 as ut,ba as ct,c3 as mt,al as be,c4 as pt,c5 as Go,c6 as Wo,c7 as Xo}from"./index-BBktiafP.js";import{_ as _t}from"./upload-rounded-D8-KC-_r.js";import{_ as Zo}from"./FieldId.vuevuetypescriptsetuptruelang-B0Bg1Soy.js";import{_ as kt}from"./VCheckbox-7GJOJltb.js";import{_ as re,a as jo}from"./DownloadMethodModal.vuevuetypescriptsetuptruelang-NCvqctWL.js";import{_ as Yo,a as Jo,c as xo}from"./key-events-CpIN_ha2.js";import{_ as en}from"./content-paste-rounded-8Ug60IjR.js";import{a as tn,u as ft}from"./upload-DrivSptu.js";import{K as on}from"./KeyboardShortcutsModal-ndzXYz2c.js";const nn={class:"actions"},sn={class:"card card-info"},an={class:"key-value vertical"},ln={class:"key"},rn={class:"value"},dn=ee({__name:"FileActionButtons",props:{item:{},canPaste:{type:Boolean}},emits:["downloadDir","downloadFile","uploadFiles","uploadDir","deleteItem","duplicateItem","cutItem","copyItem","pasteItem","copyLink","renameItem","addToFavorites"],setup(F,{emit:_}){const i=_,T=q(!1),P=q(!1),C=q(!1);function m(s){i("downloadDir",s)}function A(s){i("downloadFile",s)}function H(s){i("uploadFiles",s)}function I(s){i("uploadDir",s)}function S(s){i("deleteItem",s)}function h(s){i("duplicateItem",s)}function b(s){i("cutItem",s)}function E(s){i("copyItem",s)}function L(s){i("pasteItem",s)}function e(s){i("copyLink",s)}function r(s){i("renameItem",s)}function M(s){i("addToFavorites",s)}return(s,d)=>{const B=gt,y=Te,g=_t,G=ht,te=yt,W=fo,X=vo,z=ae("tooltip");return n(),l("div",nn,[s.item.isDir?(n(),l(U,{key:0},[$((n(),D(y,{class:"sm",onClick:d[0]||(d[0]=p(w=>m(s.item.path),["stop"]))},{default:f(()=>[v(B)]),_:1})),[[z,s.$t("download")]]),v(G,{modelValue:T.value,"onUpdate:modelValue":d[3]||(d[3]=w=>T.value=w)},{trigger:f(()=>[$((n(),D(y,{class:"sm"},{default:f(()=>[v(g)]),_:1})),[[z,s.$t("upload")]])]),default:f(()=>[c("div",{class:"dropdown-item",onClick:d[1]||(d[1]=p(w=>{H(s.item.path),T.value=!1},["stop"]))},u(s.$t("upload_files")),1),c("div",{class:"dropdown-item",onClick:d[2]||(d[2]=p(w=>{I(s.item.path),T.value=!1},["stop"]))},u(s.$t("upload_folder")),1)]),_:1},8,["modelValue"])],64)):$((n(),D(y,{key:1,class:"sm",onClick:d[4]||(d[4]=p(w=>A(s.item.path),["stop"]))},{default:f(()=>[v(B)]),_:1})),[[z,s.$t("download")]]),$((n(),D(y,{class:"sm",onClick:d[5]||(d[5]=p(w=>S(s.item),["stop"]))},{default:f(()=>[v(te)]),_:1})),[[z,s.$t("delete")]]),v(G,{modelValue:P.value,"onUpdate:modelValue":d[6]||(d[6]=w=>P.value=w)},{trigger:f(()=>[$((n(),D(y,{class:"sm"},{default:f(()=>[v(W)]),_:1})),[[z,s.$t("info")]])]),default:f(()=>[c("section",sn,[c("div",an,[c("div",ln,u(s.$t("path")),1),c("div",rn,u(s.item.path),1)])])]),_:1},8,["modelValue"]),v(G,{modelValue:C.value,"onUpdate:modelValue":d[14]||(d[14]=w=>C.value=w)},{trigger:f(()=>[$((n(),D(y,{class:"sm"},{default:f(()=>[v(X)]),_:1})),[[z,s.$t("actions")]])]),default:f(()=>[c("div",{class:"dropdown-item",onClick:d[7]||(d[7]=p(w=>{h(s.item),C.value=!1},["stop"]))},u(s.$t("duplicate")),1),c("div",{class:"dropdown-item",onClick:d[8]||(d[8]=p(w=>{b(s.item),C.value=!1},["stop"]))},u(s.$t("cut")),1),c("div",{class:"dropdown-item",onClick:d[9]||(d[9]=p(w=>{E(s.item),C.value=!1},["stop"]))},u(s.$t("copy")),1),s.item.isDir&&s.canPaste?(n(),l("div",{key:0,class:"dropdown-item",onClick:d[10]||(d[10]=p(w=>{L(s.item),C.value=!1},["stop"]))},u(s.$t("paste")),1)):R("",!0),s.item.isDir?R("",!0):(n(),l("div",{key:1,class:"dropdown-item",onClick:d[11]||(d[11]=p(w=>{e(s.item),C.value=!1},["stop"]))},u(s.$t("copy_link")),1)),s.item.isDir?(n(),l("div",{key:2,class:"dropdown-item",onClick:d[12]||(d[12]=p(w=>{M(s.item),C.value=!1},["stop"]))},u(s.$t("add_to_favorites")),1)):R("",!0),c("div",{class:"dropdown-item",onClick:d[13]||(d[13]=p(w=>{r(s.item),C.value=!1},["stop"]))},u(s.$t("rename")),1)]),_:1},8,["modelValue"])])}}}),un=le(dn,[["__scopeId","data-v-c4ee8d44"]]),cn={class:"start"},mn={class:"number"},pn={key:0,src:"/ficons/folder.svg",class:"svg"},fn={key:0,class:"svg",src:re},vn=["src"],gn=["src"],hn={key:3,class:"svg",src:re},yn={class:"title"},_n={class:"subtitle"},kn={key:0},In={key:1},wn={key:0,src:"/ficons/folder.svg",class:"svg"},$n={key:0,class:"svg",src:re},Dn=["src"],bn=["src"],Cn={key:3,class:"svg",src:re},Fn={key:0},Tn={key:1},Sn=ee({__name:"FileListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},imageErrorIds:{},extensionImageErrorIds:{},canPaste:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function},onImageError:{type:Function},onExtensionImageError:{type:Function},viewItem:{type:Function},clickItem:{type:Function}},emits:["downloadDir","downloadFile","uploadFiles","uploadDir","deleteItem","duplicateItem","cutItem","copyItem","pasteItem","copyLink","renameItem","addToFavorites"],setup(F,{emit:_}){const i=_;function T(e){i("downloadDir",e)}function P(e){i("downloadFile",e)}function C(e){i("uploadFiles",e)}function m(e){i("uploadDir",e)}function A(e){i("deleteItem",e)}function H(e){i("duplicateItem",e)}function I(e){i("cutItem",e)}function S(e){i("copyItem",e)}function h(e){i("pasteItem",e)}function b(e){i("copyLink",e)}function E(e){i("renameItem",e)}function L(e){i("addToFavorites",e)}return(e,r)=>{const M=kt,s=Zo,d=un,B=po,y=ae("tooltip");return e.isPhone?(n(),D(B,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:r[10]||(r[10]=g=>e.handleItemClick(g,e.item,e.index,()=>e.clickItem(e.item))),onMouseenter:r[11]||(r[11]=p(g=>e.handleMouseOver(g,e.index),["stop"])),onCheckboxClick:r[12]||(r[12]=g=>e.toggleSelect(g,e.item,e.index))},{image:f(()=>[c("div",{class:"image",onClick:r[9]||(r[9]=g=>e.viewItem(g,e.item))},[e.item.isDir?(n(),l("img",wn)):(n(),l(U,{key:1},[e.extensionImageErrorIds.includes(e.item.id)?(n(),l("img",$n)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(n(),l("img",{key:1,class:"image-thumb",src:a(ot)(e.item.fileId,"&w=50&h=50"),onError:r[7]||(r[7]=g=>e.onImageError(e.item.id))},null,40,Dn)):e.item.extension?(n(),l("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:r[8]||(r[8]=g=>e.onExtensionImageError(e.item.id))},null,40,bn)):(n(),l("img",Cn))],64))])]),title:f(()=>[x(u(e.item.name),1)]),subtitle:f(()=>[e.item.isDir?(n(),l("span",Fn,u(e.$t("x_items",e.item.children||0)),1)):(n(),l("span",Tn,u(a(ie)(e.item.size)),1)),$((n(),l("span",null,[x(u(a(st)(e.item.updatedAt)),1)])),[[y,a(nt)(e.item.updatedAt)]])]),actions:f(()=>[v(d,{item:e.item,"can-paste":e.canPaste,onDownloadDir:T,onDownloadFile:P,onUploadFiles:C,onUploadDir:m,onDeleteItem:A,onDuplicateItem:H,onCutItem:I,onCopyItem:S,onPasteItem:h,onCopyLink:b,onRenameItem:E,onAddToFavorites:L},null,8,["item","can-paste"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(n(),l("section",{key:0,class:Ce(["file-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:r[5]||(r[5]=p(g=>e.handleItemClick(g,e.item,e.index,()=>e.clickItem(e.item)),["stop"])),onMouseenter:r[6]||(r[6]=p(g=>e.handleMouseOver(g,e.index),["stop"]))},[c("div",cn,[e.shiftEffectingIds.includes(e.item.id)?(n(),D(M,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:r[0]||(r[0]=p(g=>e.toggleSelect(g,e.item,e.index),["stop"]))},null,8,["checked"])):(n(),D(M,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:r[1]||(r[1]=p(g=>e.toggleSelect(g,e.item,e.index),["stop"]))},null,8,["checked"])),c("span",mn,[v(s,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),c("div",{class:"image",onClick:r[4]||(r[4]=g=>e.viewItem(g,e.item))},[e.item.isDir?(n(),l("img",pn)):(n(),l(U,{key:1},[e.extensionImageErrorIds.includes(e.item.id)?(n(),l("img",fn)):!e.imageErrorIds.includes(e.item.id)&&e.item.fileId?(n(),l("img",{key:1,class:"image-thumb",src:a(ot)(e.item.fileId,"&w=50&h=50"),onError:r[2]||(r[2]=g=>e.onImageError(e.item.id))},null,40,vn)):e.item.extension?(n(),l("img",{key:2,src:`/ficons/${e.item.extension}.svg`,class:"svg",onError:r[3]||(r[3]=g=>e.onExtensionImageError(e.item.id))},null,40,gn)):(n(),l("img",hn))],64))]),c("div",yn,u(e.item.name),1),c("div",_n,[e.item.isDir?(n(),l("span",kn,u(e.$t("x_items",e.item.children||0)),1)):(n(),l("span",In,u(a(ie)(e.item.size)),1)),$((n(),l("span",null,[x(u(a(st)(e.item.updatedAt)),1)])),[[y,a(nt)(e.item.updatedAt)]])]),v(d,{item:e.item,"can-paste":e.canPaste,onDownloadDir:T,onDownloadFile:P,onUploadFiles:C,onUploadDir:m,onDeleteItem:A,onDuplicateItem:H,onCutItem:I,onCopyItem:S,onPasteItem:h,onCopyLink:b,onRenameItem:E,onAddToFavorites:L},null,8,["item","can-paste"])],34))}}}),En=le(Sn,[["__scopeId","data-v-7d7965b5"]]),Vn={key:0,class:"file-item selectable-card-skeleton"},qn={class:"start"},Pn={class:"number"},Ln=ee({__name:"FileSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(F){return(_,i)=>{const T=Yo;return _.isPhone?(n(),D(T,{key:1,"title-width":"60%",subtitles:[{width:"45%"},{width:"40%"}],"action-count":5})):(n(),l("section",Vn,[c("div",qn,[i[0]||(i[0]=c("div",{class:"skeleton-checkbox"},null,-1)),c("span",Pn,u(_.index),1)]),i[1]||(i[1]=go('<div class="image" data-v-037471a7><div class="skeleton-image lg" data-v-037471a7></div></div><div class="title" data-v-037471a7><div class="skeleton-text lg" style="width:40%;" data-v-037471a7></div></div><div class="subtitle" data-v-037471a7><div class="skeleton-text" style="width:30%;" data-v-037471a7></div></div><div class="actions" data-v-037471a7><div class="skeleton-text lg" style="width:240px;" data-v-037471a7></div></div>',4))]))}}}),Bn=le(Ln,[["__scopeId","data-v-037471a7"]]),Un={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Mn(F,_){return n(),l("svg",Un,_[0]||(_[0]=[c("path",{fill:"currentColor",d:"M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.587 1.413T20 20zm0-2h16V8h-8.825l-2-2H4zm0 0V6zm10-4v1q0 .425.288.713T15 16t.713-.288T16 15v-1h1q.425 0 .713-.288T18 13t-.288-.712T17 12h-1v-1q0-.425-.288-.712T15 10t-.712.288T14 11v1h-1q-.425 0-.712.288T12 13t.288.713T13 14z"},null,-1)]))}const An=Se({name:"material-symbols-create-new-folder-outline-rounded",render:Mn}),Hn=["onClick"],Rn=ee({__name:"FilesActionButtons",props:{currentDir:{type:String,required:!0},canPaste:{type:Boolean,required:!0},pasting:{type:Boolean,required:!0},refreshing:{type:Boolean,required:!0},sorting:{type:Boolean,required:!0},sortItems:{type:Array,required:!0},fileSortBy:{type:String,required:!0},showHidden:{type:Boolean,default:!1}},emits:["createDir","uploadFiles","uploadDir","pasteDir","refreshCurrentDir","sort","openKeyboardShortcuts","toggleShowHidden"],setup(F,{emit:_}){const i=_,T=q(!1),P=q(!1);function C(){i("createDir")}function m(h){i("uploadFiles",h)}function A(h){i("uploadDir",h)}function H(){i("pasteDir")}function I(){i("refreshCurrentDir")}function S(h){i("sort",h)}return(h,b)=>{const E=An,L=Te,e=_t,r=ht,M=en,s=ho,d=yo,B=ae("tooltip");return n(),l(U,null,[$((n(),D(L,{onClick:C},{default:f(()=>[v(E)]),_:1})),[[B,h.$t("create_folder")]]),v(r,{modelValue:T.value,"onUpdate:modelValue":b[2]||(b[2]=y=>T.value=y)},{trigger:f(()=>[$((n(),D(L,null,{default:f(()=>[v(e)]),_:1})),[[B,h.$t("upload")]])]),default:f(()=>[c("div",{class:"dropdown-item",onClick:b[0]||(b[0]=p(y=>{m(F.currentDir),T.value=!1},["stop"]))},u(h.$t("upload_files")),1),c("div",{class:"dropdown-item",onClick:b[1]||(b[1]=p(y=>{A(F.currentDir),T.value=!1},["stop"]))},u(h.$t("upload_folder")),1)]),_:1},8,["modelValue"]),F.canPaste?$((n(),D(L,{key:0,loading:F.pasting,onClick:H},{default:f(()=>[v(M)]),_:1},8,["loading"])),[[B,h.$t("paste")]]):R("",!0),$((n(),D(L,{loading:F.refreshing,onClick:I},{default:f(()=>[v(s)]),_:1},8,["loading"])),[[B,h.$t("refresh")]]),v(r,{modelValue:P.value,"onUpdate:modelValue":b[5]||(b[5]=y=>P.value=y)},{trigger:f(()=>[$((n(),D(L,{loading:F.sorting},{default:f(()=>[v(d)]),_:1},8,["loading"])),[[B,h.$t("sort")]])]),default:f(()=>[c("div",{class:"dropdown-item",onClick:b[3]||(b[3]=p(y=>{i("openKeyboardShortcuts"),P.value=!1},["stop"]))},u(h.$t("keyboard_shortcuts")),1),c("div",{class:Ce(["dropdown-item",{selected:F.showHidden}]),onClick:b[4]||(b[4]=p(y=>{i("toggleShowHidden"),P.value=!1},["stop"]))},u(h.$t("search_filter_show_hidden")),3),(n(!0),l(U,null,Fe(F.sortItems,y=>(n(),l("div",{key:y.value,class:Ce(["dropdown-item",{selected:y.value===F.fileSortBy}]),onClick:g=>{S(y.value),P.value=!1}},u(h.$t(y.label)),11,Hn))),128))]),_:1},8,["modelValue"])],64)}}}),zn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Kn(F,_){return n(),l("svg",zn,_[0]||(_[0]=[c("path",{fill:"currentColor",d:"m12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22t-2.825-1.175T2 18t1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6t1.175-2.825T6 2t2.825 1.175T10 6q0 .425-.075.85t-.275.8L20.6 18.6q.675.675.3 1.538T19.575 21q-.275 0-.537-.112t-.463-.313zm3-3l-2-2l5.575-5.575q.2-.2.463-.312T19.574 3q.95 0 1.313.875t-.313 1.55zM6 8q.825 0 1.413-.587T8 6t-.587-1.412T6 4t-1.412.588T4 6t.588 1.413T6 8m6 4.5q.2 0 .35-.15t.15-.35t-.15-.35t-.35-.15t-.35.15t-.15.35t.15.35t.35.15M6 20q.825 0 1.413-.587T8 18t-.587-1.412T6 16t-1.412.588T4 18t.588 1.413T6 20"},null,-1)]))}const On=Se({name:"material-symbols-content-cut-rounded",render:Kn}),Nn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Qn(F,_){return n(),l("svg",Nn,_[0]||(_[0]=[c("path",{fill:"currentColor",d:"M9 18q-.825 0-1.412-.587T7 16V4q0-.825.588-1.412T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.587 1.413T18 18zm0-2h9V4H9zm-4 6q-.825 0-1.412-.587T3 20V7q0-.425.288-.712T4 6t.713.288T5 7v13h10q.425 0 .713.288T16 21t-.288.713T15 22zm4-6V4z"},null,-1)]))}const Gn=Se({name:"material-symbols-content-copy-outline-rounded",render:Qn}),Wn=[{keys:["Delete"],description:"delete_selected"},{keys:["modifier","+","Backspace"],description:"delete_selected"},{keys:["modifier","+","A"],description:"select_all"},{keys:["Esc"],description:"clear_selection"},{keys:["Shift","+","Click"],description:"range_select"}],Xn=_o("files",{state:()=>({selectedFiles:[],isCut:!1})}),Zn={class:"top-app-bar"},jn={class:"title"},Yn={key:0},Jn={key:1,class:"breadcrumb"},xn={key:0},es=["onClick"],ts={key:0},os=["onClick"],ns={key:0,class:"actions"},ss={key:0,class:"secondary-actions"},is={key:1,class:"scroller-wrapper"},as={class:"scroller main-list"},ls={key:1,class:"no-data-placeholder"},vt=1e4,rs=ee({__name:"FilesView",setup(F){const _=Lo("isPhone"),{t:i}=ko(),T=q([]),{parseQ:P,buildQ:C}=zo(),m=Io({type:"",rootPath:"",showHidden:!1,text:"",parent:""}),A=Ho(),H=q(""),I=q([]),{selectedIds:S,allChecked:h,realAllChecked:b,clearSelection:E,toggleAllChecked:L,toggleSelect:e,total:r,checked:M,shiftEffectingIds:s,handleItemClick:d,handleMouseOver:B,selectAll:y,shouldSelect:g}=Jo(I),{keyDown:G,keyUp:te}=xo(y,E,()=>{Ke()}),W=q(!1),X=q(!1),z=q([]),w=q([]),It=t=>{z.value.push(t)},wt=t=>{w.value.push(t)},Ee=Bo(),oe=wo(),{fileSortBy:Y}=De(oe),Ve=$o(),{app:qe,urlTokenKey:K,uploads:de}=De(Ve),{selectedFiles:$t,isCut:Dt}=De(Xn()),{dropping:bt,fileDragEnter:Pe,fileDragLeave:Le,dropFiles:Ct}=tn(de),ne=it(()=>m.rootPath),{createPath:Ft,createVariables:Tt,createMutation:St}=Do(K,I),{renameItem:Et,renameDone:Vt,renameMutation:qt,renameVariables:Pt}=bo(()=>{N()}),{mounts:Lt,refetch:ue}=Co(),{downloadFile:J,downloadDir:ce,downloadFiles:Bt}=Eo(K),{view:Be}=Go(T,(t,o)=>{Ve.lightbox={sources:t,index:o,visible:!0}}),Ue=q(1),me=q(!1);function pe(){var t,o;Ue.value=parseInt(((t=A.query.page)==null?void 0:t.toString())??"1"),H.value=Ro(((o=A.query.q)==null?void 0:o.toString())??""),P(m,H.value)}pe();const Ut=it(()=>{const t=[];let o=m.parent;for(;o&&o!==ne.value;)t.unshift({path:o,name:Fo(o)}),o=o.substring(0,o.lastIndexOf("/"));return t.unshift({path:ne.value,name:Qt()}),t}),Me=q(!0),{loading:fe,fetch:N}=To({handle:async(t,o)=>{if(Me.value=!1,W.value=!1,X.value=!1,o)O(i(o),"error");else{const V=[];for(const we of t.files)V.push(Oo(we,K.value));I.value=V,r.value=V.length}},document:Ko,variables:()=>({root:ne.value,offset:(Ue.value-1)*vt,limit:vt,query:H.value,sortBy:Y.value}),options:{fetchPolicy:"cache-and-network"}}),{loading:Ae,canPaste:ve,copy:ge,cut:He,paste:he}=So(I,Dt,$t,N,ue),{input:Mt,upload:At,uploadChanged:Re}=ft(de),{input:Ht,upload:Rt,uploadChanged:ze}=ft(de),{loading:zt,mutate:Kt,onDone:Ot}=at({document:No});Ot(t=>{Bt(t.data.setTempValue.key),E()});const Nt=()=>{const t=I.value.filter(o=>S.value.includes(o.id));if(t.length===0){O(i("select_first"),"error");return}if(t.length===1){const o=t[0];o.isDir?ce(o.path):J(o.path),E();return}j(jo,{onEach:async()=>{for(const o of t)o.isDir?ce(o.path):J(o.path),await new Promise(V=>setTimeout(V,250));E()},onZip:()=>{Kt({key:Xo(),value:JSON.stringify(S.value.map(o=>({path:o})))})}})},ye=t=>{t.forEach(o=>{Wo(I.value,V=>V.id===o.id)}),r.value=I.value.length,E(),ue()},Ke=()=>{j(dt,{files:I.value.filter(t=>S.value.includes(t.id)),onDone:t=>{ye(t)}})};function Qt(){if(m.type==="SDCARD")return i("sdcard");if(m.type==="APP")return i("app_data");if(m.type==="USB_STORAGE"){const t=qe.value.usbDiskPaths.indexOf(m.rootPath),o=t!==-1?t+1:1;return`${i("usb_storage")} ${o}`}return i("internal_storage")}function Oe(){if(m.type==="APP")return i("app_data");const t=Lt.value.find(o=>o.mountPoint===m.rootPath);return t?`${i("storage_free_total",{free:ie(t.freeBytes??0),total:ie(t.totalBytes??0)})}`:""}function _e(t){E(),m.parent=t,m.text="";const o=C(m);lt(oe,Ne(o))}function Ne(t){return t?`/files?q=${t}`:"/files"}function Gt(t){if(t.isDir){_e(t.path);return}if(ut(t.name)){const o=ct(K.value,t.path);window.open(`/text-file?id=${encodeURIComponent(o)}`,"_blank")}else mt(t.name)?window.open(be(K.value,t.path),"_blank"):pt(t.name)?Be(I.value,t):J(t.path)}function Wt(t,o){if(!o.isDir)if(t.stopPropagation(),ut(o.name)){const V=ct(K.value,o.path);window.open(`/text-file?id=${encodeURIComponent(V)}`,"_blank")}else mt(o.name)?window.open(be(K.value,o.path),"_blank"):pt(o.name)?Be(I.value,o):J(o.path)}function Qe(t){Y.value!==t&&(X.value=!0,Y.value=t)}function Ge(){j(on,{title:i("keyboard_shortcuts"),shortcuts:Wn})}function We(){m.showHidden=!m.showHidden,oe.fileShowHidden=m.showHidden;const t=C(m);lt(oe,Ne(t))}function Xe(){W.value=!0,N()}const Ze=()=>{Ft.value=m.parent,j(rt,{title:i("create_folder"),placeholder:i("name"),mutation:St,getVariables:Tt})};function ke(t){At(t)}function Ie(t){Rt(t)}function Xt(){ge(S.value),E()}function Zt(){He(S.value),E()}function je(){he(m.parent)}function jt(t){ge([t.id]),he(m.parent)}function Yt(t){He([t.id])}function Jt(t){ge([t.id])}function xt(t){const o=be(K.value,t.path);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(o).then(()=>{O(i("link_copied"))}).catch(()=>{Ye(o)}):Ye(o)}function Ye(t){try{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();const V=document.execCommand("copy");document.body.removeChild(o),V?O(i("link_copied")):O(i("copy_failed"),"error")}catch(o){console.error("Failed to copy text: ",o),O(i("copy_failed"),"error")}}function eo(t){he(t.path)}function to(t){Et.value=t,j(rt,{title:i("rename"),placeholder:i("name"),value:t.name,mutation:qt,getVariables:Pt,done:Vt})}function oo(t){j(dt,{files:[t],onDone:ye})}const{mutate:no,loading:ds}=at({document:Qo,options:{update:()=>{Q.emit("refetch_app")}}});function so(t){if(!t.isDir)return;let o=ne.value;no({rootPath:o,fullPath:t.path}).then(()=>{O(i("added"))}).catch(V=>{console.error("Error adding favorite folder:",V),O(i("error"),"error")})}Vo(()=>A.fullPath,()=>{me.value&&(pe(),N())});const Je=t=>{t.status==="done"&&setTimeout(()=>{N(),ue()},1e3)},xe=t=>{ye([t.item])},et=t=>{N()};function io(t){Ct(t,m.parent,()=>!0)}return qo(()=>{me.value=!0,pe(),N(),Q.on("upload_task_done",Je),Q.on("file_deleted",xe),Q.on("file_renamed",et),window.addEventListener("keydown",G),window.addEventListener("keyup",te)}),Po(()=>{me.value=!1,Q.off("upload_task_done",Je),Q.off("file_deleted",xe),Q.off("file_renamed",et),window.removeEventListener("keydown",G),window.removeEventListener("keyup",te)}),(t,o)=>{const V=kt,we=Gn,se=Te,ao=On,lo=yt,ro=gt,tt=Rn,uo=Bn,co=En,Z=ae("tooltip");return n(),l(U,null,[c("div",Zn,[v(V,{"touch-target":"wrapper",checked:a(h),indeterminate:!a(h)&&a(M),onChange:a(L)},null,8,["checked","indeterminate","onChange"]),c("div",jn,[a(S).length?(n(),l("span",Yn,u(t.$t("x_selected",{count:a(b)?a(r).toLocaleString():a(S).length.toLocaleString()})),1)):(n(),l("div",Jn,[(n(!0),l(U,null,Fe(Ut.value,(k,$e)=>(n(),l(U,{key:k.path},[$e===0?(n(),l(U,{key:0},[k.path===m.parent?$((n(),l("span",xn,[x(u(k.name)+" ("+u(a(r))+")",1)])),[[Z,Oe()]]):$((n(),l("a",{key:1,href:"#",onClick:p(mo=>_e(k.path),["stop","prevent"])},[x(u(k.name),1)],8,es)),[[Z,Oe()]])],64)):(n(),l(U,{key:1},[o[4]||(o[4]=c("span",{class:"sep"},"/",-1)),k.path===m.parent?(n(),l("span",ts,u(k.name)+" ("+u(a(r))+")",1)):(n(),l("a",{key:1,href:"#",onClick:p(mo=>_e(k.path),["stop","prevent"])},u(k.name),9,os))],64))],64))),128))])),a(M)?(n(),l(U,{key:2},[$((n(),D(se,{onClick:p(Xt,["stop"])},{default:f(()=>[v(we)]),_:1})),[[Z,t.$t("copy")]]),$((n(),D(se,{onClick:p(Zt,["stop"])},{default:f(()=>[v(ao)]),_:1})),[[Z,t.$t("cut")]]),$((n(),D(se,{onClick:p(Ke,["stop"])},{default:f(()=>[v(lo)]),_:1})),[[Z,t.$t("delete")]]),$((n(),D(se,{loading:a(zt),onClick:p(Nt,["stop"])},{default:f(()=>[v(ro)]),_:1},8,["loading"])),[[Z,t.$t("download")]])],64)):R("",!0)]),!a(_)&&!a(M)?(n(),l("div",ns,[v(tt,{"current-dir":m.parent,"can-paste":a(ve)(),pasting:a(Ae),refreshing:W.value,sorting:X.value,"sort-items":a(Ee),"file-sort-by":a(Y),"show-hidden":m.showHidden,onCreateDir:Ze,onUploadFiles:ke,onUploadDir:Ie,onPasteDir:je,onRefreshCurrentDir:Xe,onSort:Qe,onOpenKeyboardShortcuts:Ge,onToggleShowHidden:We},null,8,["current-dir","can-paste","pasting","refreshing","sorting","sort-items","file-sort-by","show-hidden"])])):R("",!0)]),a(_)&&!a(M)?(n(),l("div",ss,[v(tt,{"current-dir":m.parent,"can-paste":a(ve)(),pasting:a(Ae),refreshing:W.value,sorting:X.value,"sort-items":a(Ee),"file-sort-by":a(Y),"show-hidden":m.showHidden,onCreateDir:Ze,onUploadFiles:ke,onUploadDir:Ie,onPasteDir:je,onRefreshCurrentDir:Xe,onSort:Qe,onOpenKeyboardShortcuts:Ge,onToggleShowHidden:We},null,8,["current-dir","can-paste","pasting","refreshing","sorting","sort-items","file-sort-by","show-hidden"])])):R("",!0),a(fe)&&Me.value?(n(),l("div",is,[c("div",as,[(n(),l(U,null,Fe(20,k=>v(uo,{key:k,index:k,"is-phone":a(_)},null,8,["index","is-phone"])),64))])])):R("",!0),c("div",{class:"scroller-wrapper",onDragover:o[3]||(o[3]=p((...k)=>a(Pe)&&a(Pe)(...k),["stop","prevent"]))},[$(c("div",{class:"drag-mask",onDrop:p(io,["stop","prevent"]),onDragleave:o[0]||(o[0]=p((...k)=>a(Le)&&a(Le)(...k),["stop","prevent"]))},u(t.$t("release_to_send_files")),545),[[Uo,a(bt)]]),I.value.length>0?(n(),D(a(Mo),{key:0,class:"scroller main-list","data-key":"id","data-sources":I.value,"estimate-size":80},{item:f(({index:k,item:$e})=>[v(co,{item:$e,index:k,"selected-ids":a(S),"shift-effecting-ids":a(s),"should-select":a(g),"is-phone":a(_),"image-error-ids":z.value,"extension-image-error-ids":w.value,"can-paste":a(ve)(),"handle-item-click":a(d),"handle-mouse-over":a(B),"toggle-select":a(e),"on-image-error":It,"on-extension-image-error":wt,"view-item":Wt,"click-item":Gt,onDownloadDir:a(ce),onDownloadFile:a(J),onUploadFiles:ke,onUploadDir:Ie,onDeleteItem:oo,onDuplicateItem:jt,onCutItem:Yt,onCopyItem:Jt,onPasteItem:eo,onCopyLink:xt,onRenameItem:to,onAddToFavorites:so},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","image-error-ids","extension-image-error-ids","can-paste","handle-item-click","handle-mouse-over","toggle-select","onDownloadDir","onDownloadFile"])]),_:1},8,["data-sources"])):R("",!0),!a(fe)&&I.value.length===0?(n(),l("div",ls,u(t.$t(a(Ao)(a(fe),a(qe).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):R("",!0),c("input",{ref_key:"fileInput",ref:Mt,style:{display:"none"},type:"file",multiple:"",onChange:o[1]||(o[1]=(...k)=>a(Re)&&a(Re)(...k))},null,544),c("input",{ref_key:"dirFileInput",ref:Ht,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:o[2]||(o[2]=(...k)=>a(ze)&&a(ze)(...k))},null,544)],32)],64)}}}),ks=le(rs,[["__scopeId","data-v-423f26d4"]]);export{ks as default};
