import{_ as Me}from"./VPagination.vuevuetypescriptsetuptruelang-qEU1ylFt.js";import{_ as Ne,u as Ve,a as Qe,b as Ge}from"./key-events-B6Z678ov.js";import{d as O,c as u,O as _,o as a,a as n,ar as Oe,t as d,$ as w,a1 as j,H as de,A as y,v as b,j as c,as as ce,ai as me,u as ue,T as re,k as t,at as se,au as Re,a9 as le,I as U,aa as ae,L as pe,e as Fe,s as Ke,f as Ue,r as P,M as je,ad as ze,ae as He,av as We,N as Je,i as Ye,w as Ze,Y as Xe,Z as xe,h as Q,W as G,U as ne,a3 as et,aw as tt,G as st,J as lt,K as at,a6 as nt,C as ot,ab as oe,an as it,ap as dt,ax as ct,ac as C,Q as mt,R as ut,ay as rt}from"./index-Bsb9VlRU.js";import{_ as pt}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-DEHCK6e4.js";import{_ as ge}from"./VCheckbox-Cc39_B7Y.js";import{_ as gt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BqQhfyFX.js";import{_ as _t}from"./FieldId.vuevuetypescriptsetuptruelang-BY8t1FUN.js";import{_ as vt}from"./call-outline-rounded-6vzRlDBh.js";const ht={key:0,class:"call-item selectable-card-skeleton"},ft={class:"start"},yt={class:"number"},kt=O({__name:"CallSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(B){return(k,m)=>{const r=Ne;return k.isPhone?(a(),_(r,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"}],"action-count":3})):(a(),u("section",ht,[n("div",ft,[m[0]||(m[0]=n("div",{class:"skeleton-checkbox"},null,-1)),n("span",yt,d(k.index),1)]),m[1]||(m[1]=Oe('<div class="title"><div class="skeleton-text lg" style="width:160px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80px;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="geo"><div class="skeleton-text" style="width:100px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),It={class:"actions"},ie=O({__name:"CallActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["deleteItem","call","addItemToTags"],setup(B,{emit:k}){const m=B,r=k;function v(){r("deleteItem",m.item)}function L(){r("call",m.item)}function S(){r("addItemToTags",m.item)}return(p,e)=>{const l=ce,g=de,h=vt,I=me,$=j("tooltip");return a(),u("div",It,[w((a(),_(g,{onClick:y(v,["stop"])},{default:b(()=>[c(l)]),_:1})),[[$,p.$t("delete")]]),w((a(),_(g,{loading:p.callLoading&&p.callId===p.item.id,onClick:y(L,["stop"])},{default:b(()=>[c(h)]),_:1},8,["loading"])),[[$,p.$t("make_a_phone_call")]]),w((a(),_(g,{onClick:y(S,["stop"])},{default:b(()=>[c(I)]),_:1})),[[$,p.$t("add_to_tags")]])])}}}),Ct={class:"start"},bt={class:"number"},$t={class:"title"},Tt={class:"subtitle"},wt={class:"geo"},Lt={class:"time"},St={class:"subtitle"},At={class:"geo"},qt={class:"time"},Dt=O({__name:"CallListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["deleteItem","call","addItemToTags"],setup(B,{emit:k}){const{t:m}=ue(),r=k;function v(e){r("deleteItem",e)}function L(e){r("call",e)}function S(e){r("addItemToTags",e)}function p(e){if(!e)return"";const l=[];return e.isp&&l.push(m("phone_isp_type."+e.isp)),e.city===e.province?l.push(e.city):l.push(`${e.province}${e.city}`),l.join(", ")}return(e,l)=>{const g=ge,h=_t,I=Re,$=gt,M=j("tooltip");return e.isPhone?(a(),_($,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:l[4]||(l[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:l[5]||(l[5]=y(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:l[6]||(l[6]=i=>e.toggleSelect(i,e.item,e.index))},{title:b(()=>[U(d(e.item.name?e.item.name+" "+e.item.number:e.item.number),1)]),subtitle:b(()=>[n("div",St,[n("span",null,d(t(se)(e.item.duration)),1),n("span",null,d(e.$t("call_type."+e.item.type)),1),c(I,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),n("div",At,d(p(e.item.geo)),1),n("div",qt,[w((a(),u("span",null,[U(d(t(ae)(e.item.startedAt)),1)])),[[M,t(le)(e.item.startedAt)]])])]),actions:b(()=>[c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:v,onCall:L,onAddItemToTags:S},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(a(),u("section",{key:0,class:re(["call-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:l[2]||(l[2]=y(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:l[3]||(l[3]=y(i=>e.handleMouseOver(i,e.index),["stop"]))},[n("div",Ct,[e.shiftEffectingIds.includes(e.item.id)?(a(),_(g,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:l[0]||(l[0]=y(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(a(),_(g,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:l[1]||(l[1]=y(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),n("span",bt,[c(h,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),n("div",$t,d(e.item.name?e.item.name+" "+e.item.number:e.item.number),1),n("div",Tt,[n("span",null,d(t(se)(e.item.duration)),1),n("span",null,d(e.$t("call_type."+e.item.type)),1),c(I,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onDeleteItem:v,onCall:L,onAddItemToTags:S},null,8,["item","call-loading","call-id"]),n("div",wt,d(p(e.item.geo)),1),n("div",Lt,[w((a(),u("span",null,[U(d(t(ae)(e.item.startedAt)),1)])),[[M,t(le)(e.item.startedAt)]])])],34))}}}),Et=pe(Dt,[["__scopeId","data-v-b29c6d56"]]),Pt={class:"top-app-bar"},Bt={class:"title"},Mt={key:0},Nt={key:1},Vt={class:"scroll-content"},Qt={key:0,class:"no-data-placeholder"},D=50,Gt=O({__name:"CallsView",setup(B){const k=at("isPhone"),m=Fe(),{app:r}=Ke(Ue()),v=P([]),{t:L}=ue(),{parseQ:S}=ut(),p=je({tagIds:[]}),e=ze.CALL,l=nt(),g=P(1),h=P(""),{tags:I,fetch:$}=He(e),{addToTags:M}=We(e,I),{deleteItems:i}=Ve(rt,()=>{N(),V(),C.emit("refetch_tags",e),C.emit("calls_deleted")}),{selectedIds:A,allChecked:z,realAllChecked:E,selectRealAll:_e,allCheckedAlertVisible:ve,clearSelection:N,toggleAllChecked:he,toggleSelect:fe,total:f,checked:R,shiftEffectingIds:ye,handleItemClick:ke,handleMouseOver:Ie,selectAll:Ce,shouldSelect:be}=Qe(v),H=s=>{const o=l.query.q;ot(m,o?`/calls?page=${s}&q=${o}`:`/calls?page=${s}`)},{keyDown:W,keyUp:J}=Ge(f,D,g,Ce,N,H,()=>{i(A.value,E.value,f.value,h.value)}),{loading:F,fetch:V}=Je({handle:(s,o)=>{o?st(L(o),"error"):s&&(v.value=s.calls,f.value=s.callCount)},document:tt,variables:()=>({offset:(g.value-1)*D,limit:D,query:h.value})});function $e(s){oe(it,{type:e,tags:I.value,item:{key:s.id,title:"",size:0},selected:I.value.filter(o=>s.tags.some(q=>q.id===o.id))})}const Y=s=>{s.type===e&&(N(),V())},Z=s=>{s.type===e&&V()},X=P(""),{mutate:Te,loading:we}=Ye({document:lt});function Le(s){X.value=s.id,Te({number:s.number})}function Se(s){oe(ct,{id:s.id,name:s.number,gql:dt`
      mutation DeleteCall($query: String!) {
        deleteCalls(query: $query)
      }
    `,variables:()=>({query:`ids:${s.id}`}),typeName:"Call",done:()=>{f.value--,s.tags.length&&C.emit("refetch_tags",e),C.emit("calls_deleted")}})}const K=P(!1);function x(){var o,q;const s=parseInt(((o=l.query.page)==null?void 0:o.toString())??"1");g.value=Number.isFinite(s)&&s>0?s:1,h.value=mt(((q=l.query.q)==null?void 0:q.toString())??""),S(p,h.value),V()}return Ze(()=>l.fullPath,()=>{K.value&&x()}),Xe(()=>{$(),K.value=!0,x(),C.on("item_tags_updated",Z),C.on("items_tags_updated",Y),window.addEventListener("keydown",W),window.addEventListener("keyup",J)}),xe(()=>{K.value=!1,C.off("item_tags_updated",Z),C.off("items_tags_updated",Y),window.removeEventListener("keydown",W),window.removeEventListener("keyup",J)}),(s,o)=>{const q=ge,Ae=ce,ee=de,qe=me,De=pt,Ee=kt,Pe=Me,te=j("tooltip");return a(),u(G,null,[n("div",Pt,[c(q,{"touch-target":"wrapper",checked:t(z),indeterminate:!t(z)&&t(R),onChange:t(he)},null,8,["checked","indeterminate","onChange"]),n("div",Bt,[t(A).length?(a(),u("span",Mt,d(s.$t("x_selected",{count:t(E)?t(f).toLocaleString():t(A).length.toLocaleString()})),1)):(a(),u("span",Nt,d(s.$t("page_title.calls"))+" ("+d(t(f).toLocaleString())+")",1)),t(R)?(a(),u(G,{key:2},[w((a(),_(ee,{onClick:o[0]||(o[0]=y(T=>t(i)(t(A),t(E),t(f),h.value),["stop"]))},{default:b(()=>[c(Ae)]),_:1})),[[te,s.$t("delete")]]),w((a(),_(ee,{onClick:o[1]||(o[1]=y(T=>t(M)(t(A),t(E),h.value),["stop"]))},{default:b(()=>[c(qe)]),_:1})),[[te,s.$t("add_to_tags")]])],64)):Q("",!0)]),o[2]||(o[2]=n("div",{class:"actions"},null,-1))]),c(De,{limit:D,total:t(f),"all-checked-alert-visible":t(ve),"real-all-checked":t(E),"select-real-all":t(_e),"clear-selection":t(N)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",Vt,[n("div",{class:re(["main-list",{"select-mode":t(R)}])},[(a(!0),u(G,null,ne(v.value,(T,Be)=>(a(),_(Et,{key:T.id,item:T,index:Be,"selected-ids":t(A),"shift-effecting-ids":t(ye),"should-select":t(be),"is-phone":t(k),"data-type":t(e),"call-loading":t(we),"call-id":X.value,"handle-item-click":t(ke),"handle-mouse-over":t(Ie),"toggle-select":t(fe),onDeleteItem:Se,onCall:Le,onAddItemToTags:$e},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(F)&&v.value.length===0?(a(),u(G,{key:0},ne(20,T=>c(Ee,{key:T,index:T,"is-phone":t(k)},null,8,["index","is-phone"])),64)):Q("",!0)],2),!t(F)&&v.value.length===0?(a(),u("div",Qt,d(s.$t(t(et)(t(F),t(r).permissions,"WRITE_CALL_LOG"))),1)):Q("",!0),t(f)>D?(a(),_(Pe,{key:1,page:g.value,go:H,total:t(f),limit:D},null,8,["page","total"])):Q("",!0)])],64)}}}),Wt=pe(Gt,[["__scopeId","data-v-01c705c2"]]);export{Wt as default};
