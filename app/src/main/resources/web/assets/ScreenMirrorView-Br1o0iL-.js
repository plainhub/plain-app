var bt=Object.defineProperty;var Ct=(a,e,i)=>e in a?bt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var F=(a,e,i)=>Ct(a,typeof e!="symbol"?e+"":e,i);import{m as H,c as m,o as r,a as c,c6 as Me,c7 as kt,r as k,aj as Mt,c8 as $t,d as $e,M as _,v as f,j as y,I,t as h,B as Se,aL as St,aK as Te,L as Le,u as Ee,G as V,c9 as Ie,s as Lt,f as Et,aD as we,w as qe,g as It,i as j,a7 as B,Z as Rt,$ as Dt,Y as Pt,h as Q,a0 as ee,k as C,aW as Ht,aX as Ot,c1 as At,O as E,P as xt,H as Bt,aE as be,al as Qt,an as Vt,R as G,bI as zt,am as Yt,ca as Xt,au as Ft,a5 as Gt,cb as Ut,cc as Wt,cd as jt,ce as Nt,cf as Kt,cg as Zt,ch as Jt,ci as en,cj as tn,ck as nn,cl as on,bt as sn,bJ as rn}from"./index-DZRXRZ01.js";import{t as te}from"./tapphone-BNQXbvok.js";const an={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function cn(a,e){return r(),m("svg",an,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M10.475 22q-.7 0-1.312-.3t-1.038-.85L3.1 14.475q-.2-.225-.175-.537t.225-.513q.5-.525 1.2-.625t1.3.275L7.5 14.2V6q0-.425.288-.712T8.5 5t.725.288t.3.712v5H17q1.25 0 2.125.875T20 14v4q0 1.65-1.175 2.825T16 22zm1.5-13q-.425 0-.712-.288T10.975 8q0-.05.125-.5q.2-.35.3-.712T11.5 6q0-1.25-.875-2.125T8.5 3t-2.125.875T5.5 6q0 .425.1.788t.3.712q.075.125.1.25t.025.25q0 .425-.275.713T5.05 9q-.275 0-.512-.15t-.363-.375q-.325-.55-.5-1.175T3.5 6q0-2.075 1.463-3.537T8.5 1t3.538 1.463T13.5 6q0 .675-.175 1.3t-.5 1.175q-.125.225-.35.375t-.5.15"},null,-1)]))}const ln=H({name:"material-symbols-touch-app-rounded",render:cn}),dn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function un(a,e){return r(),m("svg",dn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 19q-2.925 0-4.962-2.037T5 12t2.038-4.962T12 5t4.963 2.038T19 12t-2.037 4.963T12 19"},null,-1)]))}const pn=H({name:"material-symbols-fiber-manual-record",render:un}),_n={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mn(a,e){return r(),m("svg",_n,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z"},null,-1)]))}const vn=H({name:"material-symbols-check-rounded",render:mn}),fn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function hn(a,e){return r(),m("svg",fn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 16V8q0-.825.588-1.412T8 6h8q.825 0 1.413.588T18 8v8q0 .825-.587 1.413T16 18H8q-.825 0-1.412-.587T6 16"},null,-1)]))}const gn=H({name:"material-symbols-stop-rounded",render:hn}),yn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tn(a,e){return r(),m("svg",yn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 21q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h14q.825 0 1.413.587Q21 4.175 21 5v14q0 .825-.587 1.413Q19.825 21 19 21Zm0-2h14V5H5v14Zm0 0V5v14Z"},null,-1)]))}const wn=H({name:"material-symbols-crop-square-outline",render:Tn}),qn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function bn(a,e){return r(),m("svg",qn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1)]))}const Cn=H({name:"material-symbols-circle-outline",render:bn}),kn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Mn(a,e){return r(),m("svg",kn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M19 11.975q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.063T21 11.974t-1.45 4.913t-3.875 3.287q-.4.175-.788 0t-.537-.575q-.125-.375.05-.737t.55-.538q1.85-.85 2.95-2.562t1.1-3.788M7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h3l3.3-3.3q.475-.475 1.088-.213t.612.938v11.15q0 .675-.612.938T10.3 18.3zm9.5-3q0 1.05-.475 1.988t-1.25 1.537q-.25.15-.513.013T14 15.1V8.85q0-.3.263-.437t.512.012q.775.625 1.25 1.575t.475 2"},null,-1)]))}const $n=H({name:"material-symbols-volume-up-rounded",render:Mn}),Sn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ln(a,e){return r(),m("svg",Sn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M16.775 19.575q-.275.175-.55.325t-.575.275q-.375.175-.762 0t-.538-.575q-.15-.375.038-.737t.562-.538q.1-.05.188-.1t.187-.1L12 14.8v2.775q0 .675-.612.938T10.3 18.3L7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h2.2L2.1 4.9q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l17 17q.275.275.275.7t-.275.7t-.7.275t-.7-.275zm2.225-7.6q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.05T21 11.975q0 .825-.15 1.638t-.425 1.562q-.2.55-.612.688t-.763.012t-.562-.45t-.013-.75q.275-.65.4-1.312T19 11.975m-4.225-3.55Q15.6 8.95 16.05 10t.45 2v.25q0 .125-.025.25q-.05.325-.35.425t-.55-.15L14.3 11.5q-.15-.15-.225-.337T14 10.775V8.85q0-.3.263-.437t.512.012M9.75 6.95Q9.6 6.8 9.6 6.6t.15-.35l.55-.55q.475-.475 1.087-.213t.613.938V8q0 .35-.3.475t-.55-.125z"},null,-1)]))}const En=H({name:"material-symbols-volume-off-rounded",render:Ln}),In={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Rn(a,e){return r(),m("svg",In,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"},null,-1)]))}const Dn=H({name:"material-symbols-fullscreen-rounded",render:Rn}),Pn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Hn(a,e){return r(),m("svg",Pn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"},null,-1)]))}const On=H({name:"material-symbols-fullscreen-exit-rounded",render:Hn}),An={xmlns:"http://www.w3.org/2000/svg",viewBox:"176.31 -11.19 346.88 581.88"};function xn(a,e){return r(),m("svg",An,e[0]||(e[0]=[c("path",{d:"M470.49 0H229.51a41.9 41.9 0 0 0-29.547 12.277 41.9 41.9 0 0 0-12.277 29.547v476.35a41.9 41.9 0 0 0 12.277 29.547 41.9 41.9 0 0 0 29.547 12.277h240.98a41.9 41.9 0 0 0 29.547-12.277 41.9 41.9 0 0 0 12.277-29.547V41.824a41.9 41.9 0 0 0-12.277-29.547A41.9 41.9 0 0 0 470.49 0m33.25 518.18a33.33 33.33 0 0 1-9.766 23.484 33.34 33.34 0 0 1-23.484 9.766H229.51a33.33 33.33 0 0 1-23.484-9.766 33.34 33.34 0 0 1-9.765-23.484V41.83a33.33 33.33 0 0 1 9.828-23.371 33.32 33.32 0 0 1 23.422-9.703h240.98a33.33 33.33 0 0 1 23.484 9.765 33.34 33.34 0 0 1 9.765 23.484z"},null,-1),c("path",{d:"M317.62 46.812h64.75c2.418 0 4.375-1.957 4.375-4.375s-1.957-4.375-4.375-4.375h-64.75c-2.418 0-4.375 1.957-4.375 4.375s1.957 4.375 4.375 4.375M364.7 192.5a16.8 16.8 0 0 0-14.7-8.75 16.8 16.8 0 0 0-14.698 8.75l-91 157.5a16.45 16.45 0 0 0 0 16.977 16.6 16.6 0 0 0 6.101 6.386 16.65 16.65 0 0 0 8.512 2.364h182.09a16.626 16.626 0 0 0 14.7-8.75 16.8 16.8 0 0 0 0-16.977zm83.562 170.36a8.22 8.22 0 0 1-7.262 4.2H258.91a8.23 8.23 0 0 1-7.176-4.2 8.75 8.75 0 0 1 0-8.75l91-157.5a8.75 8.75 0 0 1 7.262-4.113 8.76 8.76 0 0 1 7.262 4.199l91 157.5a8.75 8.75 0 0 1 0 8.84z"},null,-1),c("path",{d:"M350 221.55a4.29 4.29 0 0 0-4.29 4.285v66.238a4.375 4.375 0 0 0 8.75 0v-66.238a4.286 4.286 0 0 0-4.46-4.285m0 91.26a4.29 4.29 0 0 0-4.29 4.29v17.061a4.375 4.375 0 0 0 8.75 0V317.1a4.286 4.286 0 0 0-4.46-4.29"},null,-1)]))}const Bn={render:xn};class Qn{constructor(e){F(this,"pc",null);F(this,"options");F(this,"audioEnabled",!1);F(this,"remoteDescriptionSet",!1);F(this,"pendingIceCandidates",[]);this.options=e}async startSession(e,i=!0){this.audioEnabled=e,this.cleanup(),this.remoteDescriptionSet=!1,this.pendingIceCandidates=[];const s={iceServers:[],iceCandidatePoolSize:0};if(this.pc=new RTCPeerConnection(s),this.pc.ontrack=n=>{try{const d=n.receiver;"jitterBufferTarget"in d&&(d.jitterBufferTarget=0)}catch{}if(n.streams&&n.streams.length>0)this.options.onStream(n.streams[0]);else{const d=new MediaStream;d.addTrack(n.track),this.options.onStream(d)}},this.pc.onicecandidate=n=>{n.candidate&&this.options.sendSignaling({type:"ice_candidate",candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid??void 0,sdpMLineIndex:n.candidate.sdpMLineIndex??void 0})},this.pc.onconnectionstatechange=()=>{this.pc&&this.options.onConnectionStateChange(this.pc.connectionState)},this.pc.oniceconnectionstatechange=()=>{var n;console.log("ICE connection state:",(n=this.pc)==null?void 0:n.iceConnectionState)},this.pc.addTransceiver("video",{direction:"recvonly"}),e&&this.pc.addTransceiver("audio",{direction:"recvonly"}),i)try{const n=await this.pc.createOffer();await this.pc.setLocalDescription(n),this.options.sendSignaling({type:"offer",sdp:n.sdp,sdpMid:e?"audio_enabled":"audio_disabled"})}catch(n){this.options.onError(`Failed to create offer: ${n}`)}else this.options.sendSignaling({type:"ready"})}async handleOffer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"offer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates();const s=await this.pc.createAnswer();await this.pc.setLocalDescription(s),this.options.sendSignaling({type:"answer",sdp:s.sdp})}catch(i){this.options.onError(`Failed to handle offer: ${i}`)}}async handleAnswer(e){if(!this.pc){console.error("PeerConnection not initialized");return}try{const i=new RTCSessionDescription({type:"answer",sdp:e});await this.pc.setRemoteDescription(i),this.remoteDescriptionSet=!0,await this.flushPendingIceCandidates(),console.log("Remote description (answer) set successfully")}catch(i){this.options.onError(`Failed to set remote description: ${i}`)}}async handleIceCandidate(e,i,s){if(!this.pc){console.error("PeerConnection not initialized");return}if(!this.remoteDescriptionSet){this.pendingIceCandidates.push({candidate:e,sdpMid:i,sdpMLineIndex:s});return}try{await this.pc.addIceCandidate(new RTCIceCandidate({candidate:e,sdpMid:i??"",sdpMLineIndex:s??0}))}catch(n){console.error("Failed to add ICE candidate:",n)}}async flushPendingIceCandidates(){var i;const e=this.pendingIceCandidates;this.pendingIceCandidates=[];for(const s of e)try{await((i=this.pc)==null?void 0:i.addIceCandidate(new RTCIceCandidate({candidate:s.candidate,sdpMid:s.sdpMid??"",sdpMLineIndex:s.sdpMLineIndex??0})))}catch(n){console.error("Failed to add buffered ICE candidate:",n)}}setAudioEnabled(e){var i;if(this.audioEnabled=e,this.pc){const s=this.pc.getReceivers();for(const n of s)((i=n.track)==null?void 0:i.kind)==="audio"&&(n.track.enabled=e)}}isAudioEnabled(){return this.audioEnabled}async handleSignalingMessage(e){switch(e.type){case"offer":e.sdp&&await this.handleOffer(e.sdp);break;case"answer":e.sdp&&await this.handleAnswer(e.sdp);break;case"ice_candidate":e.candidate&&await this.handleIceCandidate(e.candidate,e.sdpMid,e.sdpMLineIndex);break;default:console.warn("Unknown signaling message type:",e.type)}}cleanup(){this.remoteDescriptionSet=!1,this.pendingIceCandidates=[],this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close(),this.pc=null)}getConnectionState(){var e;return((e=this.pc)==null?void 0:e.connectionState)??null}}function Vn(a){Me.a.mutate({mutation:kt,variables:{payload:a}}).catch(e=>{console.error("Failed to send WebRTC signaling via GraphQL:",e)})}function X(a){Me.a.mutate({mutation:$t,variables:{input:a}}).catch(e=>{console.error("Failed to send screen mirror control:",e)})}function ae(a,e,i){const s=i.getBoundingClientRect(),n=i.videoWidth,d=i.videoHeight;if(!n||!d)return null;const v=s.width,T=s.height,M=v/T,R=n/d;let g,w,q,S;R>M?(g=v,w=v/R,q=0,S=(T-w)/2):(w=T,g=T*R,q=(v-g)/2,S=0);const L=a-s.left-q,o=e-s.top-S;return L<0||L>g||o<0||o>w?null:{x:Math.max(0,Math.min(1,L/g)),y:Math.max(0,Math.min(1,o/w))}}const Ce=500,ce=10;function zn(a){const e=document.createElement("div");return e.className="touch-indicator",a.appendChild(e),e}function Re(a,e,i){a.style.left=`${e}px`,a.style.top=`${i}px`}function Yn(a,e,i){Re(a,e,i),a.classList.remove("touch-indicator--fade-out"),a.classList.add("touch-indicator--active")}function ke(a,e){e&&a.classList.add("touch-indicator--ripple"),a.classList.remove("touch-indicator--active"),a.classList.add("touch-indicator--fade-out");const i=()=>{a.classList.remove("touch-indicator--fade-out","touch-indicator--ripple"),a.removeEventListener("transitionend",i)};a.addEventListener("transitionend",i,{once:!0})}function Xn(a,e){const i=k();let s=null,n=null;const d=(o,p)=>{const u=i.value;if(!u)return null;const b=u.getBoundingClientRect();return{lx:o-b.left,ly:p-b.top}},v=o=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(o.clientX,o.clientY,p);if(!u)return;o.preventDefault(),o.target.setPointerCapture(o.pointerId),s={startX:u.x,startY:u.y,startClientX:o.clientX,startClientY:o.clientY,startTime:Date.now(),longPressTimer:null,isLongPress:!1,pointerId:o.pointerId};const b=d(o.clientX,o.clientY);b&&n&&Yn(n,b.lx,b.ly),s.longPressTimer=setTimeout(()=>{s&&(s.isLongPress=!0,n==null||n.classList.add("touch-indicator--long-press"),X({action:"LONG_PRESS",x:s.startX,y:s.startY,duration:Ce}))},Ce)},T=o=>{if(!s||!e.value)return;const p=o.clientX-s.startClientX,u=o.clientY-s.startClientY,b=Math.sqrt(p*p+u*u),O=d(o.clientX,o.clientY);O&&n&&Re(n,O.lx,O.ly),b>ce&&s.longPressTimer&&(clearTimeout(s.longPressTimer),s.longPressTimer=null,n==null||n.classList.add("touch-indicator--dragging"))},M=o=>{if(!s||!e.value)return;const p=a.value;if(!p){s=null;return}s.longPressTimer&&(clearTimeout(s.longPressTimer),s.longPressTimer=null);const u=o.clientX-s.startClientX,b=o.clientY-s.startClientY,O=Math.sqrt(u*u+b*b),A=Date.now()-s.startTime,$=!s.isLongPress&&O<=ce;if(n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),ke(n,$)),!s.isLongPress)if(O>ce){const z=ae(o.clientX,o.clientY,p);z&&X({action:"SWIPE",x:s.startX,y:s.startY,endX:z.x,endY:z.y,duration:Math.max(A,100)})}else X({action:"TAP",x:s.startX,y:s.startY});s=null},R=()=>{s!=null&&s.longPressTimer&&clearTimeout(s.longPressTimer),n&&(n.classList.remove("touch-indicator--dragging","touch-indicator--long-press"),ke(n,!1)),s=null},g=o=>{if(!e.value)return;const p=a.value;if(!p)return;const u=ae(o.clientX,o.clientY,p);u&&(o.preventDefault(),X({action:"SCROLL",x:u.x,y:u.y,deltaX:o.deltaX,deltaY:o.deltaY}))},w=o=>{if(!e.value)return;let p=!0;switch(o.key){case"Escape":case"Backspace":X({action:"BACK"});break;case"Home":X({action:"HOME"});break;default:p=!1}p&&(o.preventDefault(),o.stopPropagation())},q=o=>{n&&n.parentElement&&(n.parentElement.removeChild(n),n=null),i.value=o,o&&(n=zn(o))},S=()=>{const o=i.value;o&&(o.addEventListener("pointerdown",v),o.addEventListener("pointermove",T),o.addEventListener("pointerup",M),o.addEventListener("pointercancel",R),o.addEventListener("wheel",g,{passive:!1}),o.addEventListener("keydown",w))},L=()=>{const o=i.value;o&&(o.removeEventListener("pointerdown",v),o.removeEventListener("pointermove",T),o.removeEventListener("pointerup",M),o.removeEventListener("pointercancel",R),o.removeEventListener("wheel",g),o.removeEventListener("keydown",w))};return Mt(()=>{L(),s!=null&&s.longPressTimer&&clearTimeout(s.longPressTimer),n&&n.parentElement&&(n.parentElement.removeChild(n),n=null)}),{overlayRef:i,attachOverlay:q,setupListeners:S,removeListeners:L,sendControl:X}}const Fn={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Gn(a,e){return r(),m("svg",Fn,e[0]||(e[0]=[c("path",{fill:"currentColor",d:"M12 6q-.825 0-1.412-.587T10 4t.588-1.412T12 2t1.413.588T14 4t-.587 1.413T12 6M9 21V9q-1.225-.1-2.475-.275t-2.45-.45q-.425-.1-.687-.475T3.25 7t.525-.625t.85-.1q1.75.375 3.638.55T12 7t3.738-.175t3.637-.55q.45-.1.85.1T20.75 7t-.137.8t-.688.475q-1.2.275-2.45.45T15 9v12q0 .425-.287.713T14 22t-.712-.288T13 21v-5h-2v5q0 .425-.288.713T10 22t-.712-.288T9 21"},null,-1)]))}const Un=H({name:"material-symbols-accessibility-new-rounded",render:Gn}),Wn={class:"accessibility-guide"},jn={class:"guide-icon"},Nn={class:"guide-text"},Kn={class:"guide-steps"},Zn={class:"guide-note"},Jn=$e({__name:"AccessibilityGuideModal",props:{onConfirm:{type:Function,default:null}},setup(a){const e=a;function i(){Te()}function s(){var n;Te(),(n=e.onConfirm)==null||n.call(e)}return(n,d)=>{const v=Un,T=Se,M=St;return r(),_(M,{onClose:i},{headline:f(()=>[I(h(n.$t("remote_control")),1)]),content:f(()=>[c("div",Wn,[c("div",jn,[y(v)]),c("p",Nn,h(n.$t("accessibility_service_required")),1),c("ol",Kn,[c("li",null,h(n.$t("accessibility_step_1")),1),c("li",null,h(n.$t("accessibility_step_2")),1),c("li",null,h(n.$t("accessibility_step_3")),1)]),c("p",Zn,h(n.$t("accessibility_note")),1)])]),actions:f(()=>[y(T,{onClick:s},{default:f(()=>[I(h(n.$t("ok")),1)]),_:1})]),_:1})}}}),eo=Le(Jn,[["__scopeId","data-v-12a0e553"]]);function to(a){const{t:e}=Ee(),i=k(!1),s=k("00:00");let n=null,d=[],v=null,T=0;const M=()=>{const S=Math.floor((Date.now()-T)/1e3),L=String(Math.floor(S/60)).padStart(2,"0"),o=String(S%60).padStart(2,"0");s.value=`${L}:${o}`},R=()=>{const S=a.value;if(!S||!S.srcObject){V(e("recording_no_stream"),"error");return}const L=S.srcObject,o=["video/mp4;codecs=avc1.42E01E,mp4a.40.2","video/mp4;codecs=avc1.42E01E","video/mp4","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"];let p="";for(const u of o)if(MediaRecorder.isTypeSupported(u)){p=u;break}if(!p){V(e("recording_not_supported"),"error");return}d=[];try{n=new MediaRecorder(L,{mimeType:p,videoBitsPerSecond:5e6})}catch{V(e("recording_not_supported"),"error");return}n.ondataavailable=u=>{u.data.size>0&&d.push(u.data)},n.onstop=()=>{if(d.length===0)return;const u=new Blob(d,{type:p}),b=URL.createObjectURL(u),O=p.startsWith("video/mp4")?"mp4":"webm",A=new Date,$="screen-recording-"+[A.getFullYear(),A.getMonth()+1,A.getDate(),A.getHours(),A.getMinutes(),A.getSeconds()].join("")+"."+O;Ie(b,$),setTimeout(()=>URL.revokeObjectURL(b),1e4),d=[]},n.onerror=()=>{i.value=!1,w(),V(e("recording_failed"),"error")},n.start(1e3),i.value=!0,T=Date.now(),s.value="00:00",v=setInterval(M,1e3)},g=()=>{n&&n.state!=="inactive"&&n.stop(),n=null,i.value=!1,w()},w=()=>{v&&(clearInterval(v),v=null)};return{recording:i,recordingTime:s,toggleRecording:()=>{i.value?g():R()},stopRecording:g}}const no={class:"screen-mirror"},oo={class:"title"},so={key:0,class:"warning-indicator"},io={class:"btn-icon warning-icon"},ro={class:"warning-dropdown"},ao={class:"warning-content"},co={class:"warning-text"},lo={key:1,class:"warning-indicator"},uo={class:"btn-icon warning-icon"},po={class:"warning-dropdown"},_o={class:"warning-content"},mo={class:"warning-text"},vo={class:"warning-actions"},fo={key:1,class:"media-controls"},ho={class:"actions"},go={key:1,class:"check-placeholder"},yo={key:1,class:"check-placeholder"},To={key:1,class:"check-placeholder"},wo={key:0},qo={key:0,class:"request-permission"},bo={class:"tap-phone"},Co={class:"text"},ko={key:1,class:"request-permission-failed"},Mo={class:"video-wrapper"},$o=$e({__name:"ScreenMirrorView",setup(a){let e;const{t:i}=Ee(),{app:s}=Lt(Et()),n=k(!1),d=k(0),v=k(!1),T=k(!1),M=k(),R=k(!1),g=k("AUTO"),w=k(!1),q=k(!1),S=k(),L=k(!1),o=k(!1),p=k(!1),u=k(!0),b=k(!1),O={AUTO:"mirror_auto",HD:"mirror_hd",SMOOTH:"mirror_smooth"},A=we(()=>i(O[g.value]||"mirror_auto"));let $=null,z=null;const{attachOverlay:De,setupListeners:Pe,removeListeners:He,sendControl:Oe}=Xn(M,q),{recording:U,recordingTime:Ae,toggleRecording:le}=to(M),xe=[{keys:["Click"],description:"mirror_tap"},{keys:["Click","+","Drag"],description:"mirror_swipe"},{keys:["Scroll"],description:"mirror_scroll"},{keys:["Long press"],description:"mirror_long_press"},{keys:["Esc"],description:"nav_back"},{keys:["Backspace"],description:"nav_back"},{keys:["Home"],description:"nav_home"}],ne=t=>{Oe({action:t})},Be=()=>{const t=M.value;t&&(t.paused?(t.play().catch(()=>{}),p.value=!1):(t.pause(),p.value=!0))},Qe=()=>{const t=M.value;t&&(t.muted=!t.muted,u.value=t.muted)},Ve=()=>{const t=document.querySelector(".video-wrapper");t&&(document.fullscreenElement?document.exitFullscreen():t.requestFullscreen())},de=()=>{b.value=!!document.fullscreenElement},ze=()=>{if(q.value){q.value=!1;return}if(!L.value){Gt(eo,{onConfirm:()=>{st()}});return}q.value=!0};qe(S,t=>{He(),De(t),t&&Pe()});const ue=async()=>{n.value=!0,v.value=!1,d.value=0,clearInterval(e),me()},N=we(()=>ot.value||et.value||oe.value||he.value||T.value);qe(M,t=>{t&&z&&(t.srcObject=z,t.play().catch(()=>{}),z=null)});const{mutate:Ye,loading:oe}=j({document:Ut}),Xe=()=>{w.value||(w.value=!0,te(i("confirm_mirror_audio_permission_on_phone")),Fe())},{mutate:Fe,onDone:Ge,onError:Ue}=j({document:Wt});Ue(t=>{w.value=!1,te(""),V(i(t.message),"error")}),Ge(t=>{var P;((P=t==null?void 0:t.data)==null?void 0:P.requestScreenMirrorAudio)&&(w.value=!1,te(""),B.emit("refetch_app"))});const pe=()=>{w.value=!1,te(""),B.emit("refetch_app"),fe()};let K=null;const{mutate:We,loading:je,onDone:Ne}=j({document:jt});Ne(()=>{K!=null&&(g.value=K,K=null),R.value=!1});const se=t=>{K=t,We({mode:t})},_e=t=>{t&&oe.value&&(clearInterval(e),ie())},Ke=()=>{const t=M.value;if(!t)return;const l=document.createElement("canvas");l.width=t.videoWidth,l.height=t.videoHeight;const P=l.getContext("2d");P&&P.drawImage(t,0,0,l.width,l.height);const x=new Date,Z="screenshot-"+[x.getFullYear(),x.getMonth()+1,x.getDate(),x.getHours(),x.getMinutes(),x.getSeconds(),x.getMilliseconds()].join("")+".png";Ie(l.toDataURL(),Z)},Ze=()=>{$&&$.cleanup(),$=new Qn({sendSignaling:t=>{Vn(t)},onStream:t=>{T.value=!1;const l=M.value;l?(l.srcObject=t,l.play().catch(()=>{}),n.value=!0,v.value=!1,d.value=0,clearInterval(e)):(z=t,n.value=!0,v.value=!1,d.value=0,clearInterval(e))},onConnectionStateChange:t=>{t==="connected"?T.value=!1:(t==="failed"||t==="disconnected")&&(T.value=!1,v.value=!0)},onError:t=>{T.value=!1,V(t,"error"),v.value=!0}})},me=()=>{T.value=!0,$==null||$.startSession(!0,!1)},ve=async t=>{$&&await $.handleSignalingMessage(t)};Rt(()=>{o.value=!0,B.on("screen_mirroring",ue),B.on("webrtc_signaling",ve),B.on("app_socket_connection_changed",_e),B.on("screen_mirror_audio_granted",pe),document.addEventListener("fullscreenchange",de),Ze()}),Dt(()=>{o.value=!1,B.off("screen_mirroring",ue),B.off("webrtc_signaling",ve),B.off("app_socket_connection_changed",_e),B.off("screen_mirror_audio_granted",pe),document.removeEventListener("fullscreenchange",de),$&&($.cleanup(),$=null)});const{mutate:Je,loading:et,onDone:tt,onError:nt}=j({document:Nt}),{loading:ot,refetch:fe}=It({handle:(t,l)=>{var P;l?V(i(l),"error"):((P=t==null?void 0:t.screenMirrorQuality)!=null&&P.mode&&(g.value=t.screenMirrorQuality.mode),L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,t.screenMirrorState?me():(n.value=!1,ie()))},options:{fetchPolicy:"no-cache"},document:Kt}),{fetch:st}=Pt({handle:t=>{t&&(L.value=(t==null?void 0:t.screenMirrorControlEnabled)===!0,L.value&&(q.value=!0))},document:Zt,variables:()=>({})}),ie=()=>{v.value=!1,Je({audio:!0})};nt(t=>{V(i(t.message)),v.value=!0}),tt(()=>{d.value=30,e=setInterval(()=>{d.value--,d.value<=0&&(v.value=!0,clearInterval(e))},1e3)});const{mutate:it,loading:he,onDone:rt,onError:at}=j({document:Jt});return at(t=>{V(i(t.message))}),rt(()=>{v.value=!0,n.value=!1,q.value=!1,U.value&&le(),$&&$.cleanup()}),(t,l)=>{const P=en,x=tn,Z=At,ge=Se,ct=nn,lt=on,Y=Bt,dt=On,ut=Dn,pt=En,_t=$n,mt=sn,vt=Cn,ft=wn,ht=rn,ye=gn,W=Vt,re=vn,gt=Qt,yt=pn,Tt=ln,wt=zt,qt=Yt,D=xt("tooltip");return r(),m("div",no,[o.value?(r(),_(be,{key:0,to:"#header-start-slot",defer:""},[c("div",oo,[I(h(t.$t("screen_mirror"))+" ",1),n.value?(r(),m(ee,{key:0},[C(Ht)(C(Ot).MIRROR_AUDIO,C(s).osVersion)?C(s).permissions.includes("RECORD_AUDIO")?Q("",!0):(r(),m("div",lo,[y(Z,null,{content:f(()=>[c("div",po,[c("div",_o,[y(x),c("div",mo,h(t.$t("mirror_audio_no_permission")),1)]),c("div",vo,[y(ge,{class:"btn-sm",loading:w.value,onClick:Xe},{default:f(()=>[I(h(t.$t("grant_permission")),1)]),_:1},8,["loading"])])])]),default:f(()=>[c("button",uo,[y(P)])]),_:1})])):(r(),m("div",so,[y(Z,null,{content:f(()=>[c("div",ro,[c("div",ao,[y(x),c("div",co,h(t.$t("mirror_audio_not_supported")),1)])])]),default:f(()=>[c("button",io,[y(P)])]),_:1})]))],64)):Q("",!0),n.value&&!N.value?(r(),m("div",fo,[E((r(),_(Y,{onClick:Be},{default:f(()=>[p.value?(r(),_(ct,{key:0})):(r(),_(lt,{key:1}))]),_:1})),[[D,p.value?t.$t("play"):t.$t("pause")]]),E((r(),_(Y,{onClick:Ve},{default:f(()=>[b.value?(r(),_(dt,{key:0})):(r(),_(ut,{key:1}))]),_:1})),[[D,b.value?t.$t("exit_fullscreen"):t.$t("fullscreen")]]),E((r(),_(Y,{onClick:Qe},{default:f(()=>[u.value?(r(),_(pt,{key:0})):(r(),_(_t,{key:1}))]),_:1})),[[D,u.value?t.$t("unmute"):t.$t("mute")]]),q.value?(r(),m(ee,{key:0},[E((r(),_(Y,{onClick:l[0]||(l[0]=J=>ne("BACK"))},{default:f(()=>[y(mt)]),_:1})),[[D,t.$t("nav_back")]]),E((r(),_(Y,{onClick:l[1]||(l[1]=J=>ne("HOME"))},{default:f(()=>[y(vt)]),_:1})),[[D,t.$t("nav_home")]]),E((r(),_(Y,{onClick:l[2]||(l[2]=J=>ne("RECENTS"))},{default:f(()=>[y(ft)]),_:1})),[[D,t.$t("nav_recents")]])],64)):Q("",!0)])):Q("",!0)])])):Q("",!0),o.value?(r(),_(be,{key:1,to:"#header-end-slot",defer:""},[c("div",ho,[n.value?(r(),m(ee,{key:0},[E((r(),_(Y,{onClick:C(fe)},{default:f(()=>[y(ht)]),_:1},8,["onClick"])),[[D,t.$t("refresh")]]),E((r(),_(Y,{disabled:C(he),class:"btn-stop",onClick:C(it)},{default:f(()=>[y(ye)]),_:1},8,["disabled","onClick"])),[[D,t.$t("stop_mirror")]]),y(gt,{modelValue:R.value,"onUpdate:modelValue":l[6]||(l[6]=J=>R.value=J),placement:"auto",align:"top-left-to-bottom-left"},{trigger:f(()=>[E((r(),_(W,{class:"btn-sm",loading:C(je)},{default:f(()=>[I(h(A.value),1)]),_:1},8,["loading"])),[[D,t.$t("mirror_quality")]])]),default:f(()=>[c("div",{class:G(["dropdown-item",{active:g.value==="AUTO"}]),onClick:l[3]||(l[3]=()=>se("AUTO"))},[g.value==="AUTO"?(r(),_(re,{key:0})):(r(),m("span",go)),I(" "+h(t.$t("mirror_auto")),1)],2),c("div",{class:G(["dropdown-item",{active:g.value==="HD"}]),onClick:l[4]||(l[4]=()=>se("HD"))},[g.value==="HD"?(r(),_(re,{key:0})):(r(),m("span",yo)),I(" "+h(t.$t("mirror_hd")),1)],2),c("div",{class:G(["dropdown-item",{active:g.value==="SMOOTH"}]),onClick:l[5]||(l[5]=()=>se("SMOOTH"))},[g.value==="SMOOTH"?(r(),_(re,{key:0})):(r(),m("span",To)),I(" "+h(t.$t("mirror_smooth")),1)],2)]),_:1},8,["modelValue"]),E((r(),_(W,{class:"btn-sm",onClick:Ke},{default:f(()=>[I(h(t.$t("screenshot")),1)]),_:1})),[[D,t.$t("screenshot")]]),E((r(),_(W,{class:G(["btn-sm",{active:C(U)}]),onClick:C(le)},{default:f(()=>[C(U)?(r(),_(ye,{key:1})):(r(),_(yt,{key:0})),I(" "+h(C(U)?C(Ae):t.$t("start_recording")),1)]),_:1},8,["class","onClick"])),[[D,C(U)?t.$t("stop_recording"):t.$t("start_recording")]]),E((r(),_(W,{class:G(["btn-sm",{active:q.value}]),onClick:ze},{default:f(()=>[y(Tt),I(" "+h(t.$t("remote_control")),1)]),_:1},8,["class"])),[[D,q.value?t.$t("disable_control"):t.$t("enable_control")]]),y(wt,{shortcuts:xe})],64)):C(oe)?Q("",!0):(r(),_(W,{key:1,class:"btn-sm",onClick:C(Ye)},{default:f(()=>[I(h(t.$t("relaunch_app")),1)]),_:1},8,["onClick"]))])])):Q("",!0),c("div",{class:G(["content",{"content-centered":!n.value||N.value||!q.value}])},[N.value?(r(),m("div",wo,[y(qt,{indeterminate:""})])):(r(),m(ee,{key:1},[d.value>0?(r(),m("div",qo,[c("div",bo,[y(C(Xt))]),c("pre",Co,h(t.$t("screen_mirror_request_permission",{seconds:d.value})),1)])):Q("",!0),v.value&&!n.value?(r(),m("div",ko,[y(C(Bn)),c("p",null,h(t.$t("screen_mirror_request_permission_failed")),1),y(ge,{onClick:ie},{default:f(()=>[I(h(t.$t("try_again")),1)]),_:1})])):Q("",!0)],64)),E(c("div",Mo,[c("video",{ref_key:"videoRef",ref:M,class:"video",autoplay:"",playsinline:"",muted:""},null,512),q.value?(r(),m("div",{key:0,ref_key:"controlOverlayRef",ref:S,class:"control-overlay",tabindex:"0"},null,512)):Q("",!0)],512),[[Ft,n.value&&!N.value]])],2)])}}}),Io=Le($o,[["__scopeId","data-v-dcdc2c50"]]);export{Io as default};
