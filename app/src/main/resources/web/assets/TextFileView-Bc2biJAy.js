import{m as B,c as r,o as t,a,d as Le,u as Me,f as je,s as Ee,aD as l,r as u,a4 as Ve,i as Be,w as te,ai as De,cW as Se,h,t as i,O as Re,k as g,q as Ie,P as Ue,U as Fe,J as w,V as We,R as ne,M as v,j as d,x,a0 as oe,an as Ne,cS as Pe,am as qe,ch as ze,cR as Ke,cX as Oe,cY as He,cZ as Je,c5 as Ae,c_ as Ge,cV as Qe,c$ as Xe,cP as Ye,L as Ze}from"./index-CeUr62re.js";import{_ as et}from"./check-circle-rounded-DztGXHfO.js";import{u as tt}from"./markdown-B_h6WmFV.js";import{_ as nt}from"./json-viewer.vuevuetypestyleindex0lang-DKYX5veQ.js";import{_ as ot}from"./MonacoEditor.vuevuetypescriptsetuptruelang-DwjUbNY-.js";const at={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function st(C,n){return t(),r("svg",at,n[0]||(n[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497zM15 5l4 4"},null,-1)]))}const rt=B({name:"lucide-pencil",render:st}),it={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function lt(C,n){return t(),r("svg",it,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"m16 16l-2 2l2 2"}),a("path",{d:"M3 12h15a3 3 0 1 1 0 6h-4M3 18h7M3 6h18"})],-1)]))}const ut=B({name:"lucide-wrap-text",render:lt}),ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function dt(C,n){return t(),r("svg",ct,n[0]||(n[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m16 18l6-6l-6-6M8 6l-6 6l6 6"},null,-1)]))}const _t=B({name:"lucide-code",render:dt}),vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mt(C,n){return t(),r("svg",vt,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M2.062 12.348a1 1 0 0 1 0-.696a10.75 10.75 0 0 1 19.876 0a1 1 0 0 1 0 .696a10.75 10.75 0 0 1-19.876 0"}),a("circle",{cx:"12",cy:"12",r:"3"})],-1)]))}const pt=B({name:"lucide-eye",render:mt}),ft={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ht(C,n){return t(),r("svg",ft,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M12 15V3m9 12v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),a("path",{d:"m7 10l5 5l5-5"})],-1)]))}const wt=B({name:"lucide-download",render:ht}),kt={class:"page"},yt={class:"topbar"},gt={class:"title-wrap"},xt={class:"title"},bt={class:"meta"},Tt={key:0},$t={key:1},Ct={class:"status-text"},Lt={class:"actions"},Mt={class:"main"},jt={key:0,class:"state"},Et={class:"state-text"},Vt={key:1,class:"state error"},Bt={class:"state-text"},Dt={key:2,class:"editor"},St={key:3,class:"viewer"},Rt={class:"viewer-card"},It=["innerHTML"],Ut=Le({__name:"TextFileView",setup(C){const{t:n}=Me(),F=Ve(),H=Oe(),J=je(),{app:ae,urlTokenKey:L}=Ee(J),W=l(()=>!!localStorage.getItem("auth_token")),D=u(!0),m=u(""),M=u(""),b=u(""),p=u(""),N=u(0),S=u(""),P=u(null),q=u(""),k=u(!1),R=u(!0),z=u(!1);let T=null;const{render:se}=tt(ae,L),j=l(()=>p.value.toLowerCase().endsWith(".json")),E=l(()=>{const e=p.value.toLowerCase();return e.endsWith(".md")||e.endsWith(".markdown")}),re=l(()=>j.value||E.value),ie=l(()=>{const e=(p.value||"").toLowerCase(),o=e.lastIndexOf(".");return o<=0?"":e.substring(o+1)}),le=l(()=>{const e=ie.value;return e==="json"?"json":e==="md"||e==="markdown"?"markdown":e==="yaml"||e==="yml"?"yaml":e==="js"||e==="mjs"||e==="cjs"?"javascript":e==="ts"||e==="mts"||e==="cts"?"typescript":e==="go"?"go":e==="css"?"css":e==="html"||e==="htm"?"html":e==="sh"||e==="bash"?"shell":e==="toml"?"toml":"plaintext"}),ue=l(()=>({fontSize:14,lineHeight:22,tabSize:2,wordWrap:"on",lineNumbers:"on",minimap:{enabled:!0},scrollBeyondLastLine:!1,automaticLayout:!0})),K=l(()=>String(F.query.id??"").trim()),V=u(""),f=l(()=>F.name==="text-edit"),I=l(()=>b.value!==M.value),A=l(()=>{const e=p.value||n("view");return f.value&&I.value?`${e} *`:e}),G=l(()=>!f.value||D.value||m.value?"":$.value?n("saving"):z.value?n("saved"):""),{mutate:ce,loading:$,onDone:de,onError:_e}=Be({document:Je});async function ve(){var e,o,s;if(!L.value&&W.value)try{const c=await Ae.a.query({query:Ge,fetchPolicy:"network-only"}),y=(o=(e=c==null?void 0:c.data)==null?void 0:e.app)==null?void 0:o.urlToken;y&&(L.value=Qe(y),J.app=(s=c==null?void 0:c.data)==null?void 0:s.app)}catch{}}function me(e){try{if(!e||!L.value)return"";const o=Xe.codec.base64.toBits(e);return Ye(L.value,o)}catch{return""}}const O=l(()=>W.value&&!!V.value),Q=async(e,o)=>{if(M.value=e,b.value=e,P.value=null,q.value="",o&&(k.value=!1),j.value)try{P.value=JSON.parse(e)}catch(s){console.error("Error parsing JSON:",s),m.value=n("invalid_json_format")}else if(E.value)try{q.value=await se(e)}catch(s){console.error("Error rendering markdown:",s)}},X=async()=>{try{D.value=!0,m.value="";const e=F.query.id;if(!e){m.value=n("invalid_file_id");return}const o=await fetch(`${Ke()}/fs?id=${encodeURIComponent(e)}`);if(!o.ok){m.value=o.status===404?n("file_not_found"):o.status===403?n("access_denied"):n("failed_to_load_file");return}const s=o.headers.get("content-disposition");if(s){const U=s.match(/filename="?([^"]+)"?/);if(U)try{p.value=decodeURIComponent(U[1]).replace(/[/\\:*?"<>|]+/g,"_")}catch{}}const c=o.headers.get("content-length");c&&(N.value=parseInt(c));const y=o.headers.get("last-modified");y&&(S.value=y);const _=await o.text();await Q(_,!0)}catch(e){console.error("Error loading text file:",e),m.value=n("network_error")}finally{D.value=!1}},pe=()=>X(),fe=()=>{O.value&&H.push({name:"text-edit",query:{id:K.value}})},he=()=>{H.push({name:"text-file",query:{id:K.value}})};te(()=>K.value,async e=>{V.value="",e&&(await ve(),V.value=me(e),X())},{immediate:!0});const we=()=>{if(!M.value||!p.value)return;const e=new Blob([M.value],{type:"text/plain;charset=utf-8"}),o=window.URL.createObjectURL(e),s=document.createElement("a");s.href=o,s.download=p.value,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o)},ke=()=>{k.value=!k.value},ye=()=>{R.value=!R.value};async function Y(){!O.value||!f.value||!V.value||$.value||!I.value||!await He(ce,de,_e,{path:V.value,content:b.value,overwrite:!0})||(await Q(b.value,!1),z.value=!0,T&&window.clearTimeout(T),T=window.setTimeout(()=>{z.value=!1,T=null},1500))}function Z(e){f.value&&(!e.ctrlKey&&!e.metaKey||e.altKey||e.key!=="s"&&e.key!=="S"||(e.preventDefault(),e.stopPropagation(),Y()))}return De(()=>{window.addEventListener("keydown",Z,{capture:!0})}),Se(()=>{window.removeEventListener("keydown",Z,{capture:!0}),T&&window.clearTimeout(T)}),te([p,I,f],()=>{document.title=A.value}),(e,o)=>{const s=qe,c=et,y=wt,_=Ne,U=pt,ee=_t,ge=ut,xe=rt,be=Pe,Te=ze,$e=Ue("tooltip");return t(),r("div",kt,[a("header",yt,[a("div",gt,[a("div",xt,i(A.value),1),a("div",bt,[N.value?(t(),r("span",Tt,i(g(Ie)(N.value)),1)):h("",!0),S.value?Re((t(),r("span",$t,[w(i(g(We)(S.value)),1)])),[[$e,g(Fe)(S.value)]]):h("",!0)])]),G.value?(t(),r("div",{key:0,class:ne(["status",{saving:g($)}])},[g($)?(t(),v(s,{key:0,indeterminate:"",size:16,width:2})):(t(),v(c,{key:1,class:"status-icon"})),a("span",Ct,i(G.value),1)],2)):h("",!0),a("div",Lt,[f.value?h("",!0):(t(),v(_,{key:0,class:"action-btn",onClick:we},{default:x(()=>[d(y),w(" "+i(e.$t("download")),1)]),_:1})),f.value?(t(),r(oe,{key:1},[d(_,{class:"action-btn",loading:g($),disabled:g($)||!I.value,onClick:Y},{default:x(()=>[w(i(e.$t("save")),1)]),_:1},8,["loading","disabled"]),d(_,{class:"action-btn",onClick:he},{default:x(()=>[w(i(e.$t("view")),1)]),_:1})],64)):(t(),r(oe,{key:2},[re.value?(t(),v(_,{key:0,class:"action-btn",onClick:ke},{default:x(()=>[k.value?(t(),v(U,{key:0})):(t(),v(ee,{key:1})),w(" "+i(k.value?e.$t("formatted_view"):e.$t("raw_text")),1)]),_:1})):h("",!0),k.value||!j.value&&!E.value?(t(),v(_,{key:1,class:"action-btn",onClick:ye},{default:x(()=>[d(ge),w(" "+i(R.value?e.$t("unwrap"):e.$t("wrap")),1)]),_:1})):h("",!0),O.value?(t(),v(_,{key:2,class:"action-btn",onClick:fe},{default:x(()=>[d(xe),w(" "+i(e.$t("edit")),1)]),_:1})):h("",!0)],64)),d(be,{"logged-in":W.value},null,8,["logged-in"])])]),a("main",Mt,[D.value?(t(),r("section",jt,[d(s,{indeterminate:""}),a("span",Et,i(e.$t("loading")),1)])):m.value?(t(),r("section",Vt,[d(Te,{class:"state-icon"}),a("span",Bt,i(m.value),1),d(_,{onClick:pe},{default:x(()=>[w(i(e.$t("retry")),1)]),_:1})])):f.value?(t(),r("section",Dt,[d(ot,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=Ce=>b.value=Ce),language:le.value,options:ue.value,height:"100%"},null,8,["modelValue","language","options"])])):(t(),r("section",St,[a("div",Rt,[k.value||!j.value&&!E.value?(t(),r("pre",{key:0,class:ne(["view-raw text-view",{"text-wrap":R.value}])},i(M.value),3)):j.value?(t(),v(nt,{key:1,value:P.value,"expand-depth":2},null,8,["value"])):E.value?(t(),r("div",{key:2,class:"md-container",innerHTML:q.value},null,8,It)):h("",!0)])]))])])}}}),zt=Ze(Ut,[["__scopeId","data-v-bb923a19"]]);export{zt as default};
