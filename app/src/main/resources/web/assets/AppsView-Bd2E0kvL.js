import{_ as We}from"./VPagination.vuevuetypescriptsetuptruelang-CdD3UgAj.js";import{_ as Ye}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-CG5JX0Ln.js";import{d as G,r as E,c as r,o,W as F,$ as S,j as m,a1 as Y,O as k,v as h,a0 as Je,H as le,U as ne,T as oe,t as a,a8 as Ze,L as ye,a as d,as as Xe,I as Q,a9 as xe,aD as et,A as g,at as tt,aE as we,k as t,q as me,aF as _e,aa as j,s as ve,f as st,aG as nt,aH as lt,e as ot,u as it,a6 as at,aI as dt,ae as ct,i as fe,N as ge,Y as pt,Z as ut,w as rt,h as K,K as mt,aJ as _t,aK as vt,a3 as ft,C as gt,aL as ht,aM as kt,G as W,am as yt,aN as wt,aO as $t,aP as It,aQ as bt,ad as he,Q as Ct}from"./index-9yvO6RpE.js";import{_ as $e}from"./VCheckbox-Dh3imU8v.js";import{t as M}from"./tapphone-DhkZEKMf.js";import{_ as St,a as At,b as Ut}from"./key-events-Ck9VlIhj.js";import{_ as Dt}from"./upload-rounded-FU_oOno0.js";import{_ as Pt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BFVQT8k7.js";import{_ as Lt}from"./FieldId.vuevuetypescriptsetuptruelang-RirpqDM0.js";function Bt(A,_){const l=A.findIndex(u=>u.id===_);l!==-1&&A.splice(l,1)}const Et=["onClick"],Ft=G({__name:"AppsActionButtons",props:{sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(A,{emit:_}){const l=_,u=E(!1);function y(){l("install")}function w(p){l("sort",p)}return(p,e)=>{const c=Dt,$=le,U=Ze,I=Je,b=Y("tooltip");return o(),r(F,null,[S((o(),k($,{onClick:y},{default:h(()=>[m(c)]),_:1})),[[b,p.$t("install_app")]]),m(I,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i)},{trigger:h(()=>[S((o(),k($,{loading:p.sorting},{default:h(()=>[m(U)]),_:1},8,["loading"])),[[b,p.$t("sort")]])]),default:h(()=>[(o(!0),r(F,null,ne(p.sortItems,i=>(o(),r("div",{key:i.value,class:oe(["dropdown-item",{selected:i.value===p.appSortBy}]),onClick:C=>{w(i.value),u.value=!1}},a(p.$t(i.label)),11,Et))),128))]),_:1},8,["modelValue"])],64)}}}),Nt=ye(Ft,[["__scopeId","data-v-0cf682e0"]]),Mt={key:0,class:"app-item selectable-card-skeleton"},Vt={class:"start"},qt={class:"number"},Tt=G({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(A){return(_,l)=>{const u=St;return _.isPhone?(o(),k(u,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),r("section",Mt,[d("div",Vt,[l[0]||(l[0]=d("div",{class:"skeleton-checkbox"},null,-1)),d("span",qt,a(_.index),1)]),l[1]||(l[1]=Xe('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Kt={class:"actions"},ke=G({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const l=_;function u(){l("uninstall")}function y(){l("download")}function w(){l("cancelUninstall")}return(p,e)=>{const c=xe,$=et,U=tt,I=le,b=we,i=Y("tooltip");return o(),r("div",Kt,[p.item.isUninstalling?(o(),r(F,{key:0},[S(m(c,{indeterminate:"",class:"sm"},null,512),[[i,p.$t("uninstalling")]]),e[0]||(e[0]=Q(" Â ")),m($,{class:"btn-sm",onClick:g(w,["stop"])},{default:h(()=>[Q(a(p.$t("cancel")),1)]),_:1})],64)):(o(),r(F,{key:1},[S((o(),k(I,{class:"sm",onClick:g(u,["stop"])},{default:h(()=>[m(U)]),_:1})),[[i,p.$t("uninstall")]]),S((o(),k(I,{class:"sm",onClick:g(y,["stop"])},{default:h(()=>[m(b)]),_:1})),[[i,p.$t("download")]])],64))])}}}),Qt={class:"start"},Gt={class:"number"},Ot=["src"],zt={class:"title"},Rt={class:"subtitle"},Ht={class:"actions"},jt={class:"time"},Wt=["src"],Yt={class:"subtitle"},Jt={class:"subtitle"},Zt={class:"subtitle"},Xt={class:"subtitle"},xt=G({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const l=A,u=_;function y(){u("uninstall",l.item)}function w(){u("download",l.item)}function p(){u("cancelUninstall",l.item)}return(e,c)=>{const $=$e,U=Lt,I=Pt,b=Y("tooltip");return e.isPhone?(o(),k(I,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:c[4]||(c[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:c[5]||(c[5]=g(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:c[6]||(c[6]=i=>e.toggleSelect(i,e.item,e.index))},{image:h(()=>[d("img",{class:"image",src:e.item.icon},null,8,Wt)]),title:h(()=>[Q(a(e.item.name)+" ("+a(e.item.version)+")",1)]),subtitle:h(()=>[d("div",Yt,a(e.item.id),1),d("div",Jt,[d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Zt,a(e.$t("installed_at"))+": "+a(t(j)(e.item.installedAt)),1),d("div",Xt,a(e.$t("updated_at"))+": "+a(t(j)(e.item.updatedAt)),1)]),actions:h(()=>[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:oe(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:c[2]||(c[2]=g(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:c[3]||(c[3]=g(i=>e.handleMouseOver(i,e.index),["stop"]))},[d("div",Qt,[e.shiftEffectingIds.includes(e.item.id)?(o(),k($,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:c[0]||(c[0]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),k($,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:c[1]||(c[1]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),d("span",Gt,[m(U,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),d("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Ot),d("div",zt,a(e.item.name)+" ("+a(e.item.version)+")",1),d("div",Rt,[d("span",null,a(e.item.id),1),d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Ht,[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),d("div",jt,[S((o(),r("span",null,[Q(a(e.$t("installed_at"))+": "+a(t(j)(e.item.installedAt)),1)])),[[b,t(_e)(e.item.installedAt)]]),S((o(),r("span",null,[Q(a(e.$t("updated_at"))+": "+a(t(j)(e.item.updatedAt)),1)])),[[b,t(_e)(e.item.updatedAt)]])])],34))}}}),es={class:"top-app-bar"},ts={class:"title"},ss={key:0},ns={key:1},ls={key:0,class:"actions"},os={key:0,class:"no-data-placeholder"},V=50,is=G({__name:"AppsView",setup(A){var re;const _=mt("isPhone"),l=E([]),{app:u,urlTokenKey:y,uploads:w}=ve(st()),{input:p,upload:e,uploadChanged:c}=nt(w),{dropping:$,fileDragEnter:U,fileDragLeave:I,dropFiles:b}=lt(w),i=ot(),C=E([]),{t:N}=it(),{appSortBy:O}=ve(i),Ie=_t(),J=E(!1),q=at(),z=E(parseInt(((re=q.query.page)==null?void 0:re.toString())??"1")),Z=E(""),X=E(!1);let P;const{selectedIds:R,allChecked:ie,realAllChecked:x,selectRealAll:be,allCheckedAlertVisible:Ce,clearSelection:ee,toggleAllChecked:Se,toggleSelect:Ae,total:L,checked:H,shiftEffectingIds:Ue,handleItemClick:De,handleMouseOver:Pe,selectAll:Le,shouldSelect:Be}=At(C),{downloadItems:Ee}=dt(y,ct.PACKAGE,ee,()=>bt("apps")),{downloadFile:Fe}=It(y),te=s=>{const n=q.query.q;gt(i,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:ae,keyUp:de}=Ut(L,V,z,Le,ee,te,()=>{}),Ne=()=>{e(u.value.downloadsDir)},{mutate:Me}=fe({document:ht}),Ve=s=>{s.isUninstalling=!1},{loading:se,fetch:ce}=ge({handle:(s,n)=>{J.value=!1,n?W(N(n),"error"):s&&(C.value=s.packages.map(v=>({...v,isUninstalling:!1,icon:yt(y.value,"pkgicon://"+v.id)})),L.value=s.packageCount)},document:kt,variables:()=>({offset:(z.value-1)*V,limit:V,query:Z.value,sortBy:O.value})});function qe(s){O.value!==s&&(J.value=!0,O.value=s,te(1))}function pe(){var s,n;X.value&&(z.value=parseInt(((s=q.query.page)==null?void 0:s.toString())??"1"),Z.value=Ct(((n=q.query.q)==null?void 0:n.toString())??""),ce())}const{mutate:Te}=fe({document:wt});function Ke(s){s.isUninstalling=!0,M(N("confirm_uninstallation_on_phone")),Te({id:s.id})}function Qe(s){Fe(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:Ge,fetch:Oe}=ge({handle:s=>{if(s)for(const n of s.packageStatuses){const v=l.value.find(D=>D.id===n.id);if(v){const D=v.isNew&&n.exist,T=!v.isNew&&n.exist&&v.updatedAt<n.updatedAt;(D||T)&&(l.value=l.value.filter(B=>B.id!==n.id),M(""),D?W(N("app_installation_completed")):W(N("app_upgrade_completed")),ce())}else n.exist||(Bt(C.value,n.id),M(""))}},document:$t,variables:()=>({ids:[...C.value.filter(s=>s.isUninstalling).map(s=>s.id),...l.value.map(s=>s.id)]})}),ue=s=>{s.status==="done"&&Me({path:s.dir+"/"+s.fileName}).then(n=>{if(M(N("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:v,updatedAt:D,isNew:T}=n.data.installPackage;v&&(l.value.push({id:v,updatedAt:D,isNew:T}),setTimeout(()=>{l.value.some(B=>B.id===v)&&(l.value=l.value.filter(B=>B.id!==v),M(""))},12e4))}}).catch(n=>{M(""),W(N("app_installation_failed")+": "+n.message,"error")})};function ze(s){b(s,u.value.downloadsDir,n=>n.name.endsWith(".apk"))}return pt(()=>{X.value=!0,P&&(clearInterval(P),P=void 0),P=window.setInterval(()=>{(C.value.some(s=>s.isUninstalling)||l.value.length>0)&&!Ge.value&&Oe()},1e3),pe(),he.on("upload_task_done",ue),window.addEventListener("keydown",ae),window.addEventListener("keyup",de)}),ut(()=>{X.value=!1,P&&(clearInterval(P),P=void 0),he.off("upload_task_done",ue),window.removeEventListener("keydown",ae),window.removeEventListener("keyup",de)}),rt(()=>q.fullPath,()=>{pe()}),(s,n)=>{const v=$e,D=we,T=le,B=Ye,Re=We,He=Y("tooltip");return o(),r(F,null,[d("div",es,[m(v,{"touch-target":"wrapper",checked:t(ie),indeterminate:!t(ie)&&t(H),onChange:t(Se)},null,8,["checked","indeterminate","onChange"]),d("div",ts,[t(R).length?(o(),r("span",ss,a(s.$t("x_selected",{count:t(x)?t(L).toLocaleString():t(R).length.toLocaleString()})),1)):(o(),r("span",ns,a(s.$t("page_title.apps"))+" ("+a(t(L).toLocaleString())+")",1)),t(H)?S((o(),k(T,{key:2,onClick:n[0]||(n[0]=g(f=>t(Ee)(t(x),t(R),Z.value),["stop"]))},{default:h(()=>[m(D)]),_:1})),[[He,s.$t("download")]]):K("",!0)]),!t(_)||!t(H)?(o(),r("div",ls,[m(Nt,{sorting:J.value,"sort-items":t(Ie),"app-sort-by":t(O),onInstall:Ne,onSort:qe},null,8,["sorting","sort-items","app-sort-by"])])):K("",!0)]),m(B,{limit:V,total:t(L),"all-checked-alert-visible":t(Ce),"real-all-checked":t(x),"select-real-all":t(be),"clear-selection":t(ee)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),d("div",{class:"scroll-content",onDragover:n[3]||(n[3]=g((...f)=>t(U)&&t(U)(...f),["stop","prevent"]))},[S(d("div",{class:"drag-mask",onDrop:g(ze,["stop","prevent"]),onDragleave:n[1]||(n[1]=g((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},a(s.$t("release_to_send_files")),545),[[vt,t($)]]),d("div",{class:oe(["main-list",{"select-mode":t(H)}])},[(o(!0),r(F,null,ne(C.value,(f,je)=>(o(),k(xt,{key:f.id,item:f,index:je,"selected-ids":t(R),"shift-effecting-ids":t(Ue),"should-select":t(Be),"is-phone":t(_),"handle-item-click":t(De),"handle-mouse-over":t(Pe),"toggle-select":t(Ae),onUninstall:Ke,onDownload:Qe,onCancelUninstall:Ve},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(se)&&C.value.length===0?(o(),r(F,{key:0},ne(20,f=>m(Tt,{key:f,index:f,"is-phone":t(_)},null,8,["index","is-phone"])),64)):K("",!0)],2),!t(se)&&C.value.length===0?(o(),r("div",os,a(s.$t(t(ft)(t(se),t(u).permissions,"QUERY_ALL_PACKAGES"))),1)):K("",!0),t(L)>V?(o(),k(Re,{key:1,page:z.value,go:te,total:t(L),limit:V},null,8,["page","total"])):K("",!0),d("input",{ref_key:"fileInput",ref:p,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(c)&&t(c)(...f))},null,544)],32)],64)}}}),fs=ye(is,[["__scopeId","data-v-f01c2449"]]);export{fs as default};
