import{_ as Ve}from"./VPagination.vuevuetypescriptsetuptruelang-CcKj-FBb.js";import{_ as He,u as Ne,a as Re}from"./key-events-DNEDF963.js";import{d as q,c as r,M as p,o,a as l,N as Qe,t as u,O as b,P as K,H as de,A as f,v as I,j as c,Q as ce,R as me,k as s,S as te,T as Ue,U as ne,I as U,V as oe,L as re,e as Fe,s as Ke,f as Oe,r as A,u as ze,W as Ge,X as je,Y as Je,i as We,w as Xe,Z as Ye,$ as Ze,h as D,a0 as F,a1 as ae,a2 as xe,a3 as es,G as ss,J as ts,K as ns,a4 as os,C as as,a5 as le,a6 as ls,a7 as L,a8 as is,a9 as ds}from"./index-CiJYwD0I.js";import{_ as cs}from"./ListItemPhone.vuevuetypescriptsetuptruelang-Ces94TEX.js";import{_ as ms}from"./FieldId.vuevuetypescriptsetuptruelang-C8u7Jssa.js";import{_ as ue}from"./VCheckbox-DY9-xm2z.js";import{_ as rs}from"./call-outline-rounded-BYyqpMhX.js";import{_ as pe,S as us}from"./SendSmsModal-x4L545dc.js";import{_ as ps}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-CS7wyyr7.js";import{u as gs,a as _s}from"./tags-C4J8aSeC.js";const hs={key:0,class:"sms-item selectable-card-skeleton"},fs={class:"start"},vs={class:"number"},ks=q({__name:"MessageSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(E){return(v,d)=>{const g=He;return v.isPhone?(o(),p(g,{key:1,"title-width":"70%",image:!1,subtitles:[{width:"45%"},{width:"30%"},{width:"40%"}],"action-count":2})):(o(),r("section",hs,[l("div",fs,[d[0]||(d[0]=l("div",{class:"skeleton-checkbox"},null,-1)),l("span",vs,u(v.index),1)]),d[1]||(d[1]=Qe('<div class="title"><div class="skeleton-text lg" style="width:120px;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:80%;"></div><div class="skeleton-text" style="width:80%;margin-block-start:8px;"></div></div><div class="actions"><div class="skeleton-text" style="width:140px;"></div></div><div class="info"><div class="skeleton-text" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:60px;"></div></div>',5))]))}}}),ys={class:"actions"},ie=q({__name:"MessageActionButtons",props:{item:{},callLoading:{type:Boolean},callId:{}},emits:["addItemToTags","sendSms","call"],setup(E,{emit:v}){const d=E,g=v;function _(){g("addItemToTags",d.item)}function w(){g("call",d.item)}function e(){g("sendSms",d.item)}return(n,h)=>{const k=ce,m=de,y=pe,S=rs,a=K("tooltip");return o(),r("div",ys,[b((o(),p(m,{onClick:f(_,["stop"])},{default:I(()=>[c(k)]),_:1})),[[a,n.$t("add_to_tags")]]),b((o(),p(m,{onClick:f(e,["stop"])},{default:I(()=>[c(y)]),_:1})),[[a,n.$t("send_sms")]]),b((o(),p(m,{loading:n.callLoading&&n.callId===n.item.id,onClick:f(w,["stop"])},{default:I(()=>[c(S)]),_:1},8,["loading"])),[[a,n.$t("make_a_phone_call")]])])}}}),Ss={class:"start"},Is={class:"number"},Ts={class:"title"},$s=["innerHTML"],bs={class:"info"},ws={class:"time"},Cs=["innerHTML"],Ls={class:"info"},Ms={class:"time"},As=q({__name:"MessageListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},dataType:{},callLoading:{type:Boolean},callId:{},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["addItemToTags","sendSms","call"],setup(E,{emit:v}){const d=v;function g(e){d("addItemToTags",e)}function _(e){d("call",e)}function w(e){d("sendSms",e)}return(e,n)=>{const h=ue,k=ms,m=Ue,y=cs,S=K("tooltip");return e.isPhone?(o(),p(y,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:n[4]||(n[4]=a=>e.handleItemClick(a,e.item,e.index,()=>{})),onMouseenter:n[5]||(n[5]=f(a=>e.handleMouseOver(a,e.index),["stop"])),onCheckboxClick:n[6]||(n[6]=a=>e.toggleSelect(a,e.item,e.index))},{title:I(()=>[U(u(e.item.address),1)]),subtitle:I(()=>[l("div",{class:"subtitle",innerHTML:s(te)(e.item.body)},null,8,Cs),l("div",Ls,[l("span",null,u(e.$t(`message_type.${e.item.type}`)),1),c(m,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),l("div",Ms,[b((o(),r("span",null,[U(u(s(oe)(e.item.date)),1)])),[[S,s(ne)(e.item.date)]])])]),actions:I(()=>[c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:g,onSendSms:w,onCall:_},null,8,["item","call-loading","call-id"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:me(["sms-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:n[2]||(n[2]=f(a=>e.handleItemClick(a,e.item,e.index,()=>{}),["stop"])),onMouseenter:n[3]||(n[3]=f(a=>e.handleMouseOver(a,e.index),["stop"]))},[l("div",Ss,[e.shiftEffectingIds.includes(e.item.id)?(o(),p(h,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:n[0]||(n[0]=f(a=>e.toggleSelect(a,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),p(h,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:n[1]||(n[1]=f(a=>e.toggleSelect(a,e.item,e.index),["stop"]))},null,8,["checked"])),l("span",Is,[c(k,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),l("div",Ts,u(e.item.address),1),l("div",{class:"subtitle",innerHTML:s(te)(e.item.body)},null,8,$s),c(ie,{item:e.item,"call-loading":e.callLoading,"call-id":e.callId,onAddItemToTags:g,onSendSms:w,onCall:_},null,8,["item","call-loading","call-id"]),l("div",bs,[l("span",null,u(e.$t(`message_type.${e.item.type}`)),1),c(m,{tags:e.item.tags,type:e.dataType,"only-links":!0},null,8,["tags","type"])]),l("div",ws,[b((o(),r("span",null,[U(u(s(oe)(e.item.date)),1)])),[[S,s(ne)(e.item.date)]])])],34))}}}),Es=re(As,[["__scopeId","data-v-fab4179d"]]),Ps={class:"top-app-bar"},Bs={class:"title"},Ds={key:0},qs={key:1},Vs={class:"actions"},Hs={class:"scroll-content"},Ns={key:0,class:"no-data-placeholder"},M=50,Rs=q({__name:"MessagesView",setup(E){const v=ns("isPhone"),d=Fe(),{app:g}=Ke(Oe()),_=A([]),{t:w}=ze(),{parseQ:e}=ds(),n=Ge({tagIds:[]}),h=je.SMS,k=os(),m=A(1),y=A(""),{tags:S,fetch:a}=gs(h),{addToTags:ge}=_s(h,S),{selectedIds:P,allChecked:O,realAllChecked:V,selectRealAll:_e,allCheckedAlertVisible:he,clearSelection:H,toggleAllChecked:fe,toggleSelect:ve,total:T,checked:N,shiftEffectingIds:ke,handleItemClick:ye,handleMouseOver:Se,selectAll:Ie,shouldSelect:Te}=Ne(_),z=t=>{const i=k.query.q;as(d,i?`/messages?page=${t}&q=${i}`:`/messages?page=${t}`)},{keyDown:G,keyUp:j}=Re(T,M,m,Ie,H,z,()=>{}),{loading:R,fetch:B}=Je({handle:(t,i)=>{i?ss(w(i),"error"):t&&(_.value=t.messages,T.value=t.messageCount)},document:es,variables:()=>({offset:(m.value-1)*M,limit:M,query:y.value})});function $e(t){le(ls,{type:h,tags:S.value,item:{key:t.id,title:"",size:0},selected:S.value.filter(i=>t.tags.some(C=>C.id===i.id))})}const J=A(""),{mutate:be,loading:we}=We({document:ts});function Ce(t){J.value=t.id,be({number:t.address})}function W(t="",i=""){le(us,{number:t,body:i})}function Le(t){W(t.address)}const X=()=>{B()},Y=t=>{t.type===h&&(H(),B())},Z=t=>{t.type===h&&B()},Q=A(!1);function x(){var i,C;const t=parseInt(((i=k.query.page)==null?void 0:i.toString())??"1");m.value=Number.isFinite(t)&&t>0?t:1,y.value=is(((C=k.query.q)==null?void 0:C.toString())??""),e(n,y.value),B()}return Xe(()=>k.fullPath,()=>{Q.value&&x()}),Ye(()=>{a(),Q.value=!0,x(),L.on("item_tags_updated",Z),L.on("items_tags_updated",Y),L.on("sms_sent",X),window.addEventListener("keydown",G),window.addEventListener("keyup",j)}),Ze(()=>{Q.value=!1,L.off("item_tags_updated",Z),L.off("items_tags_updated",Y),L.off("sms_sent",X),window.removeEventListener("keydown",G),window.removeEventListener("keyup",j)}),(t,i)=>{const C=ue,Me=ce,ee=de,Ae=pe,Ee=ps,Pe=Es,Be=ks,De=Ve,se=K("tooltip");return o(),r(F,null,[l("div",Ps,[c(C,{"touch-target":"wrapper",checked:s(O),indeterminate:!s(O)&&s(N),onChange:s(fe)},null,8,["checked","indeterminate","onChange"]),l("div",Bs,[s(P).length?(o(),r("span",Ds,u(t.$t("x_selected",{count:s(V)?s(T).toLocaleString():s(P).length.toLocaleString()})),1)):(o(),r("span",qs,u(t.$t("page_title.messages"))+" ("+u(s(T).toLocaleString())+")",1)),s(N)?b((o(),p(ee,{key:2,onClick:i[0]||(i[0]=f($=>s(ge)(s(P),s(V),y.value),["stop"]))},{default:I(()=>[c(Me)]),_:1})),[[se,t.$t("add_to_tags")]]):D("",!0)]),l("div",Vs,[b((o(),p(ee,{onClick:i[1]||(i[1]=f($=>W(),["stop"]))},{default:I(()=>[c(Ae)]),_:1})),[[se,t.$t("send_sms")]])])]),c(Ee,{limit:M,total:s(T),"all-checked-alert-visible":s(he),"real-all-checked":s(V),"select-real-all":s(_e),"clear-selection":s(H)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),l("div",Hs,[l("div",{class:me(["main-list",{"select-mode":s(N)}])},[(o(!0),r(F,null,ae(_.value,($,qe)=>(o(),p(Pe,{key:$.id,item:$,index:qe,"selected-ids":s(P),"shift-effecting-ids":s(ke),"should-select":s(Te),"is-phone":s(v),"data-type":s(h),"call-loading":s(we),"call-id":J.value,"handle-item-click":s(ye),"handle-mouse-over":s(Se),"toggle-select":s(ve),onAddItemToTags:$e,onSendSms:Le,onCall:Ce},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","data-type","call-loading","call-id","handle-item-click","handle-mouse-over","toggle-select"]))),128)),s(R)&&_.value.length===0?(o(),r(F,{key:0},ae(20,$=>c(Be,{key:$,index:$,"is-phone":s(v)},null,8,["index","is-phone"])),64)):D("",!0)],2),!s(R)&&_.value.length===0?(o(),r("div",Ns,u(t.$t(s(xe)(s(R),s(g).permissions,"READ_SMS"))),1)):D("",!0),s(T)>M?(o(),p(De,{key:1,page:m.value,go:z,total:s(T),limit:M},null,8,["page","total"])):D("",!0)])],64)}}}),Xs=re(Rs,[["__scopeId","data-v-31c64db1"]]);export{Xs as default};
