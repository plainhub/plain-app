import{m as W,c as v,o as i,a as u,d as K,u as oe,W as M,a0 as j,j as w,a8 as ie,V as H,U as Q,O as y,Z as D,h as R,bq as se,k as V,H as Z,A as S,v as _,ah as re,t as k,a4 as X,T as O,aH as Y,q as x,L as ne,r as G,g as le,br as ae,G as ee,N as ue,bs as ce,w as de,aC as pe,I as J,B as me,aT as _e,b1 as ve,bt as fe,aS as ge,bu as he,be as ye,bv as ke,$ as be,a7 as Te}from"./index-BBktiafP.js";import{_ as $e}from"./check-rounded-BvTbiPS6.js";import{_ as we}from"./VolumeCard.vuevuetypescriptsetuptruelang-DuB3LcD7.js";import{_ as Ve}from"./upload-rounded-D8-KC-_r.js";const Me={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ce(s,r){return i(),v("svg",Me,r[0]||(r[0]=[u("path",{fill:"currentColor",d:"M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.587 1.413T20 20z"},null,-1)]))}const qe=W({name:"material-symbols-folder-rounded",render:Ce}),Se={class:"browser-sidebar"},Be={key:0,class:"volumes-loading"},Pe={key:1,class:"browser-volumes"},Ue={class:"browser-main"},De={class:"toolbar"},ze={class:"path"},Ie={class:"loading-overlay","aria-live":"polite","aria-busy":"true"},Ne={class:"loading-row"},Re=["onClick"],Ae={class:"dir-icon"},Fe={class:"dir-name"},He=K({__name:"DirectoryBrowser",props:{volumes:{},loadingMounts:{type:Boolean},activeRoot:{},currentDir:{},canGoUp:{type:Boolean},listing:{type:Boolean},dirItems:{},dirName:{type:Function},browserMinHeightPx:{},listMinHeightPx:{}},emits:["selectRoot","goUp","enterDir"],setup(s,{emit:r}){const{t:l}=oe(),c=s,a=r;function d(e){return e.driveType==="INTERNAL_STORAGE"?0:e.driveType==="SDCARD"?1:e.driveType==="USB_STORAGE"?2:e.driveType==="APP"?3:9}const f=M(()=>[...c.volumes].sort((e,t)=>{const h=d(e),$=d(t);return h!==$?h-$:(e.mountPoint||"").localeCompare(t.mountPoint||"")})),p=M(()=>{const e=c.volumes.filter(t=>t.driveType==="USB_STORAGE").map(t=>t.mountPoint).filter(Boolean);return new Map(e.map((t,h)=>[t,h+1]))});function g(e){if(e.driveType==="INTERNAL_STORAGE")return l("internal_storage");if(e.driveType==="APP")return l("app_data");if(e.driveType==="SDCARD")return l("sdcard");if(e.driveType==="USB_STORAGE"){const t=p.value.get(e.mountPoint)??1;return`${l("usb_storage")} ${t}`}return e.name||e.mountPoint}function B(e){const t=Number(e.totalBytes||0),h=Number(e.usedBytes||0);if(!t)return 0;const $=h/t*100;return Number.isFinite($)?Math.max(0,Math.min(100,$)):0}function A(e){const t=Number(e.freeBytes||0),h=Number(e.totalBytes||0);return h?l("storage_free_total",{free:x(t),total:x(h)}):""}const q=M(()=>{const e=Number(c.browserMinHeightPx??260);return e?{minHeight:`${e}px`}:void 0}),F=M(()=>{const e=Number(c.listMinHeightPx??160);return e?{minHeight:`${e}px`}:void 0});return(e,t)=>{const h=ie,$=re,z=Z,I=qe,P=j("tooltip");return i(),v("div",{class:"browser",style:X(q.value)},[u("aside",Se,[e.loadingMounts?(i(),v("div",Be,[w(h,{indeterminate:"",class:"sm"})])):(i(),v("div",Pe,[(i(!0),v(H,null,Q(f.value,o=>(i(),y(we,{key:o.id,title:g(o),"used-percent":B(o),count:A(o),"show-progress":Number(o.totalBytes||0)>0,data:o,active:String(o.mountPoint||"")===e.activeRoot,onClick:E=>a("selectRoot",o.mountPoint||"/")},null,8,["title","used-percent","count","show-progress","data","active","onClick"]))),128))]))]),u("section",Ue,[u("div",De,[e.canGoUp?D((i(),y(z,{key:0,onClick:t[0]||(t[0]=S(o=>a("goUp"),["stop"]))},{default:_(()=>[w($)]),_:1})),[[P,V(l)("back")]]):R("",!0),u("div",ze,k(e.currentDir),1),se(e.$slots,"toolbar-actions",{},void 0,!0)]),u("div",{class:O(["list",{loading:e.listing}]),style:X(F.value)},[D(u("div",Ie,[u("div",Ne,[w(h,{indeterminate:"",class:"sm"}),u("span",null,k(V(l)("loading")),1)])],512),[[Y,e.listing]]),D(u("div",{class:"empty-row"},k(V(l)("no_data")),513),[[Y,!e.listing&&e.dirItems.length===0]]),(i(!0),v(H,null,Q(e.dirItems,o=>(i(),v("button",{key:o,class:"dir-row",onClick:E=>a("enterDir",o)},[u("span",Ae,[w(I)]),u("span",Fe,k(e.dirName(o)),1)],8,Re))),128))],6)])],4)}}}),Ee=ne(He,[["__scopeId","data-v-3ea1f89e"]]),Ge={class:"picker"},Oe={key:0,class:"picker-desc"},Ke={class:"hint"},Le={class:"picker-current__label"},Qe={class:"mono picker-current__value"},We=K({__name:"DirectoryPickerModal",props:{title:{type:String,default:""},description:{type:String,default:""},initialPath:{type:String,default:""}},setup(s,{emit:r}){const{t:l}=oe(),c=s,a=r,d=G([]),f=G(!0),p=G(""),g=G(""),B=G([]),A=M(()=>{const n=String(c.initialPath||"").trim();return n?n.replace(/\/+$/g,"")||"/":""}),q=M(()=>{const n=p.value||"/",m=(g.value||"").replace(/^\/+/,"");return m?n==="/"?`/${m}`.replace(/\/+/g,"/").replace(/\/+$/g,""):`${n}/${m}`.replace(/\/+/g,"/").replace(/\/+$/g,""):n}),F=M(()=>!!p.value&&(g.value||"").trim()!=="");function e(n){p.value=n||"/",g.value=""}function t(n){const m=p.value||"";return m?m==="/"?n.replace(/^\/+/,""):n.startsWith(m)?n.slice(m.length).replace(/^\/+/,""):"":""}function h(n){g.value=t(n)}function $(){const n=(g.value||"").replace(/\/+$/g,""),m=n.lastIndexOf("/");m<=0?g.value="":g.value=n.slice(0,m)}function z(n){return ve(n)||n}function I(){a(fe.EVENT_PROMPT,q.value)}function P(){ge()}le({document:ae,handle:(n,m)=>{var U;if(f.value=!1,m){ee(l(m),"error");return}d.value=[...(n==null?void 0:n.mounts)??[]].sort((N,T)=>{const b=String((N==null?void 0:N.mountPoint)??""),L=String((T==null?void 0:T.mountPoint)??"");return b==="/"?-1:L==="/"?1:b.localeCompare(L,void 0,{numeric:!0})}),p.value||(p.value=((U=d.value[0])==null?void 0:U.mountPoint)||"/",g.value="");const C=A.value;if(C){const N=d.value.map(b=>String(b.mountPoint||"").trim()).filter(b=>!!b);let T="";for(const b of N){if(b==="/"&&C.startsWith("/")){T.length<1&&(T="/");continue}b!=="/"&&(C===b||C.startsWith(b+"/"))&&b.length>T.length&&(T=b)}T&&(p.value=T,T==="/"?g.value=C.replace(/^\/+/,""):g.value=C.slice(T.length).replace(/^\/+/,""))}}});const{loading:o,fetch:E}=ue({document:ce,variables:()=>({root:q.value,offset:0,limit:1e4,query:"",sortBy:"NAME_ASC"}),handle:(n,m)=>{if(m){B.value=[],ee(l(m),"error");return}const C=(n==null?void 0:n.files)??[];B.value=C.filter(U=>U.isDir).map(U=>U.path)}});return de([p,g],()=>{p.value&&E()},{immediate:!0}),(n,m)=>{const C=$e,U=Z,N=pe,T=me,b=_e,L=j("tooltip");return i(),y(b,{onClose:P},{headline:_(()=>[J(k(s.title||n.$t("select_folder")),1)]),content:_(()=>[u("div",Ge,[s.description?(i(),v("p",Oe,k(s.description),1)):R("",!0),u("div",Ke,[u("span",Le,k(n.$t("current_path"))+":",1),u("span",Qe,k(q.value||"-"),1)]),w(Ee,{volumes:d.value,"loading-mounts":f.value,"active-root":p.value,"current-dir":q.value,"can-go-up":F.value,listing:V(o),"dir-items":B.value,"dir-name":z,"browser-min-height-px":320,"list-min-height-px":220,onSelectRoot:e,onGoUp:$,onEnterDir:h},{"toolbar-actions":_(()=>[D((i(),y(U,{onClick:S(I,["stop"])},{default:_(()=>[w(C)]),_:1})),[[L,n.$t("ok")]])]),_:1},8,["volumes","loading-mounts","active-root","current-dir","can-go-up","listing","dir-items"])])]),actions:_(()=>[w(N,{value:"cancel",onClick:P},{default:_(()=>[J(k(n.$t("cancel")),1)]),_:1}),w(T,{value:"ok",onClick:I},{default:_(()=>[J(k(n.$t("ok")),1)]),_:1})]),_:1})}}}),je=ne(We,[["__scopeId","data-v-deb4898a"]]);async function Ze(s){const r=String(s.storageKey||"").trim(),l=r?String(localStorage.getItem(r)||"").trim():"",c=await he(je,{title:s.title,description:s.description,initialPath:l||s.initialPath,modalId:s.modalId||"directory-picker"});if(typeof c!="string")return;const a=c.trim();if(a)return r&&localStorage.setItem(r,a),a}function mt(s){const r=()=>{var f;const c=s.filter.bucketId;if(!c)return"";const a=s.buckets.value.find(p=>p.id===c),d=(f=a==null?void 0:a.topItems)==null?void 0:f[0];return d?ye(d):""};return{getSelectedBucketDir:r,resolveTargetDir:async()=>{const c=r();return c||Ze({title:s.picker.title,description:s.picker.description,initialPath:s.picker.initialPath||"",modalId:s.picker.modalId,storageKey:s.picker.storageKey})}}}const Je={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Xe(s,r){return i(),v("svg",Je,r[0]||(r[0]=[u("path",{fill:"currentColor",d:"M5 11q-.825 0-1.412-.587T3 9V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v4q0 .825-.587 1.413T19 11zm0-2h14V5H5zm0 12q-.825 0-1.412-.587T3 19v-4q0-.825.588-1.412T5 13h14q.825 0 1.413.588T21 15v4q0 .825-.587 1.413T19 21zm0-2h14v-4H5zM5 9V5zm0 10v-4z"},null,-1)]))}const Ye=W({name:"material-symbols-splitscreen-outline",render:Xe}),xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function et(s,r){return i(),v("svg",xe,r[0]||(r[0]=[u("path",{fill:"currentColor",d:"M5 11q-.825 0-1.412-.587T3 9V5q0-.825.588-1.412T5 3h4q.825 0 1.413.588T11 5v4q0 .825-.587 1.413T9 11zm0 10q-.825 0-1.412-.587T3 19v-4q0-.825.588-1.412T5 13h4q.825 0 1.413.588T11 15v4q0 .825-.587 1.413T9 21zm10-10q-.825 0-1.412-.587T13 9V5q0-.825.588-1.412T15 3h4q.825 0 1.413.588T21 5v4q0 .825-.587 1.413T19 11zm0 10q-.825 0-1.412-.587T13 19v-4q0-.825.588-1.412T15 13h4q.825 0 1.413.588T21 15v4q0 .825-.587 1.413T19 21zM5 9h4V5H5zm10 0h4V5h-4zm0 10h4v-4h-4zM5 19h4v-4H5zM9 9"},null,-1)]))}const tt=W({name:"material-symbols-grid-view-outline-rounded",render:et}),ot={class:"button-group"},te=K({__name:"ViewToggleButtons",props:{cardView:{type:Boolean}},emits:["update:cardView"],setup(s){const r=s,l=M(()=>r.cardView);return(c,a)=>{const d=tt,f=Ye;return i(),v("div",ot,[u("button",{class:O({selected:!l.value}),onClick:a[0]||(a[0]=p=>c.$emit("update:cardView",!1))},[w(d)],2),u("button",{class:O({selected:l.value}),onClick:a[1]||(a[1]=p=>c.$emit("update:cardView",!0))},[w(f)],2)])}}}),nt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function it(s,r){return i(),v("svg",nt,r[0]||(r[0]=[u("path",{fill:"currentColor",d:"M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.587 1.413T20 20zm0-2h7V6H4zm9 0h7V6h-7zm5.25-3q.325 0 .538-.213T19 14.25t-.213-.537t-.537-.213h-3.5q-.325 0-.537.213T14 14.25t.213.538t.537.212zm0-2.5q.325 0 .538-.213T19 11.75t-.213-.537T18.25 11h-3.5q-.325 0-.537.213T14 11.75t.213.538t.537.212zm0-2.5q.325 0 .538-.213T19 9.25t-.213-.537t-.537-.213h-3.5q-.325 0-.537.213T14 9.25t.213.538t.537.212zM4 18V6z"},null,-1)]))}const st=W({name:"material-symbols-chrome-reader-mode-outline-rounded",render:it}),rt=K({__name:"UIModeToggleButton",props:{mode:{},tooltip:{}},emits:["click"],setup(s,{emit:r}){const l=r;return(c,a)=>{const d=st,f=ke,p=Z,g=j("tooltip");return D((i(),y(p,{onClick:a[0]||(a[0]=S(B=>l("click"),["stop"]))},{default:_(()=>[c.mode==="edit"?(i(),y(d,{key:0})):(i(),y(f,{key:1}))]),_:1})),[[g,c.tooltip]])}}}),lt=["onClick"],at=["onClick"],_t=K({__name:"MediaPageActions",props:{placement:{},uiMode:{},filterTrash:{type:Boolean},isPhone:{type:Boolean},checked:{type:Boolean},uploadMenuVisible:{type:Boolean},moreMenuVisible:{type:Boolean},sortBy:{},sortItems:{},showViewToggle:{type:Boolean},cardView:{type:Boolean},onToggleUiMode:{type:Function},onUploadFiles:{type:Function},onUploadDir:{type:Function},onOpenKeyboardShortcuts:{type:Function},onSort:{type:Function},onUpdateCardView:{type:Function}},emits:["update:uploadMenuVisible","update:moreMenuVisible"],setup(s,{emit:r}){const l=s,c=r,a=M({get:()=>l.uploadMenuVisible,set:e=>c("update:uploadMenuVisible",e)}),d=M({get:()=>l.moreMenuVisible,set:e=>c("update:moreMenuVisible",e)}),f=()=>{},p=l.onToggleUiMode??f,g=l.onUploadFiles??f,B=l.onUploadDir??f,A=l.onOpenKeyboardShortcuts??f,q=l.onUpdateCardView??f,F=M(()=>l.cardView??!1);return(e,t)=>{const h=Ve,$=Z,z=be,I=Te,P=j("tooltip");return e.placement==="top"?(i(),v(H,{key:0},[e.uiMode==="edit"&&!e.filterTrash&&(!e.isPhone||!e.checked)?(i(),y(z,{key:0,modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value=o)},{trigger:_(()=>[D((i(),y($,null,{default:_(()=>[w(h)]),_:1})),[[P,e.$t("upload")]])]),default:_(()=>[u("div",{class:"dropdown-item",onClick:t[0]||(t[0]=S(o=>{V(g)(),a.value=!1},["stop"]))},k(e.$t("upload_files")),1),u("div",{class:"dropdown-item",onClick:t[1]||(t[1]=S(o=>{V(B)(),a.value=!1},["stop"]))},k(e.$t("upload_folder")),1)]),_:1},8,["modelValue"])):R("",!0),e.filterTrash?R("",!0):(i(),y(rt,{key:1,mode:e.uiMode,tooltip:e.uiMode==="edit"?e.$t("view"):e.$t("edit"),onClick:V(p)},null,8,["mode","tooltip","onClick"])),e.checked?R("",!0):(i(),y(z,{key:2,modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=o=>d.value=o)},{trigger:_(()=>[D((i(),y($,null,{default:_(()=>[w(I)]),_:1})),[[P,e.$t("sort")]])]),default:_(()=>[u("div",{class:"dropdown-item",onClick:t[3]||(t[3]=S(o=>{V(A)(),d.value=!1},["stop"]))},k(e.$t("keyboard_shortcuts")),1),(i(!0),v(H,null,Q(e.sortItems,o=>(i(),v("div",{key:o.value,class:O(["dropdown-item",{selected:o.value===e.sortBy}]),onClick:S(E=>{e.onSort(o.value),d.value=!1},["stop"])},k(e.$t(o.label)),11,lt))),128))]),_:1},8,["modelValue"])),e.showViewToggle&&!e.isPhone?(i(),y(te,{key:3,"card-view":F.value,"onUpdate:cardView":t[5]||(t[5]=o=>V(q)(o))},null,8,["card-view"])):R("",!0)],64)):(i(),v(H,{key:1},[e.filterTrash?(i(),y(z,{key:0,modelValue:d.value,"onUpdate:modelValue":t[7]||(t[7]=o=>d.value=o)},{trigger:_(()=>[D((i(),y($,null,{default:_(()=>[w(I)]),_:1})),[[P,e.$t("sort")]])]),default:_(()=>[u("div",{class:"dropdown-item",onClick:t[6]||(t[6]=S(o=>{V(A)(),d.value=!1},["stop"]))},k(e.$t("keyboard_shortcuts")),1),(i(!0),v(H,null,Q(e.sortItems,o=>(i(),v("div",{key:o.value,class:O(["dropdown-item",{selected:o.value===e.sortBy}]),onClick:S(E=>{e.onSort(o.value),d.value=!1},["stop"])},k(e.$t(o.label)),11,at))),128))]),_:1},8,["modelValue"])):e.showViewToggle?(i(),y(te,{key:1,"card-view":F.value,"onUpdate:cardView":t[8]||(t[8]=o=>V(q)(o))},null,8,["card-view"])):R("",!0)],64))}}}),vt=[{keys:["Delete"],description:"delete_selected"},{keys:["modifier","+","Backspace"],description:"delete_selected"},{keys:["modifier","+","A"],description:"select_all"},{keys:["Esc"],description:"clear_selection"},{keys:["←","→"],description:"navigate_pages"},{keys:["Shift","+","Click"],description:"range_select"}];export{_t as _,mt as c,vt as m};
