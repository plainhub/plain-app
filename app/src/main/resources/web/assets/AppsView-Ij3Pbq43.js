import{_ as Ye}from"./VPagination.vuevuetypescriptsetuptruelang-vLyLex3u.js";import{_ as Je}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-DyX6fBdv.js";import{d as Q,r as E,c as r,o as l,V as F,Z as S,j as m,a0 as J,O as k,v as h,$ as We,H as oe,U as ne,T as le,t as a,a7 as Xe,L as ye,a as d,ar as Ze,I as G,a8 as xe,aC as et,A as g,as as tt,aD as we,k as t,q as me,aE as _e,a9 as j,s as ve,f as st,e as nt,u as ot,a5 as lt,aF as it,ad as at,i as fe,N as ge,X as dt,Y as ct,w as pt,h as K,K as ut,aG as rt,aH as mt,a2 as _t,C as vt,aI as ft,aJ as gt,G as Y,al as ht,aK as kt,aL as yt,aM as wt,aN as $t,ac as he,Q as It}from"./index-DUFKAMTy.js";import{_ as $e}from"./VCheckbox-C_j6Dn2V.js";import{t as M}from"./tapphone-hT2n0OvG.js";import{_ as bt,a as Ct,b as St}from"./key-events-DaO75Yps.js";import{u as At,a as Ut}from"./upload-On9Q0718.js";import{_ as Dt}from"./upload-rounded-BHrIrUNG.js";import{_ as Pt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-BXNRzmxO.js";import{_ as Lt}from"./FieldId.vuevuetypescriptsetuptruelang-Dhult7CA.js";function Bt(A,_){const o=A.findIndex(u=>u.id===_);o!==-1&&A.splice(o,1)}const Et=["onClick"],Ft=Q({__name:"AppsActionButtons",props:{sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(A,{emit:_}){const o=_,u=E(!1);function y(){o("install")}function w(p){o("sort",p)}return(p,e)=>{const c=Dt,$=oe,U=Xe,I=We,b=J("tooltip");return l(),r(F,null,[S((l(),k($,{onClick:y},{default:h(()=>[m(c)]),_:1})),[[b,p.$t("install_app")]]),m(I,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i)},{trigger:h(()=>[S((l(),k($,{loading:p.sorting},{default:h(()=>[m(U)]),_:1},8,["loading"])),[[b,p.$t("sort")]])]),default:h(()=>[(l(!0),r(F,null,ne(p.sortItems,i=>(l(),r("div",{key:i.value,class:le(["dropdown-item",{selected:i.value===p.appSortBy}]),onClick:C=>{w(i.value),u.value=!1}},a(p.$t(i.label)),11,Et))),128))]),_:1},8,["modelValue"])],64)}}}),Nt=ye(Ft,[["__scopeId","data-v-0cf682e0"]]),Mt={key:0,class:"app-item selectable-card-skeleton"},Vt={class:"start"},qt={class:"number"},Tt=Q({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(A){return(_,o)=>{const u=bt;return _.isPhone?(l(),k(u,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(l(),r("section",Mt,[d("div",Vt,[o[0]||(o[0]=d("div",{class:"skeleton-checkbox"},null,-1)),d("span",qt,a(_.index),1)]),o[1]||(o[1]=Ze('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Kt={class:"actions"},ke=Q({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const o=_;function u(){o("uninstall")}function y(){o("download")}function w(){o("cancelUninstall")}return(p,e)=>{const c=xe,$=et,U=tt,I=oe,b=we,i=J("tooltip");return l(),r("div",Kt,[p.item.isUninstalling?(l(),r(F,{key:0},[S(m(c,{indeterminate:"",class:"sm"},null,512),[[i,p.$t("uninstalling")]]),e[0]||(e[0]=G(" Â ")),m($,{class:"btn-sm",onClick:g(w,["stop"])},{default:h(()=>[G(a(p.$t("cancel")),1)]),_:1})],64)):(l(),r(F,{key:1},[S((l(),k(I,{class:"sm",onClick:g(u,["stop"])},{default:h(()=>[m(U)]),_:1})),[[i,p.$t("uninstall")]]),S((l(),k(I,{class:"sm",onClick:g(y,["stop"])},{default:h(()=>[m(b)]),_:1})),[[i,p.$t("download")]])],64))])}}}),Gt={class:"start"},Qt={class:"number"},zt=["src"],Ot={class:"title"},Rt={class:"subtitle"},Ht={class:"actions"},jt={class:"time"},Yt=["src"],Jt={class:"subtitle"},Wt={class:"subtitle"},Xt={class:"subtitle"},Zt={class:"subtitle"},xt=Q({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const o=A,u=_;function y(){u("uninstall",o.item)}function w(){u("download",o.item)}function p(){u("cancelUninstall",o.item)}return(e,c)=>{const $=$e,U=Lt,I=Pt,b=J("tooltip");return e.isPhone?(l(),k(I,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:c[4]||(c[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:c[5]||(c[5]=g(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:c[6]||(c[6]=i=>e.toggleSelect(i,e.item,e.index))},{image:h(()=>[d("img",{class:"image",src:e.item.icon},null,8,Yt)]),title:h(()=>[G(a(e.item.name)+" ("+a(e.item.version)+")",1)]),subtitle:h(()=>[d("div",Jt,a(e.item.id),1),d("div",Wt,[d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Xt,a(e.$t("installed_at"))+": "+a(t(j)(e.item.installedAt)),1),d("div",Zt,a(e.$t("updated_at"))+": "+a(t(j)(e.item.updatedAt)),1)]),actions:h(()=>[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(l(),r("section",{key:0,class:le(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:c[2]||(c[2]=g(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:c[3]||(c[3]=g(i=>e.handleMouseOver(i,e.index),["stop"]))},[d("div",Gt,[e.shiftEffectingIds.includes(e.item.id)?(l(),k($,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:c[0]||(c[0]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(l(),k($,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:c[1]||(c[1]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),d("span",Qt,[m(U,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),d("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,zt),d("div",Ot,a(e.item.name)+" ("+a(e.item.version)+")",1),d("div",Rt,[d("span",null,a(e.item.id),1),d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Ht,[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),d("div",jt,[S((l(),r("span",null,[G(a(e.$t("installed_at"))+": "+a(t(j)(e.item.installedAt)),1)])),[[b,t(_e)(e.item.installedAt)]]),S((l(),r("span",null,[G(a(e.$t("updated_at"))+": "+a(t(j)(e.item.updatedAt)),1)])),[[b,t(_e)(e.item.updatedAt)]])])],34))}}}),es={class:"top-app-bar"},ts={class:"title"},ss={key:0},ns={key:1},os={key:0,class:"actions"},ls={key:0,class:"no-data-placeholder"},V=50,is=Q({__name:"AppsView",setup(A){var re;const _=ut("isPhone"),o=E([]),{app:u,urlTokenKey:y,uploads:w}=ve(st()),{input:p,upload:e,uploadChanged:c}=At(w),{dropping:$,fileDragEnter:U,fileDragLeave:I,dropFiles:b}=Ut(w),i=nt(),C=E([]),{t:N}=ot(),{appSortBy:z}=ve(i),Ie=rt(),W=E(!1),q=lt(),O=E(parseInt(((re=q.query.page)==null?void 0:re.toString())??"1")),X=E(""),Z=E(!1);let P;const{selectedIds:R,allChecked:ie,realAllChecked:x,selectRealAll:be,allCheckedAlertVisible:Ce,clearSelection:ee,toggleAllChecked:Se,toggleSelect:Ae,total:L,checked:H,shiftEffectingIds:Ue,handleItemClick:De,handleMouseOver:Pe,selectAll:Le,shouldSelect:Be}=Ct(C),{downloadItems:Ee}=it(y,at.PACKAGE,ee,()=>$t("apps")),{downloadFile:Fe}=wt(y),te=s=>{const n=q.query.q;vt(i,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:ae,keyUp:de}=St(L,V,O,Le,ee,te,()=>{}),Ne=()=>{e(u.value.downloadsDir)},{mutate:Me}=fe({document:ft}),Ve=s=>{s.isUninstalling=!1},{loading:se,fetch:ce}=ge({handle:(s,n)=>{W.value=!1,n?Y(N(n),"error"):s&&(C.value=s.packages.map(v=>({...v,isUninstalling:!1,icon:ht(y.value,"pkgicon://"+v.id)})),L.value=s.packageCount)},document:gt,variables:()=>({offset:(O.value-1)*V,limit:V,query:X.value,sortBy:z.value})});function qe(s){z.value!==s&&(W.value=!0,z.value=s,te(1))}function pe(){var s,n;Z.value&&(O.value=parseInt(((s=q.query.page)==null?void 0:s.toString())??"1"),X.value=It(((n=q.query.q)==null?void 0:n.toString())??""),ce())}const{mutate:Te}=fe({document:kt});function Ke(s){s.isUninstalling=!0,M(N("confirm_uninstallation_on_phone")),Te({id:s.id})}function Ge(s){Fe(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:Qe,fetch:ze}=ge({handle:s=>{if(s)for(const n of s.packageStatuses){const v=o.value.find(D=>D.id===n.id);if(v){const D=v.isNew&&n.exist,T=!v.isNew&&n.exist&&v.updatedAt<n.updatedAt;(D||T)&&(o.value=o.value.filter(B=>B.id!==n.id),M(""),D?Y(N("app_installation_completed")):Y(N("app_upgrade_completed")),ce())}else n.exist||(Bt(C.value,n.id),M(""))}},document:yt,variables:()=>({ids:[...C.value.filter(s=>s.isUninstalling).map(s=>s.id),...o.value.map(s=>s.id)]})}),ue=s=>{s.status==="done"&&Me({path:s.dir+"/"+s.fileName}).then(n=>{if(M(N("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:v,updatedAt:D,isNew:T}=n.data.installPackage;v&&(o.value.push({id:v,updatedAt:D,isNew:T}),setTimeout(()=>{o.value.some(B=>B.id===v)&&(o.value=o.value.filter(B=>B.id!==v),M(""))},12e4))}}).catch(n=>{M(""),Y(N("app_installation_failed")+": "+n.message,"error")})};function Oe(s){b(s,u.value.downloadsDir,n=>n.name.endsWith(".apk"))}return dt(()=>{Z.value=!0,P&&(clearInterval(P),P=void 0),P=window.setInterval(()=>{(C.value.some(s=>s.isUninstalling)||o.value.length>0)&&!Qe.value&&ze()},1e3),pe(),he.on("upload_task_done",ue),window.addEventListener("keydown",ae),window.addEventListener("keyup",de)}),ct(()=>{Z.value=!1,P&&(clearInterval(P),P=void 0),he.off("upload_task_done",ue),window.removeEventListener("keydown",ae),window.removeEventListener("keyup",de)}),pt(()=>q.fullPath,()=>{pe()}),(s,n)=>{const v=$e,D=we,T=oe,B=Je,Re=Ye,He=J("tooltip");return l(),r(F,null,[d("div",es,[m(v,{"touch-target":"wrapper",checked:t(ie),indeterminate:!t(ie)&&t(H),onChange:t(Se)},null,8,["checked","indeterminate","onChange"]),d("div",ts,[t(R).length?(l(),r("span",ss,a(s.$t("x_selected",{count:t(x)?t(L).toLocaleString():t(R).length.toLocaleString()})),1)):(l(),r("span",ns,a(s.$t("page_title.apps"))+" ("+a(t(L).toLocaleString())+")",1)),t(H)?S((l(),k(T,{key:2,onClick:n[0]||(n[0]=g(f=>t(Ee)(t(x),t(R),X.value),["stop"]))},{default:h(()=>[m(D)]),_:1})),[[He,s.$t("download")]]):K("",!0)]),!t(_)||!t(H)?(l(),r("div",os,[m(Nt,{sorting:W.value,"sort-items":t(Ie),"app-sort-by":t(z),onInstall:Ne,onSort:qe},null,8,["sorting","sort-items","app-sort-by"])])):K("",!0)]),m(B,{limit:V,total:t(L),"all-checked-alert-visible":t(Ce),"real-all-checked":t(x),"select-real-all":t(be),"clear-selection":t(ee)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),d("div",{class:"scroll-content",onDragover:n[3]||(n[3]=g((...f)=>t(U)&&t(U)(...f),["stop","prevent"]))},[S(d("div",{class:"drag-mask",onDrop:g(Oe,["stop","prevent"]),onDragleave:n[1]||(n[1]=g((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},a(s.$t("release_to_send_files")),545),[[mt,t($)]]),d("div",{class:le(["main-list",{"select-mode":t(H)}])},[(l(!0),r(F,null,ne(C.value,(f,je)=>(l(),k(xt,{key:f.id,item:f,index:je,"selected-ids":t(R),"shift-effecting-ids":t(Ue),"should-select":t(Be),"is-phone":t(_),"handle-item-click":t(De),"handle-mouse-over":t(Pe),"toggle-select":t(Ae),onUninstall:Ke,onDownload:Ge,onCancelUninstall:Ve},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(se)&&C.value.length===0?(l(),r(F,{key:0},ne(20,f=>m(Tt,{key:f,index:f,"is-phone":t(_)},null,8,["index","is-phone"])),64)):K("",!0)],2),!t(se)&&C.value.length===0?(l(),r("div",ls,a(s.$t(t(_t)(t(se),t(u).permissions,"QUERY_ALL_PACKAGES"))),1)):K("",!0),t(L)>V?(l(),k(Re,{key:1,page:O.value,go:te,total:t(L),limit:V},null,8,["page","total"])):K("",!0),d("input",{ref_key:"fileInput",ref:p,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(c)&&t(c)(...f))},null,544)],32)],64)}}}),gs=ye(is,[["__scopeId","data-v-f01c2449"]]);export{gs as default};
