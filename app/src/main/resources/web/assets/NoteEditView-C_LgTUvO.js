import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-Ctai34Uw.js";import{_ as ae}from"./print-outline-rounded-D5HJrs3t.js";import{bm as ne,bn as G,bo as oe,d as se,e as ie,u as ue,r as T,s as re,f as le,g as ce,Y as de,i as me,bp as _e,ai as fe,a4 as ve,a7 as E,aj as pe,c as O,o as b,a as y,O as x,P as ge,M as S,v as q,A,I as P,h as j,t as he,k as F,au as Te,j as C,T as be,a0 as z,w as ye,U as ke,H as we,bq as Ce,G as K,br as Me,bs as Le,bt as Ne,Q as $e,aa as Ee,C as xe,a5 as Se,a6 as Ie,bu as Ve,L as De}from"./index-DZRXRZ01.js";import{_ as Re}from"./FieldId.vuevuetypescriptsetuptruelang-BK6GHXRD.js";import{u as Qe}from"./markdown-MkkWlgD2.js";var H=function(){return ne.Date.now()},Ue="Expected a function",qe=Math.max,Ae=Math.min;function He(I,r,u){var d,n,o,i,s,l,_=0,L=!1,f=!1,v=!0;if(typeof I!="function")throw new TypeError(Ue);r=G(r)||0,oe(u)&&(L=!!u.leading,f="maxWait"in u,o=f?qe(G(u.maxWait)||0,r):o,v="trailing"in u?!!u.trailing:v);function k(a){var c=d,e=n;return d=n=void 0,_=a,i=I.apply(e,c),i}function N(a){return _=a,s=setTimeout(m,r),L?k(a):i}function V(a){var c=a-l,e=a-_,t=r-c;return f?Ae(t,o-e):t}function p(a){var c=a-l,e=a-_;return l===void 0||c>=r||c<0||f&&e>=o}function m(){var a=H();if(p(a))return $(a);s=setTimeout(m,V(a))}function $(a){return s=void 0,v&&d?k(a):(d=n=void 0,i)}function D(){s!==void 0&&clearTimeout(s),_=0,d=l=n=s=void 0}function R(){return s===void 0?i:$(H())}function w(){var a=H(),c=p(a);if(d=arguments,n=this,l=a,c){if(s===void 0)return N(l);if(f)return clearTimeout(s),s=setTimeout(m,r),k(l)}return s===void 0&&(s=setTimeout(m,r)),i}return w.cancel=D,w.flush=R,w}const We={class:"top-app-bar"},Be={class:"title"},Ge={class:"state-point"},Oe={class:"actions"},Pe={class:"panel-container"},je=["innerHTML"],M="NOTE",Fe=se({__name:"NoteEditView",setup(I){const r=ie(),{t:u}=ue(),d=ve(),n=T(""),o=T(),i=T(""),s=T(""),l=T(!1),{app:_,urlTokenKey:L}=re(le());function f(){const e=Ee.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),xe(r,t)}const{render:v}=Qe(_,L),k=He(()=>{l.value=!1,$({id:n.value,input:{content:i.value,title:Ve(i.value,{length:250,omission:""})}})},500),N=()=>{ye(i,async e=>{l.value=!0,s.value=await v(e),k()})},V=()=>{window.print()},p=T();ce({handle:(e,t)=>{t?K(u(t),"error"):e&&(p.value=e.tags)},document:Ce,variables:{type:M}});const{fetch:m}=de({handle:async(e,t)=>{t?K(u(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await v(i.value),N())},document:Me,variables:()=>({id:n.value}),options:{fetchPolicy:"no-cache"}}),{mutate:$,onDone:D}=me({document:Le});D(e=>{var t,g;o.value=e.data.saveNote,!n.value&&((t=o.value)!=null&&t.id)&&(n.value=(g=o.value)==null?void 0:g.id,_e(r,`/notes/${n.value}`))});function R(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${u("updated_at")}: ${ke(e)})`:""}function w(){var e,t;Se(Ie,{type:M,tags:p.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=p.value)==null?void 0:t.filter(g=>{var h;return(h=o.value)==null?void 0:h.tags.some(Q=>Q.id===g.id)})})}const a=e=>{e.type===M&&m()},c=e=>{e.type===M&&m()};return fe(()=>{n.value=d.params.id,n.value==="create"&&(n.value=""),n.value?m():N(),E.on("item_tags_updated",c),E.on("items_tags_updated",a)}),pe(()=>{E.off("item_tags_updated",c),E.off("items_tags_updated",a)}),(e,t)=>{var W,B;const g=Ne,h=we,Q=Re,X=be,Y=$e,J=ae,Z=te,U=ge("tooltip");return b(),O(z,null,[y("div",We,[x((b(),S(h,{onClick:A(f,["prevent"])},{default:q(()=>[C(g)]),_:1})),[[U,e.$t("back")]]),y("div",Be,[P(he(n.value?F(u)("edit"):F(u)("create"))+" ",1),x(y("span",Ge,"*",512),[[Te,l.value]]),t[1]||(t[1]=P()),(W=o.value)!=null&&W.updatedAt?(b(),S(Q,{key:0,id:R(),class:"time",raw:o.value},null,8,["id","raw"])):j("",!0)]),y("div",Oe,[C(X,{tags:(B=o.value)==null?void 0:B.tags,type:M,"only-links":!0},null,8,["tags"]),n.value?(b(),O(z,{key:0},[x((b(),S(h,{onClick:A(w,["prevent"])},{default:q(()=>[C(Y)]),_:1})),[[U,e.$t("add_to_tags")]]),x((b(),S(h,{onClick:A(V,["prevent"])},{default:q(()=>[C(J)]),_:1})),[[U,e.$t("print")]])],64)):j("",!0)])]),y("div",Pe,[C(Z,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=ee=>i.value=ee),language:"html"},null,8,["modelValue"]),y("div",{class:"md-container",innerHTML:s.value},null,8,je)])],64)}}}),Ze=De(Fe,[["__scopeId","data-v-2c4e12eb"]]);export{Ze as default};
