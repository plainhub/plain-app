import{r as F,c8 as D}from"./index-Cn6MD5BA.js";function v(n,t,r,i,e){return{id:D(),batchId:r,createdAt:Date.now(),dir:t,baseDir:i,relativePath:e,fileName:"",file:n,status:"created",uploadedSize:0,error:"",pausing:!1}}function I(n,t){const r=(n||"").replace(/\/+$/g,""),i=(t||"").replace(/^\/+/,"");return(r?`${r}/${i}`:`/${i}`).replace(/\/+?/g,"/").replace(/\/+$/g,"")}const P=n=>{let t="";const r=F();return{input:r,upload(i){t=i,r.value.value="",r.value.click()},uploadChanged(i){const e=i.target.files;if(!e)return;const l=D(),o=[];for(let p=0;p<e.length;p++){const c=e[p],s=c.webkitRelativePath?String(c.webkitRelativePath):"";if(s&&s.includes("/")){const d=s.split("/").filter(Boolean).slice(0,-1).join("/"),h=d?I(t,d):t;o.push(v(c,h,l,t,s))}else o.push(v(c,t,l,t,s||void 0))}n.value=[...n.value,...o]}}},U=n=>{const t=F(!1),r=async(i,e="")=>{const l=[],o=i.createReader(),c=await new Promise(s=>{o.readEntries(s)});for(const s of c)if(s.isFile){const f=await new Promise(h=>{s.file(h)}),d=e?`${e}/${s.name}`:s.name;l.push({file:f,relativePath:d})}else if(s.isDirectory){const f=e?`${e}/${s.name}`:s.name,d=await r(s,f);l.push(...d)}return l};return{dropping:t,fileDragEnter(i){var e;(e=i.dataTransfer)!=null&&e.types.includes("Files")&&(t.value=!0)},fileDragLeave(){t.value=!1},async dropFiles(i,e,l){var w;t.value=!1;const o=(w=i.dataTransfer)==null?void 0:w.items;if(!o)return;const p=[];for(let u=0;u<o.length;u++){const m=o[u];if(m.kind==="file"){const a=m.webkitGetAsEntry();if(a!=null&&a.isFile){const g=m.getAsFile();g&&p.push({file:g,relativePath:g.name})}else if(a!=null&&a.isDirectory){const g=await r(a,a.name);p.push(...g)}}}const c=p.filter(u=>l(u.file));if(c.length===0)return;const s=typeof e=="function"?await e():e,f=String(s||"").trim();if(!f)return;const d=D(),h=[];for(const u of c){const m=u.file,a=u.relativePath.split("/"),g=a.length>1?I(f,a.slice(0,-1).join("/")):f;h.push(v(m,g,d,f,u.relativePath))}h.length>0&&(n.value=[...n.value,...h])}}},b=()=>({getUploads(n,t){const r=D(),i=[];for(let e=0;e<t.length;e++){const l=t[e];i.push(v(l,n,r,n))}return i}});export{U as a,b,P as u};
