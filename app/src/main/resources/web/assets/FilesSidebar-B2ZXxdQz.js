import{_ as ue}from"./LeftSidebar.vuevuetypescriptsetuptruelang-BXgsjlkg.js";import{_ as ce}from"./VDropdownMenu-DSdu_7RS.js";import{m as de,c as f,o as d,a as l,d as pe,e as ve,s as fe,f as he,u as _e,bW as me,M as Pe,r as M,i as W,W as b,q as H,w as ye,O as A,v as D,P as j,Q as Te,bY as ge,c8 as ke,ac as z,h as Z,j as Y,U as G,A as V,T as J,t as y,V as $,Z as Ce,a0 as Ee,H as Se,bR as Re,G as O,ab as we,bZ as Fe,D as Me,C as K,E as be,c9 as Ae}from"./index-BBktiafP.js";import{_ as $e}from"./VolumeCard.vuevuetypescriptsetuptruelang-DuB3LcD7.js";const Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ne(X,h){return d(),f("svg",Be,h[0]||(h[0]=[l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[l("path",{d:"M3 12a9 9 0 1 0 9-9a9.75 9.75 0 0 0-6.74 2.74L3 8"}),l("path",{d:"M3 3v5h5m4-1v5l4 2"})],-1)]))}const Le=de({name:"lucide-history",render:Ne}),De={class:"nav"},Ge=["onClick"],Ve={class:"icon","aria-hidden":"true"},Oe={class:"title"},xe={class:"section-title"},qe={class:"volumes"},Ie={class:"section-title"},Ue={class:"nav"},Qe=["onClick"],We={class:"title"},Je=pe({__name:"FilesSidebar",setup(X){const h=ve(),{app:T}=fe(he()),{t:i}=_e(),{mounts:_}=me(),{parseQ:ee}=ge(),x=Pe({showHidden:!1,type:"",rootPath:"",text:"",parent:""}),q=M(""),E=M(!1),g=M(!1),S=M(null);function te(){K(h,"/files/recent")}function oe(t){S.value=t;const n=document.getElementById("favorite-"+t.fullPath);document.dispatchEvent(new CustomEvent("dropdown-toggle",{detail:{exclude:n}})),g.value=!0}const{mutate:ne,loading:He}=W({document:ke,options:{update:()=>{z.emit("refetch_app")}}});function se(t){ne({fullPath:t.fullPath}).then(()=>{O(i("removed"))}).catch(n=>{console.error("Error removing favorite folder:",n),O(i("error"),"error")})}function ae(){var m;const t=S.value;if(!t)return;const n=(m=T.value.favoriteFolders)==null?void 0:m.find(v=>v.fullPath===t.fullPath),p=((n==null?void 0:n.alias)||"").trim(),k=()=>W({document:Ae,options:{update:()=>{z.emit("refetch_app")}}});we(Fe,{title:i("name"),placeholder:t.title||"",value:p||"",mutation:k,getVariables:v=>({fullPath:t.fullPath,alias:(v||"").trim()}),done:()=>{O(i("saved"))}})}const B=b(()=>{const t=e=>{var u;const s=[..._.value.map(c=>c.mountPoint).filter(Boolean),...((u=T.value.favoriteFolders)==null?void 0:u.map(c=>c.fullPath))||[]];let a="";return s.forEach(c=>{e.startsWith(c)&&c.length>a.length&&(a=c)}),a},n=e=>{const s=(e.alias||"").trim();if(s)return s;const a=_.value.filter(r=>r.driveType==="USB_STORAGE").map(r=>r.mountPoint).filter(Boolean),u=new Map(a.map((r,C)=>[r,C+1])),c=r=>{if(!r)return"";if(r.driveType==="INTERNAL_STORAGE")return i("internal_storage");if(r.driveType==="APP")return i("app_data");if(r.driveType==="SDCARD")return i("sdcard");if(r.driveType==="USB_STORAGE"){const C=u.get(r.mountPoint)??1;return`${i("usb_storage")} ${C}`}return r.name||r.mountPoint},F=(()=>{const r=_.value.find(C=>C.mountPoint===e.rootPath);return c(r)||e.rootPath})(),Q=e.fullPath.startsWith(e.rootPath)?e.fullPath.substring(e.rootPath.length).replace(/^\//,""):e.fullPath.split("/").pop()||"";return Q?`${F}/${Q}`:F},p=(e,s)=>s<=0?"":i("storage_free_total",{free:H(e),total:H(s)}),k=(e,s)=>s<=0?0:Math.max(0,s-e)/s*100,m=(e,s)=>{if(e.driveType==="INTERNAL_STORAGE")return i("internal_storage");if(e.driveType==="APP")return i("app_data");if(e.driveType==="SDCARD")return i("sdcard");if(e.driveType==="USB_STORAGE"){const a=s.get(e.mountPoint)??1;return`${i("usb_storage")} ${a}`}return e.name||e.mountPoint},v=E.value?"":t(q.value),P=[];P.push({rootPath:"",fullPath:"",type:"RECENTS",title:i("recents"),isChecked:E.value,isFavoriteFolder:!1});const L=_.value.filter(e=>e.driveType==="USB_STORAGE").map(e=>e.mountPoint).filter(Boolean),R=new Map(L.map((e,s)=>[e,s+1])),o=e=>e.driveType==="INTERNAL_STORAGE"?0:e.driveType==="SDCARD"?1:e.driveType==="USB_STORAGE"?2:e.driveType==="APP"?3:9;return[..._.value].sort((e,s)=>{const a=o(e),u=o(s);return a!==u?a-u:(e.mountPoint||"").localeCompare(s.mountPoint||"")}).forEach(e=>{const s=e.mountPoint;if(!s)return;const a=Number(e.totalBytes||0),u=Number(e.freeBytes||0);P.push({rootPath:s,fullPath:s,type:e.driveType||"",title:m(e,R),isChecked:v===s,isFavoriteFolder:!1,count:p(u,a),usedPercent:k(u,a),showProgress:a>0})}),T.value.favoriteFolders&&T.value.favoriteFolders.length>0&&T.value.favoriteFolders.forEach((e,s)=>{var c;const a=n(e),u=((c=_.value.find(F=>F.mountPoint===e.rootPath))==null?void 0:c.driveType)??"";P.push({rootPath:e.rootPath,fullPath:e.fullPath,type:u,title:a,isChecked:v===e.fullPath,isFavoriteFolder:!0})}),P}),re=b(()=>B.value.filter(t=>t.type==="RECENTS")),ie=b(()=>B.value.filter(t=>t.type!=="RECENTS"&&!t.isFavoriteFolder)),I=b(()=>B.value.filter(t=>t.isFavoriteFolder));function le(t){return Math.round(t||0)>=85?"warn":""}function N(t){if(t.type==="RECENTS"){te();return}const n=[];n.push({name:"parent",op:"",value:t.fullPath}),n.push({name:"type",op:"",value:t.type}),n.push({name:"root_path",op:"",value:t.rootPath}),h.fileShowHidden&&n.push({name:"show_hidden",op:"",value:"true"});const p=Me(n);K(h,`/files?q=${be(p)}`)}function U(){var p;const t=j.currentRoute.value;if(t.path==="/files/recent"){E.value=!0;return}E.value=!1;const n=Te(((p=t.query.q)==null?void 0:p.toString())??"");ee(x,n),q.value=x.parent}return U(),ye(()=>j.currentRoute.value.fullPath,()=>{U()}),(t,n)=>{const p=Le,k=Re,m=Se,v=ce,P=ue,L=Ee("tooltip");return d(),A(P,{class:"files-sidebar"},{body:D(()=>{var R;return[l("ul",De,[(d(!0),f($,null,G(re.value,o=>(d(),f("li",{key:o.type,class:J({active:o.isChecked}),onClick:V(w=>N(o),["prevent"])},[l("span",Ve,[o.type==="RECENTS"?(d(),A(p,{key:0})):Z("",!0)]),l("span",Oe,y(o.title),1)],10,Ge))),128))]),l("div",xe,y(t.$t("volumes")),1),l("div",qe,[(d(!0),f($,null,G(ie.value,o=>(d(),A($e,{key:o.fullPath,title:o.title,count:o.count||"",data:o,"used-percent":o.usedPercent||0,"percent-class":le(o.usedPercent),active:o.isChecked,"show-progress":o.showProgress,onClick:w=>N(o)},null,8,["title","count","data","used-percent","percent-class","active","show-progress","onClick"]))),128))]),I.value.length?(d(),f($,{key:0},[l("div",Ie,y(t.$t("favorites")),1),l("ul",Ue,[(d(!0),f($,null,G(I.value,o=>(d(),f("li",{key:o.fullPath,class:J({active:o.isChecked}),onClick:V(w=>N(o),["prevent"])},[l("span",We,y(o.title),1),Ce((d(),A(m,{id:"favorite-"+o.fullPath,class:"sm",onClick:V(w=>oe(o),["prevent","stop"])},{default:D(()=>[Y(k)]),_:2},1032,["id","onClick"])),[[L,t.$t("actions")]])],10,Qe))),128))])],64)):Z("",!0),Y(v,{modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=o=>g.value=o),anchor:"favorite-"+((R=S.value)==null?void 0:R.fullPath)},{default:D(()=>[l("div",{class:"dropdown-item",onClick:n[0]||(n[0]=o=>{ae(),g.value=!1})},y(t.$t("rename")),1),l("div",{class:"dropdown-item",onClick:n[1]||(n[1]=o=>{se(S.value),g.value=!1})},y(t.$t("remove_from_favorites")),1)]),_:1},8,["modelValue","anchor"])]}),_:1})}}});export{Je as default};
