import{_ as Ye}from"./VPagination.vuevuetypescriptsetuptruelang-Dc9zFoqV.js";import{_ as Je}from"./AllCheckedAlert.vuevuetypescriptsetuptruelang-CYEIcA8l.js";import{d as z,r as E,c as r,o,a0 as F,O as C,j as m,P as J,M as k,x as h,al as We,I as le,a1 as ne,R as oe,t as a,L as ye,a as d,N as Xe,J as Q,am as Ze,an as xe,B as g,ac as et,ao as we,k as t,q as me,ap as _e,U as H,s as ve,f as tt,aq as st,ar as nt,e as lt,u as ot,a4 as it,as as at,X as dt,i as fe,Y as ge,Z as ct,$ as pt,w as ut,h as K,v as rt,at as mt,au as _t,a2 as vt,D as ft,av as gt,aw as ht,H as Y,ax as kt,ay as yt,az as wt,aA as $t,aB as It,a7 as he,a8 as bt}from"./index-CeUr62re.js";import{_ as $e}from"./VCheckbox-CSv76wry.js";import{t as N}from"./tapphone-BwUboyiz.js";import{_ as St,u as Ct,a as At}from"./key-events-CgP6ASXB.js";import{_ as Ut,a as Dt}from"./upload-rounded-DJ0Yf-yS.js";import{_ as Pt}from"./ListItemPhone.vuevuetypescriptsetuptruelang-DoWZIdQX.js";import{_ as Bt}from"./FieldId.vuevuetypescriptsetuptruelang-B3E1S5iR.js";function Lt(A,_){const l=A.findIndex(u=>u.id===_);l!==-1&&A.splice(l,1)}const Et=["onClick"],Ft=z({__name:"AppsActionButtons",props:{sorting:{type:Boolean},sortItems:{},appSortBy:{}},emits:["install","sort"],setup(A,{emit:_}){const l=_,u=E(!1);function y(){l("install")}function w(p){l("sort",p)}return(p,e)=>{const c=Ut,$=le,U=Dt,I=We,b=J("tooltip");return o(),r(F,null,[C((o(),k($,{onClick:y},{default:h(()=>[m(c)]),_:1})),[[b,p.$t("install_app")]]),m(I,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i)},{trigger:h(()=>[C((o(),k($,{loading:p.sorting},{default:h(()=>[m(U)]),_:1},8,["loading"])),[[b,p.$t("sort")]])]),default:h(()=>[(o(!0),r(F,null,ne(p.sortItems,i=>(o(),r("div",{key:i.value,class:oe(["dropdown-item",{selected:i.value===p.appSortBy}]),onClick:S=>{w(i.value),u.value=!1}},a(p.$t(i.label)),11,Et))),128))]),_:1},8,["modelValue"])],64)}}}),Mt=ye(Ft,[["__scopeId","data-v-0cf682e0"]]),Nt={key:0,class:"app-item selectable-card-skeleton"},qt={class:"start"},Vt={class:"number"},Tt=z({__name:"AppSkeletonItem",props:{index:{},isPhone:{type:Boolean}},setup(A){return(_,l)=>{const u=St;return _.isPhone?(o(),k(u,{key:1,"title-width":"70%",subtitles:[{width:"45%"},{width:"30%"},{width:"40%"},{width:"40%"}],"action-count":2})):(o(),r("section",Nt,[d("div",qt,[l[0]||(l[0]=d("div",{class:"skeleton-checkbox"},null,-1)),d("span",Vt,a(_.index),1)]),l[1]||(l[1]=Xe('<div class="image"><div class="skeleton-image lg"></div></div><div class="title"><div class="skeleton-text lg" style="width:40%;"></div></div><div class="subtitle"><div class="skeleton-text" style="width:55%;"></div></div><div class="actions"><div class="skeleton-text lg" style="width:60px;"></div></div><div class="time"><div class="skeleton-text" style="width:120px;"></div><div class="skeleton-text" style="width:120px;"></div></div>',5))]))}}}),Kt={class:"actions"},ke=z({__name:"AppActionButtons",props:{item:{}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const l=_;function u(){l("uninstall")}function y(){l("download")}function w(){l("cancelUninstall")}return(p,e)=>{const c=Ze,$=xe,U=et,I=le,b=we,i=J("tooltip");return o(),r("div",Kt,[p.item.isUninstalling?(o(),r(F,{key:0},[C(m(c,{indeterminate:"",class:"sm"},null,512),[[i,p.$t("uninstalling")]]),e[0]||(e[0]=Q(" Â ")),m($,{class:"btn-sm",onClick:g(w,["stop"])},{default:h(()=>[Q(a(p.$t("cancel")),1)]),_:1})],64)):(o(),r(F,{key:1},[C((o(),k(I,{class:"sm",onClick:g(u,["stop"])},{default:h(()=>[m(U)]),_:1})),[[i,p.$t("uninstall")]]),C((o(),k(I,{class:"sm",onClick:g(y,["stop"])},{default:h(()=>[m(b)]),_:1})),[[i,p.$t("download")]])],64))])}}}),Qt={class:"start"},zt={class:"number"},Gt=["src"],Rt={class:"title"},Ot={class:"subtitle"},jt={class:"actions"},Ht={class:"time"},Yt=["src"],Jt={class:"subtitle"},Wt={class:"subtitle"},Xt={class:"subtitle"},Zt={class:"subtitle"},xt=z({__name:"AppListItem",props:{item:{},index:{},selectedIds:{},shiftEffectingIds:{},shouldSelect:{type:Boolean},isPhone:{type:Boolean},handleItemClick:{type:Function},handleMouseOver:{type:Function},toggleSelect:{type:Function}},emits:["uninstall","download","cancelUninstall"],setup(A,{emit:_}){const l=A,u=_;function y(){u("uninstall",l.item)}function w(){u("download",l.item)}function p(){u("cancelUninstall",l.item)}return(e,c)=>{const $=$e,U=Bt,I=Pt,b=J("tooltip");return e.isPhone?(o(),k(I,{key:1,"is-selected":e.selectedIds.includes(e.item.id),"is-selecting":e.shiftEffectingIds.includes(e.item.id),"checkbox-checked":e.shiftEffectingIds.includes(e.item.id)?e.shouldSelect:e.selectedIds.includes(e.item.id),onClick:c[4]||(c[4]=i=>e.handleItemClick(i,e.item,e.index,()=>{})),onMouseenter:c[5]||(c[5]=g(i=>e.handleMouseOver(i,e.index),["stop"])),onCheckboxClick:c[6]||(c[6]=i=>e.toggleSelect(i,e.item,e.index))},{image:h(()=>[d("img",{class:"image",src:e.item.icon},null,8,Yt)]),title:h(()=>[Q(a(e.item.name)+" ("+a(e.item.version)+")",1)]),subtitle:h(()=>[d("div",Jt,a(e.item.id),1),d("div",Wt,[d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",Xt,a(e.$t("installed_at"))+": "+a(t(H)(e.item.installedAt)),1),d("div",Zt,a(e.$t("updated_at"))+": "+a(t(H)(e.item.updatedAt)),1)]),actions:h(()=>[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),_:1},8,["is-selected","is-selecting","checkbox-checked"])):(o(),r("section",{key:0,class:oe(["app-item selectable-card",{selected:e.selectedIds.includes(e.item.id),selecting:e.shiftEffectingIds.includes(e.item.id)}]),onClick:c[2]||(c[2]=g(i=>e.handleItemClick(i,e.item,e.index,()=>{}),["stop"])),onMouseenter:c[3]||(c[3]=g(i=>e.handleMouseOver(i,e.index),["stop"]))},[d("div",Qt,[e.shiftEffectingIds.includes(e.item.id)?(o(),k($,{key:0,class:"checkbox","touch-target":"wrapper",checked:e.shouldSelect,onClick:c[0]||(c[0]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])):(o(),k($,{key:1,class:"checkbox","touch-target":"wrapper",checked:e.selectedIds.includes(e.item.id),onClick:c[1]||(c[1]=g(i=>e.toggleSelect(i,e.item,e.index),["stop"]))},null,8,["checked"])),d("span",zt,[m(U,{id:e.index+1,raw:e.item},null,8,["id","raw"])])]),d("img",{class:"image",width:"50",height:"50",src:e.item.icon},null,8,Gt),d("div",Rt,a(e.item.name)+" ("+a(e.item.version)+")",1),d("div",Ot,[d("span",null,a(e.item.id),1),d("span",null,a(t(me)(e.item.size)),1),d("span",null,a(e.$t("app_type."+e.item.type)),1)]),d("div",jt,[m(ke,{item:e.item,"is-phone":e.isPhone,onUninstall:y,onDownload:w,onCancelUninstall:p},null,8,["item","is-phone"])]),d("div",Ht,[C((o(),r("span",null,[Q(a(e.$t("installed_at"))+": "+a(t(H)(e.item.installedAt)),1)])),[[b,t(_e)(e.item.installedAt)]]),C((o(),r("span",null,[Q(a(e.$t("updated_at"))+": "+a(t(H)(e.item.updatedAt)),1)])),[[b,t(_e)(e.item.updatedAt)]])])],34))}}}),es={class:"top-app-bar"},ts={class:"title"},ss={key:0},ns={key:1},ls={key:0,class:"actions"},os={key:0,class:"no-data-placeholder"},q=50,is=z({__name:"AppsView",setup(A){var re;const _=rt("isPhone"),l=E([]),{app:u,urlTokenKey:y,uploads:w}=ve(tt()),{input:p,upload:e,uploadChanged:c}=st(w),{dropping:$,fileDragEnter:U,fileDragLeave:I,dropFiles:b}=nt(w),i=lt(),S=E([]),{t:M}=ot(),{appSortBy:G}=ve(i),Ie=mt(),W=E(!1),V=it(),R=E(parseInt(((re=V.query.page)==null?void 0:re.toString())??"1")),X=E(""),Z=E(!1);let P;const{selectedIds:O,allChecked:ie,realAllChecked:x,selectRealAll:be,allCheckedAlertVisible:Se,clearSelection:ee,toggleAllChecked:Ce,toggleSelect:Ae,total:B,checked:j,shiftEffectingIds:Ue,handleItemClick:De,handleMouseOver:Pe,selectAll:Be,shouldSelect:Le}=Ct(S),{downloadItems:Ee}=at(y,dt.PACKAGE,ee,()=>It("apps")),{downloadFile:Fe}=$t(y),te=s=>{const n=V.query.q;ft(i,n?`/apps?page=${s}&q=${n}`:`/apps?page=${s}`)},{keyDown:ae,keyUp:de}=At(B,q,R,Be,ee,te,()=>{}),Me=()=>{e(u.value.downloadsDir)},{mutate:Ne}=fe({document:gt}),qe=s=>{s.isUninstalling=!1},{loading:se,fetch:ce}=ge({handle:(s,n)=>{W.value=!1,n?Y(M(n),"error"):s&&(S.value=s.packages.map(v=>({...v,isUninstalling:!1,icon:kt(y.value,"pkgicon://"+v.id)})),B.value=s.packageCount)},document:ht,variables:()=>({offset:(R.value-1)*q,limit:q,query:X.value,sortBy:G.value})});function Ve(s){G.value!==s&&(W.value=!0,G.value=s,te(1))}function pe(){var s,n;Z.value&&(R.value=parseInt(((s=V.query.page)==null?void 0:s.toString())??"1"),X.value=bt(((n=V.query.q)==null?void 0:n.toString())??""),ce())}const{mutate:Te}=fe({document:yt});function Ke(s){s.isUninstalling=!0,N(M("confirm_uninstallation_on_phone")),Te({id:s.id})}function Qe(s){Fe(s.path,`${s.name.replace(" ","")}-${s.id}.apk`)}const{loading:ze,fetch:Ge}=ge({handle:s=>{if(s)for(const n of s.packageStatuses){const v=l.value.find(D=>D.id===n.id);if(v){const D=v.isNew&&n.exist,T=!v.isNew&&n.exist&&v.updatedAt<n.updatedAt;(D||T)&&(l.value=l.value.filter(L=>L.id!==n.id),N(""),D?Y(M("app_installation_completed")):Y(M("app_upgrade_completed")),ce())}else n.exist||(Lt(S.value,n.id),N(""))}},document:wt,variables:()=>({ids:[...S.value.filter(s=>s.isUninstalling).map(s=>s.id),...l.value.map(s=>s.id)]})}),ue=s=>{s.status==="done"&&Ne({path:s.dir+"/"+s.fileName}).then(n=>{if(N(M("confirm_installation_on_phone")),n&&n.data&&n.data.installPackage){const{packageName:v,updatedAt:D,isNew:T}=n.data.installPackage;v&&(l.value.push({id:v,updatedAt:D,isNew:T}),setTimeout(()=>{l.value.some(L=>L.id===v)&&(l.value=l.value.filter(L=>L.id!==v),N(""))},12e4))}}).catch(n=>{N(""),Y(M("app_installation_failed")+": "+n.message,"error")})};function Re(s){b(s,u.value.downloadsDir,n=>n.name.endsWith(".apk"))}return ct(()=>{Z.value=!0,P&&(clearInterval(P),P=void 0),P=window.setInterval(()=>{(S.value.some(s=>s.isUninstalling)||l.value.length>0)&&!ze.value&&Ge()},1e3),pe(),he.on("upload_task_done",ue),window.addEventListener("keydown",ae),window.addEventListener("keyup",de)}),pt(()=>{Z.value=!1,P&&(clearInterval(P),P=void 0),he.off("upload_task_done",ue),window.removeEventListener("keydown",ae),window.removeEventListener("keyup",de)}),ut(()=>V.fullPath,()=>{pe()}),(s,n)=>{const v=$e,D=we,T=le,L=Je,Oe=Ye,je=J("tooltip");return o(),r(F,null,[d("div",es,[m(v,{"touch-target":"wrapper",checked:t(ie),indeterminate:!t(ie)&&t(j),onChange:t(Ce)},null,8,["checked","indeterminate","onChange"]),d("div",ts,[t(O).length?(o(),r("span",ss,a(s.$t("x_selected",{count:t(x)?t(B).toLocaleString():t(O).length.toLocaleString()})),1)):(o(),r("span",ns,a(s.$t("page_title.apps"))+" ("+a(t(B).toLocaleString())+")",1)),t(j)?C((o(),k(T,{key:2,onClick:n[0]||(n[0]=g(f=>t(Ee)(t(x),t(O),X.value),["stop"]))},{default:h(()=>[m(D)]),_:1})),[[je,s.$t("download")]]):K("",!0)]),!t(_)||!t(j)?(o(),r("div",ls,[m(Mt,{sorting:W.value,"sort-items":t(Ie),"app-sort-by":t(G),onInstall:Me,onSort:Ve},null,8,["sorting","sort-items","app-sort-by"])])):K("",!0)]),m(L,{limit:q,total:t(B),"all-checked-alert-visible":t(Se),"real-all-checked":t(x),"select-real-all":t(be),"clear-selection":t(ee)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),d("div",{class:"scroll-content",onDragover:n[3]||(n[3]=g((...f)=>t(U)&&t(U)(...f),["stop","prevent"]))},[C(d("div",{class:"drag-mask",onDrop:g(Re,["stop","prevent"]),onDragleave:n[1]||(n[1]=g((...f)=>t(I)&&t(I)(...f),["stop","prevent"]))},a(s.$t("release_to_send_files")),545),[[_t,t($)]]),d("div",{class:oe(["main-list",{"select-mode":t(j)}])},[(o(!0),r(F,null,ne(S.value,(f,He)=>(o(),k(xt,{key:f.id,item:f,index:He,"selected-ids":t(O),"shift-effecting-ids":t(Ue),"should-select":t(Le),"is-phone":t(_),"handle-item-click":t(De),"handle-mouse-over":t(Pe),"toggle-select":t(Ae),onUninstall:Ke,onDownload:Qe,onCancelUninstall:qe},null,8,["item","index","selected-ids","shift-effecting-ids","should-select","is-phone","handle-item-click","handle-mouse-over","toggle-select"]))),128)),t(se)&&S.value.length===0?(o(),r(F,{key:0},ne(20,f=>m(Tt,{key:f,index:f,"is-phone":t(_)},null,8,["index","is-phone"])),64)):K("",!0)],2),!t(se)&&S.value.length===0?(o(),r("div",os,a(s.$t(t(vt)(t(se),t(u).permissions,"QUERY_ALL_PACKAGES"))),1)):K("",!0),t(B)>q?(o(),k(Oe,{key:1,page:R.value,go:te,total:t(B),limit:q},null,8,["page","total"])):K("",!0),d("input",{ref_key:"fileInput",ref:p,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...f)=>t(c)&&t(c)(...f))},null,544)],32)],64)}}}),fs=ye(is,[["__scopeId","data-v-f01c2449"]]);export{fs as default};
