import{m as D,c as r,o as t,a,d as Le,u as je,f as Me,s as Ee,X as l,r as u,a6 as Be,i as De,w as te,az as Se,d3 as Ve,h,t as i,$ as Ie,k as g,q as Re,a1 as Fe,a9 as Ue,I as w,aa as We,T as ne,O as _,j as d,v as x,W as oe,aC as ze,c$ as Ne,a8 as qe,cu as Ke,c_ as Oe,d4 as Pe,d5 as He,d6 as Je,ch as Ae,d7 as Ge,d2 as Qe,d8 as Xe,cY as Ye,L as Ze}from"./index-Bsb9VlRU.js";import{_ as et}from"./check-circle-rounded-DLo3cS0k.js";import{u as tt}from"./markdown-DfLOb5Rg.js";import{_ as nt}from"./json-viewer.vuevuetypestyleindex0lang-ChLrq8rR.js";import{_ as ot}from"./MonacoEditor.vuevuetypescriptsetuptruelang-BdIvFslw.js";const at={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function st(C,n){return t(),r("svg",at,n[0]||(n[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497zM15 5l4 4"},null,-1)]))}const rt=D({name:"lucide-pencil",render:st}),it={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function lt(C,n){return t(),r("svg",it,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"m16 16l-2 2l2 2"}),a("path",{d:"M3 12h15a3 3 0 1 1 0 6h-4M3 18h7M3 6h18"})],-1)]))}const ut=D({name:"lucide-wrap-text",render:lt}),ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function dt(C,n){return t(),r("svg",ct,n[0]||(n[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m16 18l6-6l-6-6M8 6l-6 6l6 6"},null,-1)]))}const vt=D({name:"lucide-code",render:dt}),_t={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mt(C,n){return t(),r("svg",_t,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M2.062 12.348a1 1 0 0 1 0-.696a10.75 10.75 0 0 1 19.876 0a1 1 0 0 1 0 .696a10.75 10.75 0 0 1-19.876 0"}),a("circle",{cx:"12",cy:"12",r:"3"})],-1)]))}const pt=D({name:"lucide-eye",render:mt}),ft={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ht(C,n){return t(),r("svg",ft,n[0]||(n[0]=[a("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[a("path",{d:"M12 15V3m9 12v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),a("path",{d:"m7 10l5 5l5-5"})],-1)]))}const wt=D({name:"lucide-download",render:ht}),kt={class:"page"},yt={class:"topbar"},gt={class:"title-wrap"},xt={class:"title"},bt={class:"meta"},Tt={key:0},$t={key:1},Ct={class:"status-text"},Lt={class:"actions"},jt={class:"main"},Mt={key:0,class:"state"},Et={class:"state-text"},Bt={key:1,class:"state error"},Dt={class:"state-text"},St={key:2,class:"editor"},Vt={key:3,class:"viewer"},It={class:"viewer-card"},Rt=["innerHTML"],Ft=Le({__name:"TextFileView",setup(C){const{t:n}=je(),U=Be(),H=Pe(),J=Me(),{app:ae,urlTokenKey:L}=Ee(J),W=l(()=>!!localStorage.getItem("auth_token")),S=u(!0),m=u(""),j=u(""),b=u(""),p=u(""),z=u(0),V=u(""),N=u(null),q=u(""),k=u(!1),I=u(!0),K=u(!1);let T=null;const{render:se}=tt(ae,L),M=l(()=>p.value.toLowerCase().endsWith(".json")),E=l(()=>{const e=p.value.toLowerCase();return e.endsWith(".md")||e.endsWith(".markdown")}),re=l(()=>M.value||E.value),ie=l(()=>{const e=(p.value||"").toLowerCase(),o=e.lastIndexOf(".");return o<=0?"":e.substring(o+1)}),le=l(()=>{const e=ie.value;return e==="json"?"json":e==="md"||e==="markdown"?"markdown":e==="yaml"||e==="yml"?"yaml":e==="js"||e==="mjs"||e==="cjs"?"javascript":e==="ts"||e==="mts"||e==="cts"?"typescript":e==="go"?"go":e==="css"?"css":e==="html"||e==="htm"?"html":e==="sh"||e==="bash"?"shell":e==="toml"?"toml":"plaintext"}),ue=l(()=>({fontSize:14,lineHeight:22,tabSize:2,wordWrap:"on",lineNumbers:"on",minimap:{enabled:!0},scrollBeyondLastLine:!1,automaticLayout:!0})),O=l(()=>String(U.query.id??"").trim()),B=u(""),f=l(()=>U.name==="text-edit"),R=l(()=>b.value!==j.value),A=l(()=>{const e=p.value||n("view");return f.value&&R.value?`${e} *`:e}),G=l(()=>!f.value||S.value||m.value?"":$.value?n("saving"):K.value?n("saved"):""),{mutate:ce,loading:$,onDone:de,onError:ve}=De({document:Je});async function _e(){var e,o,s;if(!L.value&&W.value)try{const c=await Ae.a.query({query:Ge,fetchPolicy:"network-only"}),y=(o=(e=c==null?void 0:c.data)==null?void 0:e.app)==null?void 0:o.urlToken;y&&(L.value=Qe(y),J.app=(s=c==null?void 0:c.data)==null?void 0:s.app)}catch{}}function me(e){try{if(!e||!L.value)return"";const o=Xe.codec.base64.toBits(e);return Ye(L.value,o)}catch{return""}}const P=l(()=>W.value&&!!B.value),Q=async(e,o)=>{if(j.value=e,b.value=e,N.value=null,q.value="",o&&(k.value=!1),M.value)try{N.value=JSON.parse(e)}catch(s){console.error("Error parsing JSON:",s),m.value=n("invalid_json_format")}else if(E.value)try{q.value=await se(e)}catch(s){console.error("Error rendering markdown:",s)}},X=async()=>{try{S.value=!0,m.value="";const e=U.query.id;if(!e){m.value=n("invalid_file_id");return}const o=await fetch(`${Oe()}/fs?id=${encodeURIComponent(e)}`);if(!o.ok){m.value=o.status===404?n("file_not_found"):o.status===403?n("access_denied"):n("failed_to_load_file");return}const s=o.headers.get("content-disposition");if(s){const F=s.match(/filename="?([^"]+)"?/);if(F)try{p.value=decodeURIComponent(F[1]).replace(/[/\\:*?"<>|]+/g,"_")}catch{}}const c=o.headers.get("content-length");c&&(z.value=parseInt(c));const y=o.headers.get("last-modified");y&&(V.value=y);const v=await o.text();await Q(v,!0)}catch(e){console.error("Error loading text file:",e),m.value=n("network_error")}finally{S.value=!1}},pe=()=>X(),fe=()=>{P.value&&H.push({name:"text-edit",query:{id:O.value}})},he=()=>{H.push({name:"text-file",query:{id:O.value}})};te(()=>O.value,async e=>{B.value="",e&&(await _e(),B.value=me(e),X())},{immediate:!0});const we=()=>{if(!j.value||!p.value)return;const e=new Blob([j.value],{type:"text/plain;charset=utf-8"}),o=window.URL.createObjectURL(e),s=document.createElement("a");s.href=o,s.download=p.value,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o)},ke=()=>{k.value=!k.value},ye=()=>{I.value=!I.value};async function Y(){!P.value||!f.value||!B.value||$.value||!R.value||!await He(ce,de,ve,{path:B.value,content:b.value,overwrite:!0})||(await Q(b.value,!1),K.value=!0,T&&window.clearTimeout(T),T=window.setTimeout(()=>{K.value=!1,T=null},1500))}function Z(e){f.value&&(!e.ctrlKey&&!e.metaKey||e.altKey||e.key!=="s"&&e.key!=="S"||(e.preventDefault(),e.stopPropagation(),Y()))}return Se(()=>{window.addEventListener("keydown",Z,{capture:!0})}),Ve(()=>{window.removeEventListener("keydown",Z,{capture:!0}),T&&window.clearTimeout(T)}),te([p,R,f],()=>{document.title=A.value}),(e,o)=>{const s=qe,c=et,y=wt,v=ze,F=pt,ee=vt,ge=ut,xe=rt,be=Ne,Te=Ke,$e=Fe("tooltip");return t(),r("div",kt,[a("header",yt,[a("div",gt,[a("div",xt,i(A.value),1),a("div",bt,[z.value?(t(),r("span",Tt,i(g(Re)(z.value)),1)):h("",!0),V.value?Ie((t(),r("span",$t,[w(i(g(We)(V.value)),1)])),[[$e,g(Ue)(V.value)]]):h("",!0)])]),G.value?(t(),r("div",{key:0,class:ne(["status",{saving:g($)}])},[g($)?(t(),_(s,{key:0,indeterminate:"",size:16,width:2})):(t(),_(c,{key:1,class:"status-icon"})),a("span",Ct,i(G.value),1)],2)):h("",!0),a("div",Lt,[f.value?h("",!0):(t(),_(v,{key:0,class:"action-btn",onClick:we},{default:x(()=>[d(y),w(" "+i(e.$t("download")),1)]),_:1})),f.value?(t(),r(oe,{key:1},[d(v,{class:"action-btn",loading:g($),disabled:g($)||!R.value,onClick:Y},{default:x(()=>[w(i(e.$t("save")),1)]),_:1},8,["loading","disabled"]),d(v,{class:"action-btn",onClick:he},{default:x(()=>[w(i(e.$t("view")),1)]),_:1})],64)):(t(),r(oe,{key:2},[re.value?(t(),_(v,{key:0,class:"action-btn",onClick:ke},{default:x(()=>[k.value?(t(),_(F,{key:0})):(t(),_(ee,{key:1})),w(" "+i(k.value?e.$t("formatted_view"):e.$t("raw_text")),1)]),_:1})):h("",!0),k.value||!M.value&&!E.value?(t(),_(v,{key:1,class:"action-btn",onClick:ye},{default:x(()=>[d(ge),w(" "+i(I.value?e.$t("unwrap"):e.$t("wrap")),1)]),_:1})):h("",!0),P.value?(t(),_(v,{key:2,class:"action-btn",onClick:fe},{default:x(()=>[d(xe),w(" "+i(e.$t("edit")),1)]),_:1})):h("",!0)],64)),d(be,{"logged-in":W.value},null,8,["logged-in"])])]),a("main",jt,[S.value?(t(),r("section",Mt,[d(s,{indeterminate:""}),a("span",Et,i(e.$t("loading")),1)])):m.value?(t(),r("section",Bt,[d(Te,{class:"state-icon"}),a("span",Dt,i(m.value),1),d(v,{onClick:pe},{default:x(()=>[w(i(e.$t("retry")),1)]),_:1})])):f.value?(t(),r("section",St,[d(ot,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=Ce=>b.value=Ce),language:le.value,options:ue.value,height:"100%"},null,8,["modelValue","language","options"])])):(t(),r("section",Vt,[a("div",It,[k.value||!M.value&&!E.value?(t(),r("pre",{key:0,class:ne(["view-raw text-view",{"text-wrap":I.value}])},i(j.value),3)):M.value?(t(),_(nt,{key:1,value:N.value,"expand-depth":2},null,8,["value"])):E.value?(t(),r("div",{key:2,class:"md-container",innerHTML:q.value},null,8,Rt)):h("",!0)])]))])])}}}),Kt=Ze(Ft,[["__scopeId","data-v-bb923a19"]]);export{Kt as default};
